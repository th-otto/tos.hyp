<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html lang="de">
<head>
<title>
Die Anleitung zum TOS: Speicherverwaltung
</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Content-Language" content="de">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="Generator" content="UDO 7.04 (1296) for Linux">
</head>
<body>
<? include "/var/www/banner.php"; ?>

<a id="UDO_nav_hm_HEAD" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a><a id="UDO_nav_up_HEAD" href="005.html"><img src="udo_up.gif" alt="GEMDOS" title="GEMDOS" border="0" width="24" height="24"></a><a id="UDO_nav_lf_HEAD" href="00500b.html"><img src="udo_lf.gif" alt="Prozessfunktionen" title="Prozessfunktionen" border="0" width="24" height="24"></a><a id="UDO_nav_rg_HEAD" href="00500d.html"><img src="udo_rg.gif" alt="Netzwerkfunktionen" title="Netzwerkfunktionen" border="0" width="24" height="24"></a>
<hr>

<h1><a name="Speicherverwaltung"></a>5.12 Speicherverwaltung</h1>
<table>
<tr><td nowrap="nowrap" valign="top">• <a href="#Maddalt">Maddalt</a></td>
<td valign="top">Alternativen Speicher anmelden.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Malloc">Malloc</a>&nbsp;</td>
<td valign="top">Speicher reservieren bzw. freien Speicher erfragen.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Mfree">Mfree</a>&nbsp;&nbsp;</td>
<td valign="top">Speicherbereich freigeben.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Mshrink">Mshrink</a></td>
<td valign="top">Speicherbereich verkleinern/vergrößern.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Mxalloc">Mxalloc</a></td>
<td valign="top">Speicherbereich reservieren.

</td></tr>
</table>

<p><b>Achtung:</b> An dieser Stelle sei darauf hingewiesen, daß im
Hinblick auf zukünftige Betriebssystem-Versionen zur Kommunikation
zwischen verschiedenen Programmen benutzte oder über Zeiger
zugewiesene Speicherbereiche <i><a href="008002.html#global">global</a></i> sein müssen
(<a href="#Mxalloc">Mxalloc</a>-Funktion mit Global-Flag). Andernfalls wird es beim Einsatz
auf Rechnern mit PMMU (z.B. Atari-TT oder Falcon) zu
Speicherschutzverletzungen kommen.</p>

<p>Querverweis: <a href="005006.html">Programmstart und TPA</a> &nbsp; <a href="00500b.html">Prozessfunktionen</a> &nbsp;
<a href="010009.html#Speicherverwaltung_20in_20TOS">Speicherverwaltung in TOS</a> &nbsp; <a href="010009.html#Speicherverwaltung_20in_20MagiC">Speicherverwaltung in MagiC</a></p>

<h3><a name="Maddalt"></a>5.12.1 Maddalt</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Inform Gemdos of alternative memory« - Alternativen Speicher
anmelden.</td></tr>

<tr><td nowrap="nowrap" valign="top">Gemdosnummer:</td>
<td valign="top">20</td></tr>

<tr><td nowrap="nowrap" valign="top">Deklaration:</td>
<td valign="top">int32_t Maddalt ( void *start, int32_t size );</td></tr>

<tr><td nowrap="nowrap" valign="top">Beschreibung:</td>
<td valign="top">Die <a href="005.html">GEMDOS</a>-Routine Maddalt erlaubt es, einen Block von
Alternate-RAM in die Speicherliste des GEMDOS aufzunehmen. Es gilt:<table>
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top">Bedeutung</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">start</td>
<td valign="top">Anfangsadresse des Speichers</td></tr>

<tr><td nowrap="nowrap" valign="top">size</td>
<td valign="top">Länge des Speicherbereichs

</td></tr>
</table>

<br><br>

<b>Hinweis:</b> Der Block bleibt Eigentum von DOS und darf nicht
zurückgefordert werden. Wenn hinzugefügte Blöcke nicht
hintereinander liegen, ist die Anzahl der hinzufügbaren Blöcke auf
ca. 12 beschränkt.<br><br>

Nützlich könnte diese Funktion etwa beim Einsatz von
VME-Bus-Karten im Atari-TT sein, wenn deren Speicher für GEMDOS
zugänglich gemacht werden soll.</td></tr>

<tr><td nowrap="nowrap" valign="top">Ergebnis:</td>
<td valign="top">Die Funktion liefert den Wert 0, oder eine negative
Fehlermeldung.</td></tr>

<tr><td nowrap="nowrap" valign="top">Verfügbar:</td>
<td valign="top"> Die Funktion ist erst ab GEMDOS 0.19 verfügbar.</td></tr>

<tr><td nowrap="nowrap" valign="top">Gruppe:</td>
<td valign="top"><a href="#Speicherverwaltung">Speicherverwaltung</a></td></tr>

<tr><td nowrap="nowrap" valign="top">Querverweis:</td>
<td valign="top"> <a href="#Bindings_20f_C3_BCr_20Maddalt">Binding</a> &nbsp; <a href="#Mfree">Mfree</a> &nbsp; <a href="#Malloc">Malloc</a> &nbsp; <a href="#Mxalloc">Mxalloc</a>

</td></tr>
</table>

<h4><a name="Bindings_20f_C3_BCr_20Maddalt"></a>5.12.1.1 Bindings für Maddalt</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Maddalt">Maddalt</a> ( void *start, int32_t size );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.l    size,-(sp)   ; Offset 6
pea       start        ; Offset 2
move.w    #20,-(sp)    ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a> aufrufen
lea       $A(sp),sp    ; Stack korrigieren
</pre>


</td></tr>
</table>

<h3><a name="Malloc"></a>5.12.2 Malloc</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»memory allocation« - Speicherplatz reservieren.</td></tr>

<tr><td nowrap="nowrap" valign="top">Gemdosnummer:</td>
<td valign="top">72</td></tr>

<tr><td nowrap="nowrap" valign="top">Deklaration:</td>
<td valign="top">void *Malloc ( int32_t number );</td></tr>

<tr><td nowrap="nowrap" valign="top">Beschreibung:</td>
<td valign="top">Die <a href="005.html">GEMDOS</a>-Routine Malloc reserviert Speicherplatz, oder
berechnet die Größe des verfügbaren Speichers. Für den Parameter
<i>number</i> gilt:<table>
<tr><td nowrap="nowrap" valign="top">Wert</td>
<td valign="top">Bedeutung</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">-1</td>
<td valign="top">Länge des größten verfügbaren Blocks ermitteln</td></tr>

<tr><td nowrap="nowrap" valign="top">sonst</td>
<td valign="top">Anzahl der zu reservierenden Bytes

</td></tr>
</table>

<br><br>

<b>Hinweis:</b> Man darf sich nie darauf verlassen, daß
tatsächlich so viele Bytes wie gewünscht alloziert wurden.
Konstruktionen der Art Malloc(Malloc(-1L)) sind besonders in
Multitasking-Systemen schlicht indiskutabel (Stichwort: Task-Wechsel).<br><br>

Unter <a href="002.html">TOS</a> untersützt das <a href="005.html">GEMDOS</a> nur eine begrenzte Anzahl von
Speicherblöcke. Aus diesem Grund sollte man die Funktion nicht zu
häüfig innerhalb eines Programms nutzen, sondern größere
Speicherblöcke (mindestens 16KBytes) reservieren und selbst
verwalten.<br><br>

<b>Ferner sollte man folgende Punkte beachten:</b>

<ul>
<li><p>der Speicherblock muß nicht leer sein</p></li>
<li><p>nacheinander allozierte Speicherblöcke müssen nicht zwingend
zusammenhängen</p></li>
<li><p>niemals auf Speicherbereiche zugreifen, der nicht dem eigenen
Prozess gehört. In Systemen mit Speicherschutz kommt es sonst zu
einer Exception.</p></li>
</ul>

<br><br>

In <a href="00b.html">MagiC</a> wird dieser Aufruf auf <a href="#Mxalloc">Mxalloc</a> mit den Modi 0 bzw. 3
zurückgeführt (abhängig von den Konfigurationsbits im
Programmdatei-Header). Die Konfigurationsbits werden z.Zt. in der
Basepage abgelegt.</td></tr>

<tr><td nowrap="nowrap" valign="top">Ergebnis:</td>
<td valign="top">Die Funktion liefert als Ergebnis die Anfangsadresse des
reservierten Bereichs. Ein Nullzeiger bedeutet, daß nicht mehr
genügend Speicher zur Verfügung steht. Im Fall <i>number</i> = -1
wird die Länge des größten verfügbaren Speicherblocks
zurückgegeben.</td></tr>

<tr><td nowrap="nowrap" valign="top">Verfügbar:</td>
<td valign="top">Alle <a href="005.html">GEMDOS</a> Versionen. GEMDOS Versionen kleiner 0.15 liefern
für den Aufruf Malloc( 0L ) einen Zeiger auf ungültigen Speicher
statt daß der Aufruf fehlschlägt wie er sollte.</td></tr>

<tr><td nowrap="nowrap" valign="top">Gruppe:</td>
<td valign="top"><a href="#Speicherverwaltung">Speicherverwaltung</a></td></tr>

<tr><td nowrap="nowrap" valign="top">Querverweis:</td>
<td valign="top"><a href="#Bindings_20f_C3_BCr_20Malloc">Bindings für Malloc</a> &nbsp; <a href="#Mfree">Mfree</a> &nbsp; <a href="#Mxalloc">Mxalloc</a> &nbsp; <a href="#Maddalt">Maddalt</a> &nbsp; <a href="005005.html#Die_20Programmflags">Programmflags</a>

</td></tr>
</table>

<h4><a name="Bindings_20f_C3_BCr_20Malloc"></a>5.12.2.1 Bindings für Malloc</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">void *<a href="#Malloc">Malloc</a> ( int32_t number );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.l    number,-(sp) ; Offset 2
move.w    #72,-(sp)    ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a> aufrufen
addq.l    #6,sp        ; Stack korrigieren
</pre>


</td></tr>
</table>

<h3><a name="Mfree"></a>5.12.3 Mfree</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»memory free« - Speicherplatz freigeben.</td></tr>

<tr><td nowrap="nowrap" valign="top">Gemdosnummer:</td>
<td valign="top">73</td></tr>

<tr><td nowrap="nowrap" valign="top">Deklaration:</td>
<td valign="top">int32_t Mfree ( void *block );</td></tr>

<tr><td nowrap="nowrap" valign="top">Beschreibung:</td>
<td valign="top">Die <a href="005.html">GEMDOS</a>-Routine Mfree gibt einen mit <a href="#Malloc">Malloc</a> reservierten
Speicherbereich wieder frei.<br><br>

Der Parameter <i>block</i> enthält die Anfangsadresse des
freizugebenden Speicherbereichs.<br><br>

<b>Hinweis:</b> In fast allen GEMDOS-Versionen wird nicht
überprüft, ob der freizugebende Block dem betreffenden Prozess auch
gehört. Daher ist vor allem in Multitasking-Systemen besondere
Vorsicht angebracht.</td></tr>

<tr><td nowrap="nowrap" valign="top">Ergebnis:</td>
<td valign="top">Die Funktion liefert folgende Resultate:<table>
<tr><td nowrap="nowrap" valign="top">Wert</td>
<td valign="top">Bedeutung</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#E_OK">E_OK</a></td>
<td valign="top">kein Fehler aufgetreten</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EIMBA">EIMBA</a></td>
<td valign="top">falsche Speicherblockadresse

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Verfügbar:</td>
<td valign="top">Alle GEMDOS Versionen.</td></tr>

<tr><td nowrap="nowrap" valign="top">Gruppe:</td>
<td valign="top"><a href="#Speicherverwaltung">Speicherverwaltung</a></td></tr>

<tr><td nowrap="nowrap" valign="top">Querverweis:</td>
<td valign="top"><a href="#Bindings_20f_C3_BCr_20Mfree">Binding</a> &nbsp; <a href="#Malloc">Malloc</a> &nbsp; <a href="#Mxalloc">Mxalloc</a> &nbsp; <a href="#Maddalt">Maddalt</a>

</td></tr>
</table>

<h4><a name="Bindings_20f_C3_BCr_20Mfree"></a>5.12.3.1 Bindings für Mfree</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Mfree">Mfree</a> ( void *block );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>pea       block        ; Offset 2
move.w    #73,-(sp)    ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a> aufrufen
addq.l    #6,sp        ; Stack korrigieren
</pre>


</td></tr>
</table>

<h3><a name="Mshrink"></a>5.12.4 Mshrink</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»memory shrink« - Speicherbereich verkürzen oder
vergrößern.</td></tr>

<tr><td nowrap="nowrap" valign="top">Gemdosnummer:</td>
<td valign="top">74</td></tr>

<tr><td nowrap="nowrap" valign="top">Deklaration:</td>
<td valign="top">int32_t Mshrink ( void *block, int32_t newsiz );</td></tr>

<tr><td nowrap="nowrap" valign="top">Beschreibung:</td>
<td valign="top">Die <a href="005.html">GEMDOS</a>-Routine Mshrink verkürzt oder vergrößert einen
bereits reservierten Speicherbereich. Es gilt:<table>
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top">Bedeutung</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">block</td>
<td valign="top">Anfangsadresse des Speicherblocks</td></tr>

<tr><td nowrap="nowrap" valign="top">newsiz</td>
<td valign="top">neue (geänderte) Länge des Blocks; <b>in MagiC
zusätzlich:</b><table>
<tr><td nowrap="nowrap" valign="top">-1 =</td>
<td valign="top">ermitteln der größtmöglichen Größe des Speicherblocks</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;0 =</td>
<td valign="top">Block freigeben
</td></tr>
</table>


</td></tr>
</table>

<br><br>

<b>Hinweis:</b> Es wird i.d.R. nicht überprüft, ob der
Speicherblock dem Aufrufer überhaupt gehört. Die Möglichkeit einen
Speicherblock zu <i>vergrößern</i>, steht z.Zt. nur in <a href="00b.html">MagiC</a> zur
Verfügung. Allerdings funktioniert dies nur, wenn über dem
betreffenden Block ein genügend großer freier Block vorhanden ist,
und die <a href="00b013.html#TOS-Kompatibilit_C3_A4t">TOS-Kompatibilität</a> deaktiviert wurde.</td></tr>

<tr><td nowrap="nowrap" valign="top">Ergebnis:</td>
<td valign="top">Die Funktion liefert folgende Resultate:<table>
<tr><td nowrap="nowrap" valign="top"><a href="005003.html#E_OK">E_OK</a> :</td>
<td valign="top">kein Fehler aufgetreten</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EIMBA">EIMBA</a> :</td>
<td valign="top">falsche Blockadresse</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EGSBF">EGSBF</a> :</td>
<td valign="top">Block würde vergrößert

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Verfügbar:</td>
<td valign="top">Alle GEMDOS Versionen.</td></tr>

<tr><td nowrap="nowrap" valign="top">Gruppe:</td>
<td valign="top"><a href="#Speicherverwaltung">Speicherverwaltung</a></td></tr>

<tr><td nowrap="nowrap" valign="top">Querverweis:</td>
<td valign="top"><a href="#Bindings_20f_C3_BCr_20Mshrink">Binding</a> &nbsp; <a href="#Malloc">Malloc</a> &nbsp; <a href="#Mfree">Mfree</a>

</td></tr>
</table>

<h4><a name="Bindings_20f_C3_BCr_20Mshrink"></a>5.12.4.1 Bindings für Mshrink</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Mshrink">Mshrink</a> ( void *block, int32_t newsiz );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.l    newsiz,-(sp)  ; Offset 8
pea       block         ; Offset 4
move.w    #0,-(sp)      ; Offset 2
move.w    #74,-(sp)     ; Offset 0
trap      #1            ; <a href="005.html">GEMDOS</a> aufrufen
lea       $C(sp),sp     ; Stack korrigieren
</pre>
<br><br>

<b>Hinweis:</b> Der Null-Parameter wird beim C-Binding
normalerweise automatisch hinzugefügt.

</td></tr>
</table>

<h3><a name="Mxalloc"></a>5.12.5 Mxalloc</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Allocate memory (with preference)« - Speicherplatz
reservieren.</td></tr>

<tr><td nowrap="nowrap" valign="top">Gemdosnummer:</td>
<td valign="top">68</td></tr>

<tr><td nowrap="nowrap" valign="top">Deklaration:</td>
<td valign="top">void *Mxalloc ( int32_t amount, int16_t mode );</td></tr>

<tr><td nowrap="nowrap" valign="top">Beschreibung:</td>
<td valign="top">Die <a href="005.html">GEMDOS</a>-Routine Mxalloc reserviert einen Speicherbereich der
Größe <i>amount</i>. Über die Bits des Parameters <i>mode</i>
kann die gewünschte Speicherart spezifiziert werden; es gilt:<table>
<tr><td nowrap="nowrap" valign="top">Bits</td>
<td valign="top">Bedeutung</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">0-2</td>
<td valign="top"><b>Behandlung des TT-RAMs</b><table>
<tr><td nowrap="nowrap" valign="top">0 =</td>
<td valign="top">nur ST-RAM</td></tr>

<tr><td nowrap="nowrap" valign="top">1 =</td>
<td valign="top">nur TT-RAM</td></tr>

<tr><td nowrap="nowrap" valign="top">2 =</td>
<td valign="top">egal, ST-RAM bevorzugt</td></tr>

<tr><td nowrap="nowrap" valign="top">3 =</td>
<td valign="top">egal, TT-RAM bevorzugt
</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">3</td>
<td valign="top">reserviert</td></tr>

<tr><td nowrap="nowrap" valign="top">4-7</td>
<td valign="top"><b>Speicherschutz-Modus</b><table>
<tr><td nowrap="nowrap" valign="top">0 =</td>
<td valign="top">Abhängig von den Programmflags</td></tr>

<tr><td nowrap="nowrap" valign="top">1 =</td>
<td valign="top">Privat</td></tr>

<tr><td nowrap="nowrap" valign="top">2 =</td>
<td valign="top">Global</td></tr>

<tr><td nowrap="nowrap" valign="top">3 =</td>
<td valign="top"><a href="00500e.html#Super">Super</a></td></tr>

<tr><td nowrap="nowrap" valign="top">4 =</td>
<td valign="top">nur lesbar
</td></tr>
</table>

<br>

Alle anderen Werte sind undefiniert, und für zukünftige Zwecke
reserviert.</td></tr>

<tr><td nowrap="nowrap" valign="top">14</td>
<td valign="top"><b>No-Free-Modus</b>
<br>Wenn dieses Bit gesetzt ist und der Besitzer dieses Speichers
terminiert, wird der Speicherbereich nicht freigegeben, sondern an das
Betriebssystem vererbt. Dieser Modus ist nur für das Betriebssystem
interessant, und steht normalen Anwenderprogrammen nicht zur
Verfügung.

</td></tr>
</table>

<br><br>

Alle weiteren Bits sind für zukünftige Zwecke reserviert. Mit
dem Wert -1 für <i>amount</i> kann man die Länge des größten
zusammenhängend verfügbaren Speicherblocks (abhängig von
<i>mode</i>) erfragen.<br><br>

Unter <a href="00b.html">MagiC</a> werden alle Speicherallozierungen mitprotokolliert.
Wenn die mit LIMITMEM vorgegebene Beschränkung überschritten wird,
wird ein Nullzeiger zurückgegeben. Im Fall <i>amount</i> = -1 wird
das Minimum von freiem Speicher und noch nicht ausgeschöpfter
LIMITMEM-Beschränkung zurückgegeben. Ausnahmen sind Aufrufe des
Bildschirm-Managers (SCRENMGR), der die Menüs kontrolliert. Dadurch
wird sichergestellt, daß auch per LIMITMEM beschränkte Programme
keine Probleme mit dem Redraw bei Menüs haben.<br><br>

<b>Hinweis:</b> Ein Problem besteht darin, festzustellen, wann
die erweiterten Modi (Bits 3 und folgende) benutzt werden dürfen.
Einige ältere Versionen des GEMDOS kommen nämlich nicht mit diesen
Modi zurecht, und sorgen z.T. für den Absturz der Applikation bzw.
des ganzen Systems. Aus diesem Grund testen viele Programmierer
explizit auf das Vorhandensein von MiNT/MultiTOS oder Versionen von
MagiC >= 2.0. Alternativ kann auch die Funktion <a href="#Mxmask">Mxmask</a> benutzt
werden.</td></tr>

<tr><td nowrap="nowrap" valign="top">Ergebnis:</td>
<td valign="top">Die Funktion liefert als Ergebnis die Anfangsadresse des
reservierten Bereichs als typenlosen Zeiger. Mxalloc liefert als
Ergebnis eine 0, wenn nicht mehr genügend Speicher vorhanden ist.</td></tr>

<tr><td nowrap="nowrap" valign="top">Verfügbar:</td>
<td valign="top">Diese Funktion existiert erst ab GEMDOS-Version 0.19.</td></tr>

<tr><td nowrap="nowrap" valign="top">Gruppe:</td>
<td valign="top"><a href="#Speicherverwaltung">Speicherverwaltung</a></td></tr>

<tr><td nowrap="nowrap" valign="top">Querverweis:</td>
<td valign="top"><a href="#Bindings_20f_C3_BCr_20Mxalloc">Binding</a> &nbsp; <a href="#Mfree">Mfree</a> &nbsp; <a href="#Malloc">Malloc</a> &nbsp; <a href="#Maddalt">Maddalt</a> &nbsp; <a href="005005.html#Die_20Programmflags">Programmflags</a>

</td></tr>
</table>

<h4><a name="Bindings_20f_C3_BCr_20Mxalloc"></a>5.12.5.1 Bindings für Mxalloc</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">void *<a href="#Mxalloc">Mxalloc</a> ( int32_t amount, int16_t mode );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    mode,-(sp)    ; Offset 6
move.l    amount,-(sp)  ; Offset 2
move.w    #68,-(sp)     ; Offset 0
trap      #1            ; <a href="005.html">GEMDOS</a> aufrufen
addq.l    #8,sp         ; Stack korrigieren
</pre>


</td></tr>
</table>

<h4><a name="Mxmask"></a>5.12.5.2 Mxmask</h4>
<pre>/*
   Mxmask() liefert eine Bitmaske mit der man das Moduswort eines
   <a href="#Mxalloc">Mxalloc</a>() Aufrufs maskieren sollte, falls man Protectionbits
   benutzen möchte. Dies ist notwendig, da <a href="#Mxalloc">Mxalloc</a>() bei der Angabe
   von Protectionbits leider in einigen <a href="005.html">GEMDOS</a> Implementierungen
   fehlerhafte Resultate liefert, die in der Folge zum Absturz des
   Systems fuehren koennen. ((c) 1994 Martin Osieka)
   Anwendungsbeispiel:
   mxMask = Mxmask();
   p = mxMask ? <a href="#Mxalloc">Mxalloc</a>( size, 0x43 & mxMask) : <a href="#Malloc">Malloc</a>( size); */

SHORT Mxmask (void)
{
    void *svStack;      /* Supervisor-Stack */
    int32_t sRAM, sRAMg;   /* ST-RAM          */
    int32_t aRAM, aRAMg;   /* Alternate RAM   */

    /*
    // Beispieltabelle moeglicher Werte:
    //           | newfashion  | oldfashion
    // sRAM aRAM | sRAMg aRAMg | sRAMg aRAMg
    //   1    0  |   1     0   |   1     1
    //   0    2  |   0     2   |   2     2
    //   1    2  |   1     2   |   3     3
    */

    svStack = (void *) <a href="00500e.html#Super">Super</a>( 0);  /* unterbinde Taskwechsel */

    sRAM  = (int32_t) <a href="#Mxalloc">Mxalloc</a>( -1, 0);
    sRAMg = (int32_t) <a href="#Mxalloc">Mxalloc</a>( -1, 0x40); /* im Fehlerfall <a href="#Mxalloc">Mxalloc</a>( -1, 3) */
    aRAM  = (int32_t) <a href="#Mxalloc">Mxalloc</a>( -1, 1);
    aRAMg = (int32_t) <a href="#Mxalloc">Mxalloc</a>( -1, 0x41); /* im Fehlerfall <a href="#Mxalloc">Mxalloc</a>( -1, 3) */

    <a href="00500e.html#Super">Super</a>( svStack);  /* erlaube Taskwechsel */

    if (sRAM == -32)
        return 0x0000;  /* <a href="#Mxalloc">Mxalloc</a>() ist nicht implementiert */

    else if ( ((sRAM + aRAM) == sRAMg) && ((sRAM + aRAM) == aRAMg) )
        return 0x0003;  /* oldfashion <a href="#Mxalloc">Mxalloc</a>() */

    else
        return 0xFFFF;

} /* Mxmask */
</pre>
<p>Querverweis: <a href="005.html">GEMDOS</a> &nbsp; <a href="#Speicherverwaltung">Speicherverwaltung</a></p>

<hr>

<a id="UDO_nav_hm_FOOT" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a><a id="UDO_nav_up_FOOT" href="005.html"><img src="udo_up.gif" alt="GEMDOS" title="GEMDOS" border="0" width="24" height="24"></a><a id="UDO_nav_lf_FOOT" href="00500b.html"><img src="udo_lf.gif" alt="Prozessfunktionen" title="Prozessfunktionen" border="0" width="24" height="24"></a><a id="UDO_nav_rg_FOOT" href="00500d.html"><img src="udo_rg.gif" alt="Netzwerkfunktionen" title="Netzwerkfunktionen" border="0" width="24" height="24"></a></body>
</html>
