<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html lang="de">
<head>
<title>
Die Anleitung zum TOS: scrollende Eingabefelder
</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Content-Language" content="de">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="Generator" content="UDO 7.04 (1296) for Linux">
</head>
<body>
<? include "/var/www/banner.php"; ?>

<a id="UDO_nav_hm_HEAD" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a><a id="UDO_nav_up_HEAD" href="00b.html"><img src="udo_up.gif" alt="MagiC" title="MagiC" border="0" width="24" height="24"></a><a id="UDO_nav_lf_HEAD" href="00b006.html"><img src="udo_lf.gif" alt="Eingabefelder in MagiC" title="Eingabefelder in MagiC" border="0" width="24" height="24"></a><a id="UDO_nav_rg_HEAD" href="00b008.html"><img src="udo_rg.gif" alt="Spezielle Fehlermeldungen von MagiC" title="Spezielle Fehlermeldungen von MagiC" border="0" width="24" height="24"></a>
<hr>

<h1><a name="scrollende_20Eingabefelder"></a>11.7 scrollende Eingabefelder</h1>
<pre>/*******************************************************************
*
* Dieses Beispielprogramm demonstriert den Gebrauch scrollender
* <a href="00b006.html">Eingabefelder in MagiC</a> 3.
*
*******************************************************************/

#include <<a href="008002.html#aes">aes</a>.h>
#include <tos.h>
#include <string.h>
#include <magx.h>
#include "magxlib.h"
#include "edscroll.h"

#define TLEN  30

int  do_dialog    (<a href="008016.html#OBJECT">OBJECT</a> *dialog);

void main()
{
  <a href="008016.html#OBJECT">OBJECT</a> *adr_dialog;
  ULONG crdate;
  int is_scroll;

  <a href="008016.html#XTED">XTED</a> xted;
  char tmplt[TLEN+1],txt[TLEN+1];


  /* Feststellen, ob das System Scrolledit kann */
  /* ------------------------------------------ */

  is_scroll = ((0 < get_<a href="00b.html">MagiC</a>_ver(&crdate)) &&
    (crdate >= 0x19950829L));

     /* Applikation beim <a href="008.html">AES</a> anmelden */
     /* ----------------------------- */

     if   (<a href="Application.html#appl_init">appl_init</a>() < 0)
          <a href="00500b.html#Pterm">Pterm</a>(1);

     /* Resourcedatei laden */
     /* ------------------- */
     if   (!<a href="008011.html#rsrc_load">rsrc_load</a>("edscroll.rsc"))
     {
          <a href="00800b.html#form_alert">form_alert</a>(1, "[3][Kann \"EDSCROLL.RSC\"|nicht finden][Abbruch]");
          goto err;
     }

     <a href="008011.html#rsrc_gaddr">rsrc_gaddr</a>(0, EDIT, &adr_dialog);

  /* Scroll-<a href="008016.html#TEDINFO">TEDINFO</a> initialisieren */
  /* ----------------------------- */

  init_scrlted(adr_dialog+EDITTXT, is_scroll, &xted,
        txt, tmplt, TLEN);

  strcpy(txt, "Beispiel");

  /* Dialog */
  /* ------ */

     <a href="008009.html#wind_update">wind_update</a>(<a href="008009.html#BEG_MCTRL">BEG_MCTRL</a>);
     <a href="00800c.html#graf_mouse">graf_mouse</a>(<a href="00800c.html#ARROW">ARROW</a>, 0L);
     do_dialog(adr_dialog);
     <a href="008009.html#wind_update">wind_update</a>(<a href="008009.html#END_MCTRL">END_MCTRL</a>);
     <a href="008011.html#rsrc_free">rsrc_free</a>();

  err:
     <a href="Application.html#appl_exit">appl_exit</a>();
     <a href="00500b.html#Pterm0">Pterm0</a>();
}


/****************************************************************
*
* do_dialog
*
****************************************************************/

int do_dialog(<a href="008016.html#OBJECT">OBJECT</a> *dialog)
{
     int cx, cy, cw, ch;
     int exitbutton;

     <a href="00800b.html#form_center">form_center</a>(dialog, &cx, &cy, &cw, &ch);
     <a href="00800b.html#form_dial">form_dial</a>(<a href="00800b.html#FMD_START">FMD_START</a>, 0,0,0,0, cx, cy, cw, ch);
     <a href="008010.html#objc_draw">objc_draw</a>(dialog, ROOT, MAX_DEPTH, cx, cy, cw, ch);
     exitbutton = 0x7f & <a href="00800b.html#form_do">form_do</a>(dialog, 0);
     <a href="00800b.html#form_dial">form_dial</a>(<a href="00800b.html#FMD_FINISH">FMD_FINISH</a>, 0,0,0,0,cx, cy, cw, ch);
     return(exitbutton);
}


/*******************************************************************
*
* <a href="00b.html">MagiC</a>-Version ermitteln.
* ========================
*
* Falls <crdate> != NULL ist, wird das Erstelldatum in der
* Form jjjjmmdd geliefert. Durch "<" und ">" kann dann
* direkt ermittelt werden, ob eine bestimmte Funktion
* bei der vorliegenden <a href="00b.html">MagiC</a>- Version verfügbar ist.
*
* Rückgabe:  0     kein <a href="00b.html">MagiC</a> installiert
*           -1    bin noch im AUTO-Ordner
*       0x0a0b    Version a.b
*
*******************************************************************/

WORD get_<a href="00b.html">MagiC</a>_ver(ULONG *crdate)
{
  ULONG *cookie;
  <a href="010009.html#AESVARS">AESVARS</a> *av;

  cookie = get_cookie('MagX');
  if  (!cookie)
    return(0);
  else
  {
    av = ((<a href="003007.html#MAGX_COOKIE">MAGX_COOKIE</a> *) (*cookie))->aesvars;
    if  (!av)
      return(-1);
    else if (crdate)
    {
      *crdate = av->date << 16L;        /* jjjj0000 */
      *crdate |= av->date >> 24L;       /* jjjj00tt */
      *crdate |= (av->date >> 8L) & 0xff00L;    /* jjjjmmtt */
      return(av->version);
    }
  }
}


/****************************************************************
*
* Macht ein F(BOX)TEXT-Objekt scrollbar, wenn <a href="00b.html">MagiC</a> läuft.
*
* Wenn <is_scroll> FALSE ist, wird nur das Textfeld auf eine
* Benutzerzeichenkette umgesetzt.
*
* Im RCS sollte das Textfeld leer gelassen werden, die Schablone
* und die Valid-Zeichenkette müssen jedoch eingegeben werden,
* weil sonst das RCS streikt.
* Für scrollende Felder muß eine neue Schablone angelegt werden,
* die in der .RSC-Datei angemeldete kann nicht verwendet werden,
* weil sie zu kurz ist. Die hier angelegte Schablone besteht
* nur aus '_'-Zeichen, weil dies 99.9% aller Anwendungsfälle
* für scrollende !{"Objekte" ignore} abdeckt. Die Länge der
* Valid-Zeichenkette ist egal, d.h. muß mindestens 1 sein, weil
* das <a href="008.html">AES</a> das letzte Zeichen der Valid-Zeichenkette
* automatisch vervielfacht, bis die Länge des Textfeld erreicht
* ist.
*
* Die maximale Länge für die Eingabezeichenkette ist in jedem
* Fall (<a href="008016.html#TEDINFO">TEDINFO</a>.te_txtlen - 1).
*
****************************************************************/

void init_scrlted(<a href="008016.html#OBJECT">OBJECT</a> *o, WORD is_scroll, <a href="008016.html#XTED">XTED</a> *xted,
        char *txt, char *tmplt, WORD len)
{
  <a href="008016.html#TEDINFO">TEDINFO</a> *t;

  t = o->ob_spec.tedinfo;
  t->te_just = TE_LEFT;   /* wichtig! */
  t->te_ptext = txt;
  if  (is_scroll)
  {
    memset(tmplt, '_', len);  /* neue Schablone */
    tmplt[len] = '\0';
    xted->xte_ptmplt = tmplt;
    xted->xte_pvalid = t->te_pvalid;
    xted->xte_vislen = t->te_tmplen - 1;
    xted->xte_scroll = 0;

    t->te_tmplen = len+1;
    t->te_ptmplt = NULL;
    t->te_pvalid = (void *) xted;
  }
  t->te_txtlen = t->te_tmplen;
}
</pre>
<p>Querverweis: <a href="008.html">AES</a> &nbsp; <a href="00b006.html">Eingabefelder in MagiC</a> &nbsp; <a href="002002.html">GEM</a> &nbsp; <a href="008016.html#TEDINFO">TEDINFO</a></p>

<hr>

<a id="UDO_nav_hm_FOOT" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a><a id="UDO_nav_up_FOOT" href="00b.html"><img src="udo_up.gif" alt="MagiC" title="MagiC" border="0" width="24" height="24"></a><a id="UDO_nav_lf_FOOT" href="00b006.html"><img src="udo_lf.gif" alt="Eingabefelder in MagiC" title="Eingabefelder in MagiC" border="0" width="24" height="24"></a><a id="UDO_nav_rg_FOOT" href="00b008.html"><img src="udo_rg.gif" alt="Spezielle Fehlermeldungen von MagiC" title="Spezielle Fehlermeldungen von MagiC" border="0" width="24" height="24"></a></body>
</html>
