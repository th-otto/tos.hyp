<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html lang="de">
<head>
<title>
Die Anleitung zum TOS: Shellfunktionen
</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Content-Language" content="de">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="Generator" content="UDO 7.04 (1296) for Linux">
</head>
<body>
<? include "/var/www/banner.php"; ?>

<a id="UDO_nav_hm_HEAD" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a><a id="UDO_nav_up_HEAD" href="008.html"><img src="udo_up.gif" alt="AES" title="AES" border="0" width="24" height="24"></a><a id="UDO_nav_lf_HEAD" href="008011.html"><img src="udo_lf.gif" alt="Resourcefunktionen" title="Resourcefunktionen" border="0" width="24" height="24"></a><a id="UDO_nav_rg_HEAD" href="008013.html"><img src="udo_rg.gif" alt="Erweiterte Grafikfunktionen" title="Erweiterte Grafikfunktionen" border="0" width="24" height="24"></a>
<hr>

<h1><a name="Shellfunktionen"></a>8.18 Shellfunktionen</h1>
<p>Diese Bibliothek enthält Funktionen um Informationen aus der
Programmumgebung zu lesen bzw. in diese zu schreiben; außerdem kann
hierüber der Start anderer <a href="002002.html">GEM</a>-Programme übernommen werden.
Insgesamt stehen die folgenden Routinen zur Verfügung:</p>

<table>
<tr><td nowrap="nowrap" valign="top">• <a href="#shel_envrn">shel_envrn</a></td>
<td valign="top">Environment-Variable abfragen</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#shel_find">shel_find</a></td>
<td valign="top">Datei suchen</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#shel_get">shel_get</a></td>
<td valign="top">Aus dem Environment-Puffer lesen</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#shel_help">shel_help</a></td>
<td valign="top">Ausgabe von Hilfetexten</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#shel_put">shel_put</a></td>
<td valign="top">In den Environment-Puffer schreiben</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#shel_rdef">shel_rdef</a></td>
<td valign="top">Abfragen des Default-Programms</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#shel_read">shel_read</a></td>
<td valign="top">Kommandozeilenparameter lesen</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#shel_wdef">shel_wdef</a></td>
<td valign="top">Setzen des Default-Programms</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#shel_write">shel_write</a></td>
<td valign="top">Applikation starten

</td></tr>
</table>

<p><b>Hinweis:</b> Eine besondere Beachtung hat dabei <a href="#shel_write">shel_write</a>
verdient, welches ab AES-Version 4.0 (bzw. <a href="00b.html">MagiC</a> 3) viele weitere
nützliche Dinge wie ein Herunterfahren des Systems (Shut-Down),
<a href="008012.html#Aufl_C3_B6sungswechsel">Auflösungswechsel</a>, AES-Broadcasting usw. zur Verfügung stellt.</p>

<p>Querverweis: <a href="008.html">AES</a> &nbsp; <a href="00a002.html">Style-Guidelines</a></p>

<h3><a name="shel_envrn"></a>8.18.1 shel_envrn</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Shell environment« - ermittelt den Wert von
Environmentvariablen.</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="008.html">AES</a>-Nummer:</td>
<td valign="top">125</td></tr>

<tr><td nowrap="nowrap" valign="top">Deklaration:</td>
<td valign="top">int16_t shel_envrn ( int8_t **sh_epvalue, int8_t *sh_eparm );</td></tr>

<tr><td nowrap="nowrap" valign="top">Beschreibung:</td>
<td valign="top">Die Funktion ermittelt den Wert einer beliebigen
Environmentvariablen des <a href="008.html">AES</a>. Es gilt:<table>
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top">Bedeutung</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_epvalue</td>
<td valign="top">Name der Environment-Variablen</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_eparm</td>
<td valign="top">enthält nach dem Aufruf den Wert der entsprechenen Variablen

</td></tr>
</table>

<br><br>

<b>Hinweis:</b> Um das AES-Environment zu ändern sollte man
sich in den <a href="003004.html#exec_os">exec_os</a>-Vektor einklinken, über den auch das <a href="002002.html">GEM</a>
gestartet wird. In der aufgerufenen Routine liegt (analog zu einem
Programm) der Basepage-Zeiger auf dem Stack. In diese Basepage kann
dann einfach ein Zeiger auf das neue Environment eingetragen werden.
Aber Achtung: In AES-Versionen kleiner als 1.4 werden nur die
ersten 50 Bytes übernommen.<br><br>

<b>Noch ein Tip:</b> Wenn der für 'PATH=' zurückgelieferte
Zeiger auf ein Nullbyte verweist, sollte man ihn um den Wert 1
erhöhen, um an das richtige Ergebnis zu gelangen.</td></tr>

<tr><td nowrap="nowrap" valign="top">Ergebnis:</td>
<td valign="top">Die Funktion liefert als Ergebnis immer 1.</td></tr>

<tr><td nowrap="nowrap" valign="top">Verfügbar:</td>
<td valign="top">All AES versions.</td></tr>

<tr><td nowrap="nowrap" valign="top">Gruppe:</td>
<td valign="top"><a href="#Shellfunktionen">Shell-Kommunikation</a></td></tr>

<tr><td nowrap="nowrap" valign="top">Querverweis:</td>
<td valign="top"><a href="#Bindings_20f_C3_BCr_20shel_envrn">Binding</a>

</td></tr>
</table>

<h4><a name="Bindings_20f_C3_BCr_20shel_envrn"></a>8.18.1.1 Bindings für shel_envrn</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int16_t <a href="#shel_envrn">shel_envrn</a> ( int8_t **sh_epvalue, int8_t *sh_eparm );</td></tr>

<tr><td nowrap="nowrap" valign="top">Umsetzung:</td>
<td valign="top"><pre>int16_t <a href="#shel_envrn">shel_envrn</a> (int8_t **sh_epvalue, int8_t *sh_eparm)
{
   <a href="008002.html#addr_in">addr_in</a>[0] = sh_epvalue;
   <a href="008002.html#addr_in">addr_in</a>[1] = sh_eparm;

   return ( <a href="008002.html#crys_if">crys_if</a>(125) );
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="002002.html">GEM</a>-Arrays:</td>
<td valign="top"><br><br>


<div align="left">
<table border="0">
<tr>
  <td align="left" valign="top">Adresse</td>
  <td align="left" valign="top">Feldelement</td>
  <td align="left" valign="top">Belegung</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a></td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[0]</td>
  <td align="left" valign="top">125   # Opcode der Funktion</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+2</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[1]</td>
  <td align="left" valign="top">0     # Einträge in <a href="008002.html#int_in">int_in</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+4</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[2]</td>
  <td align="left" valign="top">1     # Einträge in <a href="008002.html#int_out">int_out</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+6</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[3]</td>
  <td align="left" valign="top">2     # Einträge in <a href="008002.html#addr_in">addr_in</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+8</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[4]</td>
  <td align="left" valign="top">0     # Einträge in <a href="008002.html#addr_out">addr_out</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a></td>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a>[0]</td>
  <td align="left" valign="top">sh_epvalue</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a></td>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a>[1]</td>
  <td align="left" valign="top">sh_eparm</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#int_out">int_out</a></td>
  <td align="left" valign="top"><a href="008002.html#int_out">int_out</a>[0]</td>
  <td align="left" valign="top"><a href="VT_52_terminal.html#Return">Return</a>-Wert</td>
</tr>
</table>
</div>



</td></tr>
</table>

<h3><a name="shel_find"></a>8.18.2 shel_find</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Shell find« - sucht Dateien.</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="008.html">AES</a>-Nummer:</td>
<td valign="top">124</td></tr>

<tr><td nowrap="nowrap" valign="top">Deklaration:</td>
<td valign="top">int16_t shel_find ( int8_t *sh_fpbuff );</td></tr>

<tr><td nowrap="nowrap" valign="top">Beschreibung:</td>
<td valign="top">Die Funktion sucht eine Datei in bestimmten Verzeichnissen. Der
Parameter <i>sh_fpbuff</i> enthält den Namen der gesuchten Datei.
Nach dem Aufruf der Funktion wird hier der Zugriffspfad auf die Datei
abgelegt.<br><br>

<b>Hinweis:</b> Die Datei wird in den folgenden Verzeichnissen
gesucht:<ul>
<li>im aktuellen Verzeichnis</li>
<li>im Wurzelverzeichnis</li>
<li>in allen Verzeichnissen, die in der Variable PATH des
<a href="008.html">AES</a>-Environments angegeben sind</li>
<li>in dem Pfad, in welchem sich das Programm z.Zt. befindet (ab
<a href="002.html">TOS</a>-Version 1.04)</li>
</ul>

<br><br>

Die Funktion wird auch von <a href="008011.html#rsrc_load">rsrc_load</a> benutzt, um die
Resource-Datei zu lokalisieren.</td></tr>

<tr><td nowrap="nowrap" valign="top">Ergebnis:</td>
<td valign="top">Ein Rückgabewert von Null signalisiert, daß die angegebene
Datei nicht gefunden wurde.</td></tr>

<tr><td nowrap="nowrap" valign="top">Verfügbar:</td>
<td valign="top">All AES versions.</td></tr>

<tr><td nowrap="nowrap" valign="top">Gruppe:</td>
<td valign="top"><a href="#Shellfunktionen">Shell-Kommunikation</a></td></tr>

<tr><td nowrap="nowrap" valign="top">Querverweis:</td>
<td valign="top"><a href="#Bindings_20f_C3_BCr_20shel_find">Binding</a> &nbsp; <a href="#shel_envrn">shel_envrn</a>

</td></tr>
</table>

<h4><a name="Bindings_20f_C3_BCr_20shel_find"></a>8.18.2.1 Bindings für shel_find</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int16_t <a href="#shel_find">shel_find</a> ( int8_t *sh_fpbuff );</td></tr>

<tr><td nowrap="nowrap" valign="top">Umsetzung:</td>
<td valign="top"><pre>int16_t <a href="#shel_find">shel_find</a> (int8_t *sh_fpbuff)
{
   <a href="008002.html#addr_in">addr_in</a>[0] = sh_fpbuff;
   return ( <a href="008002.html#crys_if">crys_if</a>(124) );
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="002002.html">GEM</a>-Arrays:</td>
<td valign="top"><br><br>


<div align="left">
<table border="0">
<tr>
  <td align="left" valign="top">Adresse</td>
  <td align="left" valign="top">Feldelement</td>
  <td align="left" valign="top">Belegung</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a></td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[0]</td>
  <td align="left" valign="top">124   # Opcode der Funktion</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+2</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[1]</td>
  <td align="left" valign="top">0     # Einträge in <a href="008002.html#int_in">int_in</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+4</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[2]</td>
  <td align="left" valign="top">1     # Einträge in <a href="008002.html#int_out">int_out</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+6</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[3]</td>
  <td align="left" valign="top">1     # Einträge in <a href="008002.html#addr_in">addr_in</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+8</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[4]</td>
  <td align="left" valign="top">0     # Einträge in <a href="008002.html#addr_out">addr_out</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a></td>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a>[0]</td>
  <td align="left" valign="top">sh_fpbuff</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#int_out">int_out</a></td>
  <td align="left" valign="top"><a href="008002.html#int_out">int_out</a>[0]</td>
  <td align="left" valign="top"><a href="VT_52_terminal.html#Return">Return</a>-Wert</td>
</tr>
</table>
</div>



</td></tr>
</table>

<h3><a name="shel_get"></a>8.18.3 shel_get</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Shell get« - liest den <a href="002002.html">GEM</a>-Environment-Puffer.</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="008.html">AES</a>-Nummer:</td>
<td valign="top">122</td></tr>

<tr><td nowrap="nowrap" valign="top">Deklaration:</td>
<td valign="top">int16_t shel_get ( int8_t *sh_gaddr, uint16_t sh_glen );</td></tr>

<tr><td nowrap="nowrap" valign="top">Beschreibung:</td>
<td valign="top">Die Funktion dient zum Lesen von Zeichen aus dem internen
Environment-Speicher des <a href="008.html">AES</a>. Es gilt:<table>
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top">Bedeutung</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_gaddr</td>
<td valign="top">Adresse des Zielspeichers</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_glen</td>
<td valign="top">Anzahl der zu lesenden Bytes oder Wert -1, um die Länge des
Speichers zu ermitteln.

</td></tr>
</table>

<br><br>

<b>Hinweis:</b> Das Desktop nutzt diesen Speicher zur
Aufbewahrung der DESKTOP.INF bzw. NEWDESK.INF Datei. Das Format dieser
Dateien ist allerdings <i>nicht</i> offiziell dokumentiert. Eine
aktuelle Beschreibung findet sich jedoch in newdesk.hyp.<br><br>

Unter <a href="00b.html">MagiC</a> werden beim Start des AES alle Daten in den Puffer
kopiert, die nach der Zeile <a href="00b00c.html#_23_CTR">#_CTR</a> in MAGX.INF liegen. Die zulässige
Länge des Puffers liegt seit MagiC 3 zwischen 4192 und 65534 Bytes.
Das Vorhandensein der zusätzlichen Features kann per <a href="Application.html#_25apgi_6">appl_getinfo</a> (Opcode
6) abgefragt werden.</td></tr>

<tr><td nowrap="nowrap" valign="top">Ergebnis:</td>
<td valign="top">Ein Rückgabewert von Null signalisiert einen Fehler.</td></tr>

<tr><td nowrap="nowrap" valign="top">Verfügbar:</td>
<td valign="top">All AES versions.</td></tr>

<tr><td nowrap="nowrap" valign="top">Gruppe:</td>
<td valign="top"><a href="#Shellfunktionen">Shell-Kommunikation</a></td></tr>

<tr><td nowrap="nowrap" valign="top">Querverweis:</td>
<td valign="top"><a href="#Bindings_20f_C3_BCr_20shel_get">Binding</a> &nbsp; <a href="#shel_put">shel_put</a>

</td></tr>
</table>

<h4><a name="Bindings_20f_C3_BCr_20shel_get"></a>8.18.3.1 Bindings für shel_get</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int16_t <a href="#shel_get">shel_get</a> ( int8_t *sh_gaddr, uint16_t sh_glen );</td></tr>

<tr><td nowrap="nowrap" valign="top">Umsetzung:</td>
<td valign="top"><pre>int16_t <a href="#shel_get">shel_get</a> (int8_t *sh_gaddr, uint16_t sh_glen)
{
   <a href="008002.html#int_in">int_in</a>[0]  = sh_glen;
   <a href="008002.html#addr_in">addr_in</a>[0] = sh_gaddr;

   return ( <a href="008002.html#crys_if">crys_if</a>(122) );
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="002002.html">GEM</a>-Arrays:</td>
<td valign="top"><br><br>


<div align="left">
<table border="0">
<tr>
  <td align="left" valign="top">Adresse</td>
  <td align="left" valign="top">Feldelement</td>
  <td align="left" valign="top">Belegung</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a></td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[0]</td>
  <td align="left" valign="top">122   # Opcode der Funktion</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+2</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[1]</td>
  <td align="left" valign="top">1     # Einträge in <a href="008002.html#int_in">int_in</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+4</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[2]</td>
  <td align="left" valign="top">1     # Einträge in <a href="008002.html#int_out">int_out</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+6</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[3]</td>
  <td align="left" valign="top">1     # Einträge in <a href="008002.html#addr_in">addr_in</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+8</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[4]</td>
  <td align="left" valign="top">0     # Einträge in <a href="008002.html#addr_out">addr_out</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#int_in">int_in</a></td>
  <td align="left" valign="top"><a href="008002.html#int_in">int_in</a>[0]</td>
  <td align="left" valign="top">sh_glen</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a></td>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a>[0]</td>
  <td align="left" valign="top">sh_gaddr</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#int_out">int_out</a></td>
  <td align="left" valign="top"><a href="008002.html#int_out">int_out</a>[0]</td>
  <td align="left" valign="top"><a href="VT_52_terminal.html#Return">Return</a>-Wert</td>
</tr>
</table>
</div>



</td></tr>
</table>

<h3><a name="shel_help"></a>8.18.4 shel_help</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">Ausgabe von Hilfetexten.</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="008.html">AES</a>-Nummer:</td>
<td valign="top">128</td></tr>

<tr><td nowrap="nowrap" valign="top">Deklaration:</td>
<td valign="top">int16_t shel_help ( int16_t sh_hmode, int8_t *sh_hfile, int8_t
*sh_hkey);</td></tr>

<tr><td nowrap="nowrap" valign="top">Beschreibung:</td>
<td valign="top">Die Funktion dient zur Ausgabe von Hilfetexten (Online-Hilfe)
über einen Help-Server.<table>
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top">Bedeutung<a name="SHP_HELP"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_hmode</td>
<td valign="top">Hierfür ist im Moment immer SHP_HELP(=0) zu übergeben.</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_hfile</td>
<td valign="top">Name der Hilfedatei.<br><br>

Wird sie inklusive einer Extension übergeben, so wird anhand
dieser Extension der entsprechende Server in der Liste der Helpserver
aufgesucht.<br><br>

Hat die übergebene Datei keine Extension, so wird automatisch die
des ersten in der CNF-Datei definierten Helpservers angehängt.</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_hkey</td>
<td valign="top">Schlüsselwort, zu welchem ein Hilfetext ausgegeben werden
soll, oder NULL.

</td></tr>
</table>

<br><br>

Bei einem Aufruf von shel_help mit einer Datei, welche eine
Extension hat, prüft <a href="008002.html#N.AES">N.AES</a>, ob ein Helpserver für diese Extension
(mittels 'helpserver') definiert wurde. Wird ein passender Server
gefunden, so wird geprüft, ob dieser bereits aktiv ist (als Accessory
oder auch als nebenläufig gestartete Anwendung). Ist dies der Fall,
so wird dem Server die Mitteilung <a href="00f001.html#VA_START">VA_START</a> mit den bei
<i>sh_hfile</i> und <i>sh_hkey</i> angegebenen Argumenten als
Kommandozeile zugesendet.<br><br>

Ist der Server nicht aktiv, so wird er automatisch gestartet, wenn
bei seiner Definition mit Hilfe von 'helpserver' ein Pfad für ihn
angegeben wurde. Als Kommandozeile wird ihm dabei die bei
<i>sh_hfile</i> und <i>sh_hkey</i> angegebenen Argumente übergeben.</td></tr>

<tr><td nowrap="nowrap" valign="top">Ergebnis:</td>
<td valign="top">Ein Rückgabewert von Null signalisiert einen Fehler.</td></tr>

<tr><td nowrap="nowrap" valign="top">Verfügbar:</td>
<td valign="top">Das Vorhandensein dieser Funktion kann per <a href="Application.html#_25apgi_65">appl_getinfo</a> (Opcode 65)
festgestellt werden.<br><br>

Neben <a href="008002.html#N.AES">N.AES</a> gibt es eine TSR welches diese Funktion auf anderen
Systemen zur Verfügung stellt.</td></tr>

<tr><td nowrap="nowrap" valign="top">Gruppe:</td>
<td valign="top"><a href="#Shellfunktionen">Shell-Kommunikation</a></td></tr>

<tr><td nowrap="nowrap" valign="top">Querverweis:</td>
<td valign="top"><a href="#Bindings_20f_C3_BCr_20shel_help">Binding</a>

</td></tr>
</table>

<h4><a name="Bindings_20f_C3_BCr_20shel_help"></a>8.18.4.1 Bindings für shel_help</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int16_t <a href="#shel_help">shel_help</a> ( int16_t sh_hmode, int8_t *sh_hfile, int8_t
*sh_hkey);</td></tr>

<tr><td nowrap="nowrap" valign="top">Umsetzung:</td>
<td valign="top"><pre>int16_t <a href="#shel_help">shel_help</a> ( int16_t sh_hmode, int8_t *sh_hfile,
                    int8_t *sh_hkey)
{
   <a href="008002.html#int_in">int_in</a>[0] = sh_hmode;
   <a href="008002.html#addr_in">addr_in</a>[0] = sh_hfile;
   <a href="008002.html#addr_in">addr_in</a>[1] = sh_hkey;

   <a href="008002.html#crys_if">crys_if</a>(128);

   return = <a href="008002.html#int_out">int_out</a>[0];
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="002002.html">GEM</a>-Arrays:</td>
<td valign="top"><br><br>


<div align="left">
<table border="0">
<tr>
  <td align="left" valign="top">Adresse</td>
  <td align="left" valign="top">Feldelement</td>
  <td align="left" valign="top">Belegung</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a></td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[0]</td>
  <td align="left" valign="top">128   # Opcode der Funktion</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+2</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[1]</td>
  <td align="left" valign="top">1     # Einträge in <a href="008002.html#int_in">int_in</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+4</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[2]</td>
  <td align="left" valign="top">1     # Einträge in <a href="008002.html#int_out">int_out</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+6</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[3]</td>
  <td align="left" valign="top">2     # Einträge in <a href="008002.html#addr_in">addr_in</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+8</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[4]</td>
  <td align="left" valign="top">0     # Einträge in <a href="008002.html#addr_out">addr_out</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#int_in">int_in</a></td>
  <td align="left" valign="top"><a href="008002.html#int_in">int_in</a>[0]</td>
  <td align="left" valign="top">sh_hmode</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a></td>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a>[0]</td>
  <td align="left" valign="top">sh_hfile</td>
</tr>
<tr>
  <td align="left" valign="top">addr_1n+4</td>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a>[1]</td>
  <td align="left" valign="top">sh_hkey</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#int_out">int_out</a></td>
  <td align="left" valign="top"><a href="008002.html#int_out">int_out</a>[0]</td>
  <td align="left" valign="top"><a href="VT_52_terminal.html#Return">Return</a>-Wert</td>
</tr>
</table>
</div>



</td></tr>
</table>

<h3><a name="shel_put"></a>8.18.5 shel_put</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Shell put« - schreibt in den <a href="002002.html">GEM</a>-Environment-Puffer.</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="008.html">AES</a>-Nummer:</td>
<td valign="top">123</td></tr>

<tr><td nowrap="nowrap" valign="top">Deklaration:</td>
<td valign="top">int16_t shel_put ( int8_t *sh_paddr, uint16_t sh_plen );</td></tr>

<tr><td nowrap="nowrap" valign="top">Beschreibung:</td>
<td valign="top">Die Funktion schreibt in den Environment-Speicher des <a href="008.html">AES</a>. Es
gilt:<br><br>


<div align="left">
<table border="0">
<tr>
  <td align="left" valign="top">Parameter</td>
  <td align="left" valign="top">Bedeutung</td>
</tr>
<tr>
  <td align="left" valign="top"><i>sh_paddr</i></td>
  <td align="left" valign="top">Adresse des Quellpuffers</td>
</tr>
<tr>
  <td align="left" valign="top"><i>sh_plen</i></td>
  <td align="left" valign="top">Anzahl der zu schreibenden Zeichen</td>
</tr>
</table>
</div>

<br><br>

<b>Hinweis:</b> Das Desktop nutzt diesen Speicher zur
Aufbewahrung der DESKTOP.INF bzw. NEWDESK.INF Datei. Das Format dieser
Dateien ist allerdings <i>nicht</i> offiziell dokumentiert. Eine
aktuelle Beschreibung findet sich jedoch in newdesk.hyp.<br><br>

Die zulässige Länge des Puffers liegt seit <a href="00b.html">MagiC</a> 3 zwischen 4192
und 65534 Bytes, während sie in ganz alten <a href="002.html">TOS</a>-Versionen noch bei
1024 Bytes lag.<br><br>

Prior to <a href="008.html">AES</a> version 4.0 this function would only copy as many
bytes as would fit into the current buffer. As of version 4.0, the <a href="008.html">AES</a>
will dynamically allocate more memory as needed (up to 32767 bytes)
for the shell buffer.</td></tr>

<tr><td nowrap="nowrap" valign="top">Ergebnis:</td>
<td valign="top">Ein Rückgabewert von Null signalisiert einen Fehler.</td></tr>

<tr><td nowrap="nowrap" valign="top">Verfügbar:</td>
<td valign="top">All AES versions.</td></tr>

<tr><td nowrap="nowrap" valign="top">Gruppe:</td>
<td valign="top"><a href="#Shellfunktionen">Shell-Kommunikation</a></td></tr>

<tr><td nowrap="nowrap" valign="top">Querverweis:</td>
<td valign="top"><a href="#Bindings_20f_C3_BCr_20shel_put">Binding</a> &nbsp; <a href="#shel_get">shel_get</a> &nbsp; <a href="#shel_envrn">shel_envrn</a> &nbsp; <a href="#shel_find">shel_find</a>

</td></tr>
</table>

<h4><a name="Bindings_20f_C3_BCr_20shel_put"></a>8.18.5.1 Bindings für shel_put</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int16_t <a href="#shel_put">shel_put</a> ( int8_t *sh_paddr, uint16_t sh_plen );</td></tr>

<tr><td nowrap="nowrap" valign="top">Umsetzung:</td>
<td valign="top"><pre>int16_t <a href="#shel_put">shel_put</a> (int8_t *sh_paddr, uint16_t sh_plen)
{
   <a href="008002.html#int_in">int_in</a>[0]  = sh_plen;
   <a href="008002.html#addr_in">addr_in</a>[0] = sh_paddr;

   return ( <a href="008002.html#crys_if">crys_if</a>(123) );
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="002002.html">GEM</a>-Arrays:</td>
<td valign="top"><br><br>


<div align="left">
<table border="0">
<tr>
  <td align="left" valign="top">Adresse</td>
  <td align="left" valign="top">Feldelement</td>
  <td align="left" valign="top">Belegung</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a></td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[0]</td>
  <td align="left" valign="top">123   # Opcode der Funktion</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+2</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[1]</td>
  <td align="left" valign="top">1     # Einträge in <a href="008002.html#int_in">int_in</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+4</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[2]</td>
  <td align="left" valign="top">1     # Einträge in <a href="008002.html#int_out">int_out</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+6</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[3]</td>
  <td align="left" valign="top">1     # Einträge in <a href="008002.html#addr_in">addr_in</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+8</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[4]</td>
  <td align="left" valign="top">0     # Einträge in <a href="008002.html#addr_out">addr_out</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#int_in">int_in</a></td>
  <td align="left" valign="top"><a href="008002.html#int_in">int_in</a>[0]</td>
  <td align="left" valign="top">sh_plen</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a></td>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a>[0]</td>
  <td align="left" valign="top">sh_paddr</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#int_out">int_out</a></td>
  <td align="left" valign="top"><a href="008002.html#int_out">int_out</a>[0]</td>
  <td align="left" valign="top"><a href="VT_52_terminal.html#Return">Return</a>-Wert</td>
</tr>
</table>
</div>



</td></tr>
</table>

<h3><a name="shel_rdef"></a>8.18.6 shel_rdef</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Shell read default« - Default Programm abfragen</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="008.html">AES</a>-Nummer:</td>
<td valign="top">126</td></tr>

<tr><td nowrap="nowrap" valign="top">Deklaration:</td>
<td valign="top">int16_t shel_rdef ( int8_t *lpcmd, int8_t *lpdir );</td></tr>

<tr><td nowrap="nowrap" valign="top">Beschreibung:</td>
<td valign="top">Die Funktion erlaubt es, das Programm zu erfragen, welches nach
Beendigung des aktuellen gestartet wird (i.d.R. der Desktop).<table>
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top">Bedeutung</td></tr>

<tr><td nowrap="nowrap" valign="top">lpcmd</td>
<td valign="top">Zeiger auf einen ausreichend dimensionierten String für den
Namen der Applikation.</td></tr>

<tr><td nowrap="nowrap" valign="top">lpdir</td>
<td valign="top">Zeiger auf einen ausreichend dimensionierten String für den
Pfad der Applikation.

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Ergebnis:</td>
<td valign="top">Der Rückgabewert ist z.Zt. nicht bekannt.</td></tr>

<tr><td nowrap="nowrap" valign="top">Verfügbar:</td>
<td valign="top">Unter PC-<a href="002002.html">GEM</a> steht die Funktion ab Version 2.0 zur Verfügung.
Ansonsten in KAOS 1.4.2 und <a href="00b.html">MagiC</a>. Das Vorhandensein dieser Funktion
kann per <a href="Application.html#_25apgi_5">appl_getinfo</a> (Opcode 5) festgestellt werden.</td></tr>

<tr><td nowrap="nowrap" valign="top">Gruppe:</td>
<td valign="top"><a href="#Shellfunktionen">Shell-Kommunikation</a></td></tr>

<tr><td nowrap="nowrap" valign="top">Querverweis:</td>
<td valign="top"><a href="#Bindings_20f_C3_BCr_20shel_rdef">Binding</a> &nbsp; <a href="#shel_wdef">shel_wdef</a> &nbsp; <a href="00b.html">MagiC</a>

</td></tr>
</table>

<h4><a name="Bindings_20f_C3_BCr_20shel_rdef"></a>8.18.6.1 Bindings für shel_rdef</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int16_t <a href="#shel_rdef">shel_rdef</a> ( int8_t *lpcmd, int8_t *lpdir );</td></tr>

<tr><td nowrap="nowrap" valign="top">Umsetzung:</td>
<td valign="top"><pre>int16_t <a href="#shel_rdef">shel_rdef</a> (int8_t *lpcmd, int8_t *lpdir)
{
   <a href="008002.html#addr_in">addr_in</a>[0] = lpcmd;
   <a href="008002.html#addr_in">addr_in</a>[1] = lpdir;

   return ( <a href="008002.html#crys_if">crys_if</a>(126) );
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="002002.html">GEM</a>-Arrays:</td>
<td valign="top"><br><br>


<div align="left">
<table border="0">
<tr>
  <td align="left" valign="top">Adresse</td>
  <td align="left" valign="top">Feldelement</td>
  <td align="left" valign="top">Belegung</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a></td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[0]</td>
  <td align="left" valign="top">126   # Opcode der Funktion</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+2</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[1]</td>
  <td align="left" valign="top">0     # Einträge in <a href="008002.html#int_in">int_in</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+4</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[2]</td>
  <td align="left" valign="top">1     # Einträge in <a href="008002.html#int_out">int_out</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+6</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[3]</td>
  <td align="left" valign="top">2     # Einträge in <a href="008002.html#addr_in">addr_in</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+8</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[4]</td>
  <td align="left" valign="top">0     # Einträge in <a href="008002.html#addr_out">addr_out</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a></td>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a>[0]</td>
  <td align="left" valign="top">lpcmd</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a>+4</td>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a>[1]</td>
  <td align="left" valign="top">lpdir</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#int_out">int_out</a></td>
  <td align="left" valign="top"><a href="008002.html#int_out">int_out</a>[0]</td>
  <td align="left" valign="top"><a href="VT_52_terminal.html#Return">Return</a>-Wert</td>
</tr>
</table>
</div>



</td></tr>
</table>

<h3><a name="shel_read"></a>8.18.7 shel_read</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Shell read« - liest die Kommandozeilen-Parameter der
Applikation.</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="008.html">AES</a>-Nummer:</td>
<td valign="top">120</td></tr>

<tr><td nowrap="nowrap" valign="top">Deklaration:</td>
<td valign="top">int16_t shel_read ( int8_t *sh_rpcmd, int8_t *sh_rptail );</td></tr>

<tr><td nowrap="nowrap" valign="top">Beschreibung:</td>
<td valign="top">Die Funktion ermittelt den Namen und die Kommandozeile, mit der
eine Applikation gestartet wurde. Es gilt:<table>
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top">Bedeutung</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_rpcmd</td>
<td valign="top">vollständiger Pfadname mit Programmname</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_rptail</td>
<td valign="top">Kommandozeile (gemäß <a href="00500b.html#Pexec">Pexec</a>, also nullterminiert und mit
Längenangaben im ersten Byte)

</td></tr>
</table>

<br><br>

<b>Hinweis:</b> Die Funktion arbeitet nur dann korrekt, wenn die
Applikation per <a href="#shel_write">shel_write</a> gestartet worden ist. Daher sollte man im
Zweifelsfall auf die Werte der Basepage zurückgreifen.</td></tr>

<tr><td nowrap="nowrap" valign="top">Ergebnis:</td>
<td valign="top">Ein Fehler ist nur dann aufgetreten, wenn als Ergebnis 0
zurückgegeben wird.</td></tr>

<tr><td nowrap="nowrap" valign="top">Verfügbar:</td>
<td valign="top">All AES versions.</td></tr>

<tr><td nowrap="nowrap" valign="top">Gruppe:</td>
<td valign="top"><a href="#Shellfunktionen">Shell-Kommunikation</a></td></tr>

<tr><td nowrap="nowrap" valign="top">Querverweis:</td>
<td valign="top"><a href="#Bindings_20f_C3_BCr_20shel_read">Binding</a> &nbsp; <a href="#shel_write">shel_write</a> &nbsp; <a href="00500b.html#Pexec">Pexec</a>

</td></tr>
</table>

<h4><a name="Bindings_20f_C3_BCr_20shel_read"></a>8.18.7.1 Bindings für shel_read</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int16_t <a href="#shel_read">shel_read</a> ( int8_t *sh_rpcmd, int8_t *sh_rptail );</td></tr>

<tr><td nowrap="nowrap" valign="top">Umsetzung:</td>
<td valign="top"><pre>int16_t <a href="#shel_read">shel_read</a> (int8_t *sh_rpcmd, int8_t *sh_rptail)
{
   <a href="008002.html#addr_in">addr_in</a>[0] = sh_rpcmd;
   <a href="008002.html#addr_in">addr_in</a>[1] = sh_rptail;

   return ( <a href="008002.html#crys_if">crys_if</a>(120) );
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="002002.html">GEM</a>-Arrays:</td>
<td valign="top"><br><br>


<div align="left">
<table border="0">
<tr>
  <td align="left" valign="top">Adresse</td>
  <td align="left" valign="top">Feldelement</td>
  <td align="left" valign="top">Belegung</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a></td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[0]</td>
  <td align="left" valign="top">120   # Opcode der Funktion</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+2</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[1]</td>
  <td align="left" valign="top">0     # Einträge in <a href="008002.html#int_in">int_in</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+4</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[2]</td>
  <td align="left" valign="top">1     # Einträge in <a href="008002.html#int_out">int_out</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+6</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[3]</td>
  <td align="left" valign="top">2     # Einträge in <a href="008002.html#addr_in">addr_in</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+8</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[4]</td>
  <td align="left" valign="top">0     # Einträge in <a href="008002.html#addr_out">addr_out</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a></td>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a>[0]</td>
  <td align="left" valign="top">sh_rpcmd</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a>+4</td>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a>[1]</td>
  <td align="left" valign="top">sh_rptail</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#int_out">int_out</a></td>
  <td align="left" valign="top"><a href="008002.html#int_out">int_out</a>[0]</td>
  <td align="left" valign="top"><a href="VT_52_terminal.html#Return">Return</a>-Wert</td>
</tr>
</table>
</div>



</td></tr>
</table>

<h3><a name="shel_wdef"></a>8.18.8 shel_wdef</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Shell write default« - Default Programm setzen</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="008.html">AES</a>-Nummer:</td>
<td valign="top">127</td></tr>

<tr><td nowrap="nowrap" valign="top">Deklaration:</td>
<td valign="top">int16_t shel_wdef( int8_t *lpcmd, int8_t *lpdir );</td></tr>

<tr><td nowrap="nowrap" valign="top">Beschreibung:</td>
<td valign="top">Die Funktion erlaubt es, die Applikation festzulegen, welche
als Default-Programm anzusehen ist (normalerweise der Desktop).<br><br>

<b>Hinweis zu MagiC:</b> Sind die Parameter <i>lpcmd</i> und
<i>lpdir</i> Leerstrings, so wird MAGXDESK wieder installiert. Ein
alternatives Desktop macht zum Programmstart einfach ein <a href="#shel_write">shel_write</a>,
und beendet sich dann per <a href="00500b.html#Pterm0">Pterm0</a> es bekommt von <a href="00b.html">MagiC</a> eine
Kommandozeile (<a href="008016.html#SHELTAIL">SHELTAIL</a>), die per <a href="#shel_read">shel_read</a> ermittelt werden kann.
Gibt die Shell einen negativen Fehlercode zurück, so wird MAGXDESK
aktiviert.<br><br>

<b>Hinweis zu <a href="008002.html#N.AES">N.AES</a>:</b> Sind die Parameter <i>lpcmd</i>
und/oder <i>lpdir</i> Leerstrings oder NULL, wird die in <a href="00c003.html#N_AES.CNF">N_AES.CNF</a>
angegebene 'shell' Applikation gestartet.</td></tr>

<tr><td nowrap="nowrap" valign="top">Ergebnis:</td>
<td valign="top">Der Rückgabewert ist z.Zt. nicht bekannt.</td></tr>

<tr><td nowrap="nowrap" valign="top">Verfügbar:</td>
<td valign="top">Unter PC-<a href="002002.html">GEM</a> steht die Funktion ab Version 2.0 zur Verfügung.
Ansonsten in KAOS 1.4.2 und <a href="00b.html">MagiC</a>. Das Vorhandensein dieser Funktion
kann per <a href="Application.html#_25apgi_5">appl_getinfo</a> (Opcode 5) festgestellt werden.</td></tr>

<tr><td nowrap="nowrap" valign="top">Gruppe:</td>
<td valign="top"><a href="#Shellfunktionen">Shell-Kommunikation</a></td></tr>

<tr><td nowrap="nowrap" valign="top">Querverweis:</td>
<td valign="top"><a href="#Bindings_20f_C3_BCr_20shel_wdef">Binding</a> &nbsp; <a href="#shel_rdef">shel_rdef</a> &nbsp; <a href="00b.html">MagiC</a>

</td></tr>
</table>

<h4><a name="Bindings_20f_C3_BCr_20shel_wdef"></a>8.18.8.1 Bindings für shel_wdef</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int16_t <a href="#shel_wdef">shel_wdef</a>( int8_t *lpcmd, int8_t *lpdir );</td></tr>

<tr><td nowrap="nowrap" valign="top">Umsetzung:</td>
<td valign="top"><pre>int16_t <a href="#shel_wdef">shel_wdef</a>(int8_t *lpcmd, int8_t *lpdir)
{
   <a href="008002.html#addr_in">addr_in</a>[0] = lpcmd;
   <a href="008002.html#addr_in">addr_in</a>[1] = lpdir;

   return ( <a href="008002.html#crys_if">crys_if</a>(127) );
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="002002.html">GEM</a>-Arrays:</td>
<td valign="top"><br><br>


<div align="left">
<table border="0">
<tr>
  <td align="left" valign="top">Adresse</td>
  <td align="left" valign="top">Feldelement</td>
  <td align="left" valign="top">Belegung</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a></td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[0]</td>
  <td align="left" valign="top">127   # Opcode der Funktion</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+2</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[1]</td>
  <td align="left" valign="top">0     # Einträge in <a href="008002.html#int_in">int_in</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+4</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[2]</td>
  <td align="left" valign="top">1     # Einträge in <a href="008002.html#int_out">int_out</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+6</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[3]</td>
  <td align="left" valign="top">2     # Einträge in <a href="008002.html#addr_in">addr_in</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+8</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[4]</td>
  <td align="left" valign="top">0     # Einträge in <a href="008002.html#addr_out">addr_out</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a></td>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a>[0]</td>
  <td align="left" valign="top">lpcmd</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a>+4</td>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a>[1]</td>
  <td align="left" valign="top">lpdir</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#int_out">int_out</a></td>
  <td align="left" valign="top"><a href="008002.html#int_out">int_out</a>[0]</td>
  <td align="left" valign="top"><a href="VT_52_terminal.html#Return">Return</a>-Wert</td>
</tr>
</table>
</div>



</td></tr>
</table>

<h3><a name="shel_write"></a>8.18.9 shel_write</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Shell write« - startet eine andere Applikation.</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="008.html">AES</a>-Nummer:</td>
<td valign="top">121</td></tr>

<tr><td nowrap="nowrap" valign="top">Deklaration:</td>
<td valign="top">int16_t shel_write ( int16_t sh_wdoex, int16_t sh_wisgr,
int16_t sh_wiscr, int8_t *sh_wpcmd, int8_t *sh_wptail );</td></tr>

<tr><td nowrap="nowrap" valign="top">Beschreibung:</td>
<td valign="top">Die Funktion ermöglicht das Starten eines anderen Programms.
Ab <a href="008.html">AES</a>-Version 4.0 wurde diese Funktion stark erweitert. So lassen
sich nun auch Aufgaben wie ein Herunterfahren des Systems (<a href="00500e.html#Shutdown">Shutdown</a>),
ein Auflösungswechsel, AES-Broadcasting und andere Dinge realisieren.<br><br>

Der Parameter <i>sh_wdoex</i> bestimmt die auszuführende Aktion,
die restlichen Parameter sind im wesentlichen von <i>sh_wdoex</i>
abhängig. Es gilt:<table>
<tr><td nowrap="nowrap" valign="top"><i>sh_wdoex</i></td>
<td valign="top">Bedeutung</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">0</td>
<td valign="top"><b>Applikation starten</b>
<br>Der Wert des Parameters <i>sh_wisgr</i> (Starten im Grafikmodus,
ja oder nein) wird automatisch vom AES gesetzt, indem die
File-Extension mit den Inhalten der <a href="008.html">AES</a>-Environmentvariablen GEMEXT,
TOSEXT und ACCEXT verglichen wird.</td></tr>

<tr><td nowrap="nowrap" valign="top">1</td>
<td valign="top"> <b>Applikation im <a href="002002.html">GEM</a>/<a href="002.html">TOS</a> Modus starten</b>
<br>Der Parameter <i>sh_wisgr</i> legt dabei den Modus fest, in dem
das Programm gestartet werden soll. Es gilt:<table>
<tr><td nowrap="nowrap" valign="top">sh_wisgr = 0:</td>
<td valign="top">als <a href="002.html">TOS</a>-Programm starten</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_wisgr = 1:</td>
<td valign="top">als GEM-Programm starten
</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">2</td>
<td valign="top"><b>reserviert</b></td></tr>

<tr><td nowrap="nowrap" valign="top">3</td>
<td valign="top"><b>Accessorie starten</b>
<br>Ein Programm soll als Accessorie gestartet werden.

</td></tr>
</table>

<br><br>

In den Parametern <i>sh_wpcmd</i> und <i>sh_wptail</i> sind
dabei der Name des zu startenden Programms bzw. ein Zeiger auf die
Kommandozeile zu übergeben. Als Default-Verzeichnis wird dabei das
Verzeichnis gewählt, in dem sich das zu startende Programm befindet
(Ausnahme: erweiterter Modus mit gesetztem Bit-10, s.u.).<br><br>

Die Funktion liefert die AES-ID des gestarteten Prozesses
zurück. Ein Wert von 0 zeigt in diesem Zusammenhang einen Fehler an.
Über den Parameter <i>sh_wiscr</i> kann spezifiziert werden, ob
<b>Parameter per ARGV</b> an das gestartete Programm übergeben
werden sollen. Es gilt:<br><br>

sh_wiscr = 0: <a href="005011.html">ARGV-Verfahren</a> nicht benutzen
<br>sh_wiscr = 1: ARGV-Verfahren benutzen<a name="Paralleles_20Starten_20von_20Programmen"></a>
<br><br>

Unter <a href="00b.html">MagiC</a> kann hingegen angegeben werden, ob ein Programm im
<b>Single-Modus</b> (oder parallel) gestartet werden soll. Es gilt:<br><br>

sh_wiscr = 100: <b>Programm parallel ausführen</b>
<br>Die neue Applikation erbt alle Standardpfade und -dateien von der
aktuellen Applikation. Ein Fehlercode wird nur dann zurückgeliefert,
falls bereits beim Einrichten ein Speicherplatzmangel aufgetreten ist;
eine Benachrichtung beim Beenden der neuen Applikation
(Death-of-Child) existiert nicht (*).<a name="Single-Modus"></a>
<br><br>

sh_wiscr = 101: <b>Programm im Single-Modus ausführen</b>
<br>Dieser Modus entspricht <i>sh_wiscr</i> mit dem Wert 1, mit der
Ausnahme, daß vor Aufruf des Programms alle Applikationen außer
denjenigen mit ID-0 und ID-1 (SCRENMGR) eingefroren werden. Die
Programme werden nach Beendigung des Programms wieder aufgetaut, wenn
dieses nicht seinerseits einen neuen shel_write-Aufruf mit Singlemode
Charakter ausgeführt hat. <b>Das genaue Kochrezept für den
Single-Modus lautet:</b><ul>
<li>sicherstellen, daß man die Applikation mit ID-0 ist</li>
<li>Pfade und Laufwerk für das neue Programm setzen</li>
<li>shel_write (TRUE, sh_wisgr, 101, sh_wpcmd, sh_wptail)</li>
<li>wichtige Einstellungen in Datei/Shell-Puffer sichern</li>
<li><a href="Application.html#appl_exit">appl_exit</a>, <a href="00700a.html#v_clsvwk">v_clsvwk</a>, <a href="00500b.html#Pterm0">Pterm0</a> ausführen</li>
</ul>

<br><br>

Beachtet werden sollte noch, daß ab MagiC 2 im Single-Modus die
aktuellen Pfade des Aufrufers an den Parent und damit an das neue
Programm übergeben werden. Die Pfade des Aufrufers sind anschließend
zerstört, was aber unkritisch ist, da dieser auf den shel_write i.a.
ein <a href="00500b.html#Pterm">Pterm</a> folgen läßt (*).<br><br>

Im <b>erweiterten Modus</b>, kann über spezielle Bits des
Parameters <i>sh_wdoex</i> das Starten von Programmen weiter
spezifiziert werden. Das Low-Byte bleibt dabei unangetastet, und für
das High-Byte gilt:<br><br>


<div align="left">
<table border="0">
<tr>
  <td align="center" valign="top"><i>sh_wdoex</i> Bit</td>
  <td align="left" valign="top">Bedeutung</td>
</tr>
<tr>
  <td align="center" valign="top">8</td>
  <td align="left" valign="top">Wert von <a href="00500b.html#Psetlimit">Psetlimit</a></td>
</tr>
<tr>
  <td align="center" valign="top">9</td>
  <td align="left" valign="top">Wert von <a href="00500b.html#Prenice">Prenice</a></td>
</tr>
<tr>
  <td align="center" valign="top">10</td>
  <td align="left" valign="top">Default-Verzeichnis</td>
</tr>
<tr>
  <td align="center" valign="top">11</td>
  <td align="left" valign="top">Environment-String</td>
</tr>
<tr>
  <td align="center" valign="top">12</td>
  <td align="left" valign="top">reserviert</td>
</tr>
<tr>
  <td align="center" valign="top">13</td>
  <td align="left" valign="top">reserviert</td>
</tr>
<tr>
  <td align="center" valign="top">14</td>
  <td align="left" valign="top">reserviert</td>
</tr>
<tr>
  <td align="center" valign="top">15</td>
  <td align="left" valign="top">reserviert</td>
</tr>
</table>
</div>

<br><br>

In diesem erweiterten Modus wird der Parameter <i>sh_wpcmd</i>
als Zeiger auf eine Menge von 32bit (Long-)Werten aufgefaßt. Jedem
der o.g. Bits ist dabei ein Long-Wert zugewiesen, der gültig ist,
wenn das entsprechende Bit gesetzt ist. Die Menge der 32bit Werte ist
folgendermaßen belegt:<table>
<tr><td nowrap="nowrap" valign="top">Element</td>
<td valign="top">Bedeutung</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">[0]</td>
<td valign="top">Zeiger auf den Namen des Programms</td></tr>

<tr><td nowrap="nowrap" valign="top">[1]</td>
<td valign="top">Wert von <a href="00500b.html#Psetlimit">Psetlimit</a> (Bit-8)</td></tr>

<tr><td nowrap="nowrap" valign="top">[2]</td>
<td valign="top">Wert von <a href="00500b.html#Prenice">Prenice</a> (Bit-9)</td></tr>

<tr><td nowrap="nowrap" valign="top">[3]</td>
<td valign="top">Zeiger auf das Default-Verzeichnis.
<br>Ein Nullzeiger bedeutet in diesem Zusammenhang, daß als
Default-Verzeichnis dasjenige gewählt wird, indem sich das zu
startende Programm befindet. (Bit-10)</td></tr>

<tr><td nowrap="nowrap" valign="top">[4]</td>
<td valign="top">Zeiger auf das Environment der Applikation (Bit-11)

</td></tr>
</table>

<br><br>

<b>Hinweis:</b> Die Elemente [1],[2] und [3] werden bis MagiC 3
ignoriert; Element [1] wird jedoch ab <a href="00b.html">MagiC</a> 4 unterstützt. Das
Default-Verzeichnis wird unter MagiC viel einfacher gesetzt, denn
das neue Programm erbt alle Pfade auf allen Laufwerken vom aufrufenden
Programm.
<br>Bei Geneva wird nur Bit 8 beachtet.<br><br>

<b>In neueren AES-Versionen stehen darüber hinaus die
folgenden Modi zur Verfügung</b>.<table>
<tr><td nowrap="nowrap" valign="top">sh_wdoex</td>
<td valign="top">Bedeutung</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;<a name="Shutdown_20Modus"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">4</td>
<td valign="top"><b><a href="00500e.html#Shutdown">Shutdown</a>-Modus setzen</b>
<br>Dieses Kommando versetzt das System in Abhängigkeit des
Parameters <i>sh_wiscr</i> in den Normal bzw. Shutdown Modus. Es
gilt:<table>
<tr><td nowrap="nowrap" valign="top">sh_wiscr</td>
<td valign="top">Bedeutung</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;<a name="Shutdown_20abbrechen"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">0</td>
<td valign="top"><b><a href="00500e.html#Shutdown">Shutdown</a> Sequenz abbrechen</b>
<br>Ein begonnener <a href="00500e.html#Shutdown">Shutdown</a> kann nur von dem Prozess beendet werden,
der diese Sequenz auch gestartet hat.<a name="Shutdown_2C_20partieller"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">1</td>
<td valign="top"><b>Partieller <a href="00500e.html#Shutdown">Shutdown</a></b>
<br>Mit Ausnahme des Aufrufers werden alle Applikationen vom AES
daraufhin überprüft, ob sie die Meldung <a href="008007.html#AP_TERM">AP_TERM</a> verstehen. Wenn dies
der Fall ist, schickt das AES die Meldungen AP_TERM bzw. <a href="008007.html#AC_CLOSE">AC_CLOSE</a>
an die Programme bzw. <a href="008002.html#Accessories">Accessories</a>. Der Aufrufer erhält keine dieser
Meldungen.<a name="Shutdown_2C_20vollst_C3_A4ndiger"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">2</td>
<td valign="top"><b>Vollständiger <a href="00500e.html#Shutdown">Shutdown</a></b>
<br>Mit Ausnahme des Aufrufers werden alle Applikationen und
<a href="008002.html#Accessories">Accessories</a> vom <a href="008.html">AES</a> daraufhin überprüft, ob sie die Meldung <a href="008007.html#AP_TERM">AP_TERM</a>
verstehen. Wenn dies der Fall ist, schickt das AES die Meldungen
AP_TERM bzw. AC_CLOSE an die Programme bzw. <a href="008002.html#Accessories">Accessories</a>. <a href="008002.html#Accessories">Accessories</a>
erhalten die AP_TERM Nachricht zusätzlich nach Erhalt der AC_CLOSE
<a href="00f00a.html#Message">Message</a>. Der Aufrufer erhält keine dieser Meldungen.

</td></tr>
</table>

<br><br>

In <a href="008002.html#N.AES">N.AES</a> gibt es einen erweiterten Aufruf:
<br>shel_write(4, shutart, 0, &ignorant, NULL);<br><br>

<i>ignorant</i> ist hierbei ein Integer, dessen Adresse als
vierter Parameter des shel_write-Aufrufs übergeben wird. Im
Fehlerfall ist der Rückgabewert der Funktion shel_write wie bisher 0,
zusätzlich wird jedoch in <i>ignorant</i> die Applikations-ID (apid)
der Applikation hinterlegt, die <a href="008007.html#AP_TERM">AP_TERM</a> nicht verstanden hat bzw. -1,
wenn bereits ein <a href="00500e.html#Shutdown">Shutdown</a> läuft oder -2, wenn ungültige Parameter
übergeben wurden.<a name="Aufl_C3_B6sungswechsel"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">5</td>
<td valign="top"><b>Auflösungswechsel</b>
<br>Die Applikation fordert das AES auf, die Auflösung zu
wechseln. Falls das AES dem Wechsel zustimmt, versucht es, das
System herunterzufahren (<a href="00500e.html#Shutdown">Shutdown</a>). Die aktiven Applikationen können
sich nun entweder beenden, oder durch eine <a href="008007.html#AP_TFAIL">AP_TFAIL</a> Nachricht dem <a href="008.html">AES</a>
mitteilen, daß sie hierzu nicht in der Lage sind. Die Parameter
<i>sh_wisgr</i> und <i>sh_wiscr</i> sind dabei voneinander
abhängig. Es gilt:<table>
<tr><td nowrap="nowrap" valign="top">sh_wiscr</td>
<td valign="top">Bedeutung</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">0</td>
<td valign="top">Der Parameter <i>sh_wisgr</i> ist die ID des physikalischen
Gerätes, auf dem der Open-Workstation Aufruf des <a href="007.html">VDI</a> ausgeführt
wird. Die aktuelle physikalische Gerätenummer kann wie üblich per
<a href="Screen_functions.html#Getrez">Getrez</a>() + 2 ermittelt werden; es stehen folgende Werte zur
Verfügung:<br>


<div align="left">
<table border="0">
<tr>
  <td align="left" valign="top">2</td>
  <td align="left" valign="top">=</td>
  <td align="left" valign="top">ST-Low</td>
  <td align="left" valign="top">(320*200)</td>
</tr>
<tr>
  <td align="left" valign="top">3</td>
  <td align="left" valign="top">=</td>
  <td align="left" valign="top">ST-Medium</td>
  <td align="left" valign="top">(640*200)</td>
</tr>
<tr>
  <td align="left" valign="top">4</td>
  <td align="left" valign="top">=</td>
  <td align="left" valign="top">ST-High</td>
  <td align="left" valign="top">(640*400)</td>
</tr>
<tr>
  <td align="left" valign="top">6</td>
  <td align="left" valign="top">=</td>
  <td align="left" valign="top">TT-Medium</td>
  <td align="left" valign="top">(640*480)</td>
</tr>
<tr>
  <td align="left" valign="top">8</td>
  <td align="left" valign="top">=</td>
  <td align="left" valign="top">TT-High</td>
  <td align="left" valign="top">(1280*960)</td>
</tr>
<tr>
  <td align="left" valign="top">9</td>
  <td align="left" valign="top">=</td>
  <td align="left" valign="top">TT-Low</td>
  <td align="left" valign="top">(320*480)</td>
</tr>
</table>
</div>

</td></tr>

<tr><td nowrap="nowrap" valign="top">1</td>
<td valign="top">Der Parameter <i>sh_wisgr</i> ist das int16_t für den
Video-Modus des Falcon.</td></tr>

<tr><td nowrap="nowrap" valign="top">>2</td>
<td valign="top">für zukünftige Zwecke reserviert

</td></tr>
</table>

<br><br>

In <a href="008002.html#N.AES">N.AES</a> gibt es einen erweiterten Aufruf:
<br>shel_write(5, vmode, falconflag, &ignorant, NULL);
<br>Da ein Auflösungswechsel intern zunächst immer einen
vollständigen <a href="00500e.html#Shutdown">Shutdown</a> startet, kann es auch hier geschehen, daß
nicht alle Anwendungen <a href="008007.html#AP_TERM">AP_TERM</a> verstehen und der Auflösungswechsel
somit frühzeitig fehlschlägt. Analog zur obigen Modus-4-Erweiterung
wird auch hier die Applikations-ID eines Verständnislosen in
<i>ignorant</i> hinterlegt, eine -1, wenn bereits ein Shutdown läuft
oder -2, wenn fehlerhafte Parameter (z.B. unerlaubte Auflösungen)
übergeben wurden.</td></tr>

<tr><td nowrap="nowrap" valign="top">6</td>
<td valign="top"><b>unbekannt</b><a name="Broadcasting_20des_20AES"></a>
<a name="AES-Broadcasting"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">7</td>
<td valign="top"><b>AES-Broadcasting</b>
<br>Die Applikation möchte eine Nachricht an alle anderen im System
vorhandenen Applikationen schicken. Als Empfänger ausgenommen sind
nur das <a href="008.html">AES</a>, der Screen-Manager, sowie der Absender der Nachricht
selbst.<br><br>

Der Parameter <i>sh_wpcmd</i> ist ein Zeiger auf einen 16 Bytes
großen Nachrichtenpuffer, der die zu sendenden Daten enthält.<a name="AES-Environment_20manipulieren"></a>
<a name="Environment_20des_20AES_20manipulieren"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">8</td>
<td valign="top"><b>Manipulation des AES-Environments</b>
<br>Dieses Kommando erlaubt die Modifikation des <a href="008.html">AES</a>-Environments. Der
Parameter <i>sh_wisgr</i> beschreibt die gewünschte Aktion. Es gilt:<table>
<tr><td nowrap="nowrap" valign="top">sh_wisgr</td>
<td valign="top">Bedeutung</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">0</td>
<td valign="top"><b>Größe des Environment-Puffers erfragen</b>. Diese wird
als Funktionsergebnis zurückgeliefert.</td></tr>

<tr><td nowrap="nowrap" valign="top">1</td>
<td valign="top"><b>Einfügen/Entfernen von Strings</b>. Der Parameter
<i>sh_wpcmd</i> ist ein Zeiger auf den Environment-String. Die Syntax
zum Einfügen bzw. Entfernen lautet 'NEW=STRING\0' bzw. 'NEW=\0'.</td></tr>

<tr><td nowrap="nowrap" valign="top">2</td>
<td valign="top"><b>Inhalt des Environment-Puffers kopieren</b>. Der Parameter
<i>sh_wpcmd</i> ist ein Zeiger auf den aufnehmenden Puffer, der eine
Größe von <i>sh_wiscr</i> Bytes besitzt. Die Funktion liefert die
Anzahl der Bytes zurück, die nicht kopiert werden konnten.

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">9</td>
<td valign="top"><b>Unterstützte <a href="008007.html#Nachrichten">Nachrichten</a> anzeigen</b>
<br>Die Applikation teilt dem AES mit, welche (neuen) <a href="008007.html#Nachrichten">Nachrichten</a>
verstanden werden. Dies geschieht über gesetzte Bits des Parameters
<i>sh_wisgr</i>.<a name="NM_INHIBIT_HIDE"></a>
<table>
<tr><td nowrap="nowrap" valign="top">Bit 0:</td>
<td valign="top"><a href="008007.html#AP_TERM">AP_TERM</a></td></tr>

<tr><td nowrap="nowrap" valign="top">Bit 1:</td>
<td valign="top">NM_INHIBIT_HIDE (since <a href="00d.html">XaAES</a> 2005-01-16)
<br>Schützt eine Application davor versteckt zu werden. Nützlich
für Desktop Utillity wie Taskbar oder StartMe Up.

</td></tr>
</table>

<br><br>

Alle anderen Bits (2-15) sind z.Zt. nicht definiert.</td></tr>

<tr><td nowrap="nowrap" valign="top">10</td>
<td valign="top"><b>Nachricht an AES senden</b>
<br>Die Applikation will eine Nachricht an das AES schicken. Der
Parameter <i>sh_wpcmd</i> ist ein Zeiger auf den 16 Bytes großen
Nachrichtenpuffer.<dl>
<dt><b>Geneva</b></dt>
<dd>
<p>A program can cause a windowed dialog to scroll by sending a
<a href="008007.html#WM_ARROWED">WM_ARROWED</a> message to Geneva. Example:</p>

<pre>int16_t msg[8];

msg[0] = <a href="008007.html#WM_ARROWED">WM_ARROWED</a>;
msg[3] = window_handle;
msg[4] = <a href="008007.html#WA_UPPAGE">WA_UPPAGE</a>;
shel_write( SHW_SENDTOAES, 0, 0, (int8_t *)msg, 0L );
</pre>
</dd>
</dl>

<a name="Threads_2C_20Erzeugen_20von"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">20</td>
<td valign="top"><b>Neuen Thread erzeugen</b>
<br>Mit diesem Opcode kann die Applikation einen neuen Thread
erzeugen. Dabei gilt:<table>
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top">Bedeutung</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_wisgr</td>
<td valign="top"><table>
<tr><td nowrap="nowrap" valign="top">0 =</td>
<td valign="top">Starte Programm im VT52 Fenster der Applikation, falls eines
geöffnet ist.</td></tr>

<tr><td nowrap="nowrap" valign="top">1 =</td>
<td valign="top">öffne kein neues Fenster</td></tr>

<tr><td nowrap="nowrap" valign="top">2 =</td>
<td valign="top">öffne neues VT52-Fenster
</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_wiscr</td>
<td valign="top">0</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_wpcmd</td>
<td valign="top">Zeiger auf <a href="010009.html#THREADINFO">THREADINFO</a>-Struktur</td></tr>

<tr><td nowrap="nowrap" valign="top">sh_wptail</td>
<td valign="top">Parameter vom Typ (void *) für die Thread-Funktion.

</td></tr>
</table>

<br><br>

Bei einem erfolgreichen Aufruf wird als Ergebnis die
Applikations-ID des neuen Threads zurückgeliefert (*).<a name="Threads_2C_20Beenden_20von"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">21</td>
<td valign="top"><b>Thread beenden</b>
<br>Mit diesem Opcode kann sich ein Thread selbst beenden. Dazu setzt
man die Parameter <i>sh_wisgr</i> <i>sh_wiscr</i> und
<i>sh_wptail</i> auf die Werte 0 bzw. NULL; über <i>sh_wpcmd</i>
kann ein zurückzuliefernder Fehlercode angegeben werden.<br><br>

Normalerweise ist ein Ausführen dieser Funktion nicht notwendig,
da sich der Thread automatisch mit dem Ende seiner Prozedur (d.h. mit
dem CPU-Befehl RTS) selbst beendet. <b>Wichtig:</b> Wenn der Thread
einen <a href="00500b.html#Pexec">Pexec</a>-Aufruf durchgeführt hat, so muss zuerst der laufende
Prozess per <a href="00500b.html#Pterm">Pterm</a> beendet werden, bevor sich der Thread beenden kann
(*).</td></tr>

<tr><td nowrap="nowrap" valign="top">22</td>
<td valign="top"><b>Thread terminieren</b>
<br>Mit diesem Opcode kann ein Thread auch vom Hauptprogramm beendet
werden. Dazu übergibt man im Parameter <i>sh_wiscr</i> die
Applikations-ID des Thread, und setzt die übrigen Parameter auf den
Wert 0 bzw. NULL.<br><br>

Normalerweise ist diese Funktion nicht notwendig, da mit dem
Beenden des Hauptprogramms automatisch auch alle zugehörigen Threads
beendet werden. Die Funktion wurde erfolgreich ausgeführt, wenn als
Ergebnis der Wert 1 zurückgeliefert wird. Zu beachten ist jedoch,
daß für den Fall, daß der Thread inzwischen ein <a href="00500b.html#Pexec">Pexec</a> ausgeführt
hat, nur dieses Programm per <a href="00500b.html#Pterm">Pterm</a> (<a href="005003.html#EBREAK">EBREAK</a>) beendet wird; der Thread
selbst ist erst dann beendet, wenn der Aufrufer ein <a href="008007.html#THR_EXIT">THR_EXIT</a> empfangen
hat (*).<a name="XSHW_RUNANY"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">224</td>
<td valign="top"><b>Run an application</b> (Geneva since Update 004)
<br>Run an application, letting Geneva determine the type. This is
identical to mode 0, except that the XSHD_FLAGS bit of <i>sw_doex</i>
can also be set (see below).<a name="XSHW_RUNAPP"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">225</td>
<td valign="top"><b>Run an application</b> (Geneva since Update 004)
<br>This is identical to mode 1, except that the XSHD_FLAGS bit of
<i>sw_doex</i> can also be set.<a name="XSHW_RUNACC"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">227</td>
<td valign="top"><b>Run a desk accessory.</b> (Geneva since Update 004)
<br>This is identical to mode 3, except that the XSHD_FLAGS bit of
<i>sw_doex</i> can also be set.<br><br>

When XSHD_FLAGS (1<<15) is added to the <i>sw_doex</i>, this
means that the last longword of the SHWRCMD passed in the
<i>sh_wpcmd</i> parameter contains the Geneva program flags to use
when executing the application.
<br>It is strongly recommended that a program using XSHD_FLAGS inquire
the current flags for the application and only change the ones it
needs to change, rather than making most of the flags zero or some
other random value. See the <a href="Application.html#x_appl_flags">x_appl_flags</a> section, below, for an
example.

</td></tr>
</table>

<br><br>

<b>Hinweis:</b> Ab <a href="00b.html">MagiC</a> 3 stehen die folgenden Besonderheiten
zur Verfügung:

<ul>
<li><p>Wird in <i>sh_wptail</i> eine Zeichenkette übergeben, die mit
dem Wert 255 beginnt und mit '\0' abgeschlossen ist, wird die
tatsächliche Länge der Kommandozeile vom <a href="008.html">AES</a> bestimmt und in ganzer
Länge ans DOS weitergereicht. Das DOS konstruiert hieraus einen
ARGV-Parameter im Environment. Ist die Kommandozeile kürzer als 127
Bytes, wird sie über Basepage und per <a href="#shel_read">shel_read</a> übergeben, ansonsten
besteht sie nur aus dem Byte mit dem Wert 127.</p></li>
<li><p>Wird in <i>sh_wptail</i> eine Zeichenkette übergeben, die mit
dem Wert 254 beginnt, erwartet das <a href="008.html">AES</a> dahinter die Zeichenkette
"ARGV=irgendwas" und eine durch '\0' getrennte und durch "\0\0"
abgeschlossene Liste von Parametern. Diese wird vollständig dem DOS
übergeben, das daraus einen ARGV-Parameter konstruiert. Ist die
Kommandozeile kürzer als 127 Bytes, wird sie über Basepage und per
shel_read übergeben, wobei die Nullbytes durch Leerstellen ersetzt
werden, ansonsten besteht sie nur aus dem Byte mit dem Wert 127.</p></li>
</ul>

<br><br>

Das Vorhandensein der zusätzlichen Features kann per <a href="Application.html#_25apgi_10">appl_getinfo</a>
(Opcode 10) erfragt werden.<br><br>

Die mit (*) gekennzeichneten Opcodes von shel_write stehen z.Zt.
nur in MagiC zur Verfügung.<a name="shel_write_20und_20Single-TOS"></a>
<br><br>

<b>Achtung:</b> Startet man ein neuen <a href="008.html">AES</a>-Prozeß unter
Singel-<a href="002.html">TOS</a> mit shel_write wird dieser aber erst nach Beendigung des
eigenen Prozesses gestartet.</td></tr>

<tr><td nowrap="nowrap" valign="top">Ergebnis:</td>
<td valign="top">Ein Fehler ist nur dann aufgetreten, wenn als Ergebnis 0
zurückgegeben wird.</td></tr>

<tr><td nowrap="nowrap" valign="top">Verfügbar:</td>
<td valign="top">In allen AES Versionen.</td></tr>

<tr><td nowrap="nowrap" valign="top">Gruppe:</td>
<td valign="top"><a href="#Shellfunktionen">Shell-Kommunikation</a></td></tr>

<tr><td nowrap="nowrap" valign="top">Querverweis:</td>
<td valign="top"><a href="#Bindings_20f_C3_BCr_20shel_write">Binding</a> &nbsp; <a href="00b00e.html">Shutdown Mechanismus</a> &nbsp; <a href="00b012.html">Threads in MagiC</a>

</td></tr>
</table>

<h4><a name="Bindings_20f_C3_BCr_20shel_write"></a>8.18.9.1 Bindings für shel_write</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int16_t <a href="#shel_write">shel_write</a> ( int16_t sh_wdoex, int16_t sh_wisgr,
int16_t sh_wiscr, int8_t *sh_wpcmd, int8_t *sh_wptail );</td></tr>

<tr><td nowrap="nowrap" valign="top">Umsetzung:</td>
<td valign="top"><pre>int16_t <a href="#shel_write">shel_write</a> (int16_t sh_wdoex, int16_t sh_wisgr,
                    int16_t sh_wiscr, int8_t *sh_wpcmd,
                    int8_t *sh_wptail)
{
   <a href="008002.html#int_in">int_in</a>[0]  = sh_wdoex;
   <a href="008002.html#int_in">int_in</a>[1]  = sh_wisgr;
   <a href="008002.html#int_in">int_in</a>[2]  = sh_wiscr;
   <a href="008002.html#addr_in">addr_in</a>[0] = sh_wpcmd;
   <a href="008002.html#addr_in">addr_in</a>[1] = sh_wptail;

   return ( <a href="008002.html#crys_if">crys_if</a>(121) );
}
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="002002.html">GEM</a>-Arrays:</td>
<td valign="top"><br><br>


<div align="left">
<table border="0">
<tr>
  <td align="left" valign="top">Adresse</td>
  <td align="left" valign="top">Feldelement</td>
  <td align="left" valign="top">Belegung</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a></td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[0]</td>
  <td align="left" valign="top">121   # Opcode der Funktion</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+2</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[1]</td>
  <td align="left" valign="top">3     # Einträge in <a href="008002.html#int_in">int_in</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+4</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[2]</td>
  <td align="left" valign="top">1     # Einträge in <a href="008002.html#int_out">int_out</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+6</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[3]</td>
  <td align="left" valign="top">2     # Einträge in <a href="008002.html#addr_in">addr_in</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#control">control</a>+8</td>
  <td align="left" valign="top"><a href="008002.html#control">control</a>[4]</td>
  <td align="left" valign="top">0     # Einträge in <a href="008002.html#addr_out">addr_out</a></td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#int_in">int_in</a></td>
  <td align="left" valign="top"><a href="008002.html#int_in">int_in</a>[0]</td>
  <td align="left" valign="top">sh_wdoex</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#int_in">int_in</a>+2</td>
  <td align="left" valign="top"><a href="008002.html#int_in">int_in</a>[1]</td>
  <td align="left" valign="top">sh_wisgr</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#int_in">int_in</a>+4</td>
  <td align="left" valign="top"><a href="008002.html#int_in">int_in</a>[2]</td>
  <td align="left" valign="top">sh_wiscr</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a></td>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a>[0]</td>
  <td align="left" valign="top">sh_wpcmd</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a>+4</td>
  <td align="left" valign="top"><a href="008002.html#addr_in">addr_in</a>[1]</td>
  <td align="left" valign="top">sh_wptail</td>
</tr>
<tr>
  <td align="left" valign="top"><a href="008002.html#int_out">int_out</a></td>
  <td align="left" valign="top"><a href="008002.html#int_out">int_out</a>[0]</td>
  <td align="left" valign="top"><a href="VT_52_terminal.html#Return">Return</a>-Wert</td>
</tr>
</table>
</div>



</td></tr>
</table>

<hr>

<a id="UDO_nav_hm_FOOT" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a><a id="UDO_nav_up_FOOT" href="008.html"><img src="udo_up.gif" alt="AES" title="AES" border="0" width="24" height="24"></a><a id="UDO_nav_lf_FOOT" href="008011.html"><img src="udo_lf.gif" alt="Resourcefunktionen" title="Resourcefunktionen" border="0" width="24" height="24"></a><a id="UDO_nav_rg_FOOT" href="008013.html"><img src="udo_rg.gif" alt="Erweiterte Grafikfunktionen" title="Erweiterte Grafikfunktionen" border="0" width="24" height="24"></a></body>
</html>
