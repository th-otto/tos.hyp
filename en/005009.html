<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
<title>
The documentation for TOS: File functions
</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="Generator" content="UDO 7.04 (1296) for Linux">
</head>
<body>
<? include "/var/www/banner.php"; ?>

<a id="UDO_nav_hm_HEAD" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a><a id="UDO_nav_up_HEAD" href="005.html"><img src="udo_up.gif" alt="GEMDOS" title="GEMDOS" border="0" width="24" height="24"></a><a id="UDO_nav_lf_HEAD" href="005008.html"><img src="udo_lf.gif" alt="gemdos-trap" title="gemdos-trap" border="0" width="24" height="24"></a><a id="UDO_nav_rg_HEAD" href="00500a.html"><img src="udo_rg.gif" alt="Date and Time" title="Date and Time" border="0" width="24" height="24"></a>
<hr>

<h1><a name="File_20functions"></a>5.9 File functions</h1>
<table>
<tr><td nowrap="nowrap" valign="top">• <a href="#Fattrib">Fattrib</a>&nbsp;&nbsp;</td>
<td valign="top">Reads or modifies file atributes.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fchmod">Fchmod</a>&nbsp;&nbsp;&nbsp;</td>
<td valign="top">Sets file access permissions.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fchown">Fchown</a>&nbsp;&nbsp;&nbsp;</td>
<td valign="top">Modifies file access permissions.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fclose">Fclose</a>&nbsp;&nbsp;&nbsp;</td>
<td valign="top">Closes a given file.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fcntl">Fcntl</a>&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Performs control operations on a file.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fcreate">Fcreate</a>&nbsp;&nbsp;</td>
<td valign="top"> Creates a file.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fdatime">Fdatime</a>&nbsp;&nbsp;</td>
<td valign="top"> Reads or modifies a file's date/time stamp.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fdelete">Fdelete</a>&nbsp;&nbsp;</td>
<td valign="top"> Deletes a specified file.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Ffchmod">Ffchmod</a>&nbsp;&nbsp;</td>
<td valign="top"> Changes access permissions for an open file.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Ffchown">Ffchown</a>&nbsp;&nbsp;</td>
<td valign="top"> Changes ownership of an open file to uid and gid respectively.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fdup">Fdup</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Duplicates file handle.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fforce">Fforce</a>&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Redirects input/output of standard channels.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fgetchar">Fgetchar</a>&nbsp;</td>
<td valign="top"> Reads characters from a file.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fgetdta">Fgetdta</a>&nbsp;&nbsp;</td>
<td valign="top"> Gets disk transfer address.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Finstat">Finstat</a>&nbsp;&nbsp;</td>
<td valign="top"> Gets input status of a file.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Flink">Flink</a>&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Creates a link to a file.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Flock">Flock</a>&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Sets or removes file record lock.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fmidipipe">Fmidipipe</a></td>
<td valign="top"> Redirects MIDI in/output.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fopen">Fopen</a>&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Opens a specified file.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Foutstat">Foutstat</a>&nbsp;</td>
<td valign="top"> Finds the output status of a file.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fpipe">Fpipe</a>&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Creates a pipe.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fputchar">Fputchar</a>&nbsp;</td>
<td valign="top"> Writes a character to a specified file.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fread">Fread</a>&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Reads from a specified file.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Freadlink">Freadlink</a></td>
<td valign="top"> Finds the contents of a symbolic link.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Frename">Frename</a>&nbsp;&nbsp;</td>
<td valign="top"> Renames a file.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fseek">Fseek</a>&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Sets a pointer to a given position of a file.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fselect">Fselect</a>&nbsp;&nbsp;</td>
<td valign="top"> Selects file descriptors.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fsetdta">Fsetdta</a>&nbsp;&nbsp;</td>
<td valign="top"> Modifies disk transfer address in memory.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fsfirst">Fsfirst</a>&nbsp;&nbsp;</td>
<td valign="top"> Finds first entry in a directory.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fsnext">Fsnext</a>&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Finds next entry in a directory.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fsymlink">Fsymlink</a>&nbsp;</td>
<td valign="top"> Creates symbolic link to a file.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fwrite">Fwrite</a>&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Writes to a file.</td></tr>

<tr><td nowrap="nowrap" valign="top">• <a href="#Fxattr">Fxattr</a>&nbsp;&nbsp;&nbsp;</td>
<td valign="top"> Obtains extended file attributes.

</td></tr>
</table>

<p>See also: <a href="00500f.html">Directory functions</a> &nbsp; <a href="00400d.html">XBIOS drive functions</a> &nbsp; <a href="005004.html">Test for pipes</a></p>

<h3><a name="Fattrib"></a>5.9.1 Fattrib</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»File attributes« - Read or modify file attributes.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">67</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int16_t Fattrib ( const int8_t *filename, int16_t wflag,
int16_t attrib );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The GEMDOS routine Fattrib reads or sets the attributes of a
GEMDOS file.<table>
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top">Meaning</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">filename</td>
<td valign="top">Filename of the relevant file</td></tr>

<tr><td nowrap="nowrap" valign="top">wflag</td>
<td valign="top"><table>
<tr><td nowrap="nowrap" valign="top">0 =</td>
<td valign="top">Read attributes</td></tr>

<tr><td nowrap="nowrap" valign="top">1 =</td>
<td valign="top">Set attributes
</td></tr>
</table>

<a name="File_20attributes_20of_20TOS"></a>
<a name="Attributes_20of_20a_20file"></a>
</td></tr>

<tr><td nowrap="nowrap" valign="top">attrib</td>
<td valign="top"><b>File attribute flags:</b><table>
<tr><td nowrap="nowrap" valign="top">Bit 0:</td>
<td valign="top">File is write-protected</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit 1:</td>
<td valign="top">File is hidden</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit 2:</td>
<td valign="top">System file</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit 3:</td>
<td valign="top">Volume label (diskette name)</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit 4:</td>
<td valign="top">Directory</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit 5:</td>
<td valign="top">Archive bit
</td></tr>
</table>


</td></tr>
</table>

<br><br>

<b>Note:</b> If possible, programs should make use of the <a href="#Fxattr">Fxattr</a>
and <a href="#Fchmod">Fchmod</a> routines, as these are more efficient than Fattrib.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns the following results:<table>
<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EACCDN">EACCDN</a> :</td>
<td valign="top">Access denied.</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EFILNF">EFILNF</a> :</td>
<td valign="top">File not found.</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EPTHNF">EPTHNF</a> :</td>
<td valign="top">Directory not found.</td></tr>

<tr><td nowrap="nowrap" valign="top">Otherwise:</td>
<td valign="top">The current file attributes.

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">All GEMDOS versions.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="Fattrib.html#Bindings_20for_20Fattrib">Binding</a> &nbsp; <a href="#Fxattr">Fxattr</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fattrib"></a>5.9.1.1 Bindings for Fattrib</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int16_t <a href="#Fattrib">Fattrib</a> ( const int8_t *filename, int16_t wflag,
int16_t attrib );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    attrib,-(sp) ; Offset 8
move.w    wflag,-(sp)  ; Offset 6
pea       filename     ; Offset 2
move.w    #67,-(sp)    ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
lea       $A(sp),sp    ; correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top">Fehler%=Gemdos(&H43,L:filename%,W:wflag%,W:attrib%)

</td></tr>
</table>

<h3><a name="Fchmod"></a>5.9.2 Fchmod</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Fchmod« - Set permissions for file access.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">306</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Fchmod ( int8_t *name, int16_t mode );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The function alters the access rights for the GEMDOS file
<i>name</i>. The parameter <i>mode</i> contains the new access
rights:<br><br>


<div align="left">
<table border="0">
<tr>
  <td align="left" valign="top">Access by</td>
  <td align="left" valign="top">mode</td>
  <td align="left" valign="top">Meaning</td>
</tr>
<tr>
  <td align="left" valign="top">Owner of the</td>
  <td align="left" valign="top">0400</td>
  <td align="left" valign="top">Read permission</td>
</tr>
<tr>
  <td align="left" valign="top">file</td>
  <td align="left" valign="top">0200</td>
  <td align="left" valign="top">Write permission</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">0100</td>
  <td align="left" valign="top">Execution permission</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;</td>
</tr>
<tr>
  <td align="left" valign="top">Group of the</td>
  <td align="left" valign="top">0040</td>
  <td align="left" valign="top">Read permission</td>
</tr>
<tr>
  <td align="left" valign="top">file</td>
  <td align="left" valign="top">0020</td>
  <td align="left" valign="top">Write permission</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">0010</td>
  <td align="left" valign="top">Execution permission</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">&nbsp;</td>
</tr>
<tr>
  <td align="left" valign="top">All other</td>
  <td align="left" valign="top">0004</td>
  <td align="left" valign="top">Read permission</td>
</tr>
<tr>
  <td align="left" valign="top">users</td>
  <td align="left" valign="top">0002</td>
  <td align="left" valign="top">Write permission</td>
</tr>
<tr>
  <td align="left" valign="top">&nbsp;</td>
  <td align="left" valign="top">0001</td>
  <td align="left" valign="top">Execution permission</td>
</tr>
</table>
</div>

<br><br>

<b>For executable files the following applies:</b><table>
<tr><td nowrap="nowrap" valign="top">mode</td>
<td valign="top">Meaning</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">04000</td>
<td valign="top">Set effective UID of the process to the UID of whatever
executes this process</td></tr>

<tr><td nowrap="nowrap" valign="top">02000</td>
<td valign="top">Set effective GID of the process to the GID of whatever
executes this process</td></tr>

<tr><td nowrap="nowrap" valign="top">01000</td>
<td valign="top">The file is a directory.
<br>Only the owner of the file or directory (or root) can delete files
in this directory.</td></tr>

<tr><td nowrap="nowrap" valign="top">????</td>
<td valign="top">The file is a shared-text program.
<br>The program is not removed from memory after it has been executed
and therefore need not be reloaded for repeat use.

</td></tr>
</table>

<br><br>

<b>Note:</b> Not all file-systems need to support all the
options. Unsupported access rights are then ignored. Execution rights
for a directory mean that one may search in this directory for a name
or name component.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:<table>
<tr><td nowrap="nowrap" valign="top"><a href="005003.html#E_OK">E_OK</a>&nbsp;&nbsp;&nbsp;:</td>
<td valign="top">No error has arisen</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EFILNF">EFILNF</a> :</td>
<td valign="top">File not found</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EPTHNF">EPTHNF</a> :</td>
<td valign="top">Path to file not found</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EACCDN">EACCDN</a> :</td>
<td valign="top">The EUID of the called process differs from the UID of the file
owner and is also not that of the kernel (0)

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">Available when a 'MiNT' cookie with a version of at least 0.90
exists.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="Fchmod.html#Bindings_20for_20Fchmod">Binding</a> &nbsp; <a href="#Fattrib">Fattrib</a> &nbsp; <a href="#Fxattr">Fxattr</a> &nbsp; <a href="00b015.html">XFS-concept in MagiC</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fchmod"></a>5.9.2.1 Bindings for Fchmod</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Fchmod">Fchmod</a> ( int8_t *name, int16_t mode );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    mode,-(sp)   ; Offset 6
pea       name         ; Offset 2
move.w    #306,-(sp)   ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
addq.l    #8,sp        ; correct stack
</pre>


</td></tr>
</table>

<h3><a name="Fchown"></a>5.9.3 Fchown</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Fchown« - Alter owner/group ID.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">305</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Fchown ( int8_t *name, int16_t uid, int16_t gid );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The function alters the user/group ID of the file <i>name</i>,
which control the access rights of the file.<br><br>

This call can only be issued by a process that has an effective
user identifier (EUID) which is 0, or which corresponds to the UID of
the file; in the latter case the new UID must correspond to the old
one, and in addition the calling process must be a member of the group
with the group number GID.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:<table>
<tr><td nowrap="nowrap" valign="top"><a href="005003.html#E_OK">E_OK</a> :</td>
<td valign="top">No error has arisen</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EINVFN">EINVFN</a> :</td>
<td valign="top">The file-system does not support the concept of user/group IDs
(example TOS-FS)</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EACCDN">EACCDN</a> :</td>
<td valign="top"> The EUID of the calling process differs from the UID of the
file-owner and is also non-zero

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">Available when a 'MiNT' cookie with a version of at least 0.90
exists.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fchown">Binding</a> &nbsp; <a href="#Fchmod">Fchmod</a> &nbsp; <a href="#Fxattr">Fxattr</a> &nbsp; <a href="00b015.html">XFS-concept in MagiC</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fchown"></a>5.9.3.1 Bindings for Fchown</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Fchown">Fchown</a> ( int8_t *name, int16_t uid, int16_t gid );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    gid,-(sp)    ; Offset 8
move.w    uid,-(sp)    ; Offset 6
pea       name         ; Offset 2
move.w    #305,-(sp)   ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
lea       $A(sp),sp    ; Correct stack
</pre>


</td></tr>
</table>

<h3><a name="Fclose"></a>5.9.4 Fclose</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»File close« - Close a specified file.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">62</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int16_t Fclose ( int16_t handle );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The GEMDOS routine Fclose closes a file with the file ID
<i>handle</i>.<br><br>

<b>Note:</b> In a network the active locking is lifted. During
closing of standard channels, from GEMDOS Version 0.15 onwards the
original channel will be reinstated.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns the following results:<table>
<tr><td nowrap="nowrap" valign="top"><a href="005003.html#E_OK">E_OK</a></td>
<td valign="top">No error has arisen</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EIHNDL">EIHNDL</a></td>
<td valign="top">Wrong file ID

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">All GEMDOS versions.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fclose">Binding</a> &nbsp; <a href="#Fopen">Fopen</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fclose"></a>5.9.4.1 Bindings for Fclose</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int16_t <a href="#Fclose">Fclose</a> ( int16_t handle );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    handle,-(sp)  ; Offset 2
move.w    #62,-(sp)     ; Offset 0
trap      #1            ; <a href="005.html">GEMDOS</a>
addq.l    #4,sp         ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top">Fehler%=Gemdos(&H3E,W:handle%)

</td></tr>
</table>

<h3><a name="Fcntl"></a>5.9.5 Fcntl</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Fcntl« - Perform command operations on a given file.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">260</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Fcntl ( int16_t fh, int32_t arg, int16_t cmd );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The function performs various command operations on the file
with the handle <i>fh</i>. The parameter <i>cmd</i> describes the
desired operation, and can assume the following values. (<i>arg</i>
here depends on the selected command):<a name="Fcntl_2C_20File_20commands_20for"></a>
<a name="F_DUPFD"></a>
<br><br>

<b>F_DUPFD (0):</b>
<br>Duplicates the specified file handle. The following applies for
the new interval: <i>arg</i> <= Handle < 32. If no free handles exist
in the specified segment, the error-message <a href="005003.html#ENHNDL">ENHNDL</a> will be returned. A
call of <a href="#Fdup">Fdup</a> (handle) is therefore equivalent to Fcntl (handle, 6L,
F_DUPFD).<a name="F_GETFD"></a>
<br><br>

<b>F_GETFD (1):</b>
<br>This command returns the non-inheritance flag for the handle
<i>fh</i>. The flag is 0 when child processes started with <a href="00500b.html#Pexec">Pexec</a> are
to inherit the file handle, otherwise it has the value 1 and the
parameter <i>arg</i> is ignored.<a name="F_SETFD"></a>
<br><br>

<b>F_SETFD (2):</b>
<br>This command sets the non-inheritance flag for the handle
<i>fh</i>. <i>arg</i> specifies if child processes started with
<a href="00500b.html#Pexec">Pexec</a> will inherit the file handle; a value of 1 indicates they will
not, a value of 0 that they will. The default value for the flag is 0
for the standard <a href="005.html">GEMDOS</a> handles in the region 0...5 and 1 for all
others, i.e. non-standard handles.<a name="F_GETFL"></a>
<br><br>

<b>F_GETFL (3):</b>
<br>This command returns the file descriptor flags that can be altered
by the user. We are here dealing with the parameter <i>mode</i>
specified at <a href="#Fopen">Fopen</a>, as long as this has not been altered by another
call of Fcntl. <i>arg</i> is ignored.<a name="F_SETFL"></a>
<br><br>

<b>F_SETFL (4):</b>
<br>This command sets the file descriptor flags that can be altered by
the user to <i>arg</i> (the other bits are ignored, and should be set
to the value 0). It is not possible to alter the read/write mode or
the modes for file sharing.<a name="F_GETLK"></a>
<br><br>

<b>F_GETLK (5):</b>
<br>The parameter <i>arg</i> is a pointer to an <a href="005014.html#flock_2C_20Fcntl">flock structure</a>, in which
information about file locks are stored. If a lock exists then it will
be copied into the structure. During this the element <i>l_pid</i>
will hold the PID of the locking process. If no lock exists, then the
element <i>l_type</i> will be set to the value F_UNLCK. For the case
that the lock is held by another computer in a network, the element
<i>l_pid</i> is set to a value defined by the NFS (<b>N</b>etwork
<b>F</b>ile <b>S</b>ystem). For this value, 0x1000 <= <i>l_pid</i>
<= 0xffff. One should note that normal PID's have a value smaller than
1000.<a name="F_SETLK"></a>
<br><br>

<b>F_SETLK (6):</b>
<br>This command sets (<i>l_type</i> = F_RDLCK or F_WRLCK) or lifts
(<i>l_type</i> = F_UNLCK) an advisory lock on the specified file. If
this is a FIFO queue
(<b>F</b>irst-<b>I</b>n-<b>F</b>irst-<b>O</b>ut), the whole file
must be processed at the same time. For the case when the lock
conflicts with locks set by other processes, the value <a href="005003.html#ELOCKED">ELOCKED</a> will be
returned. If one tries to lift a non-existent lock, the value <a href="005003.html#ENSLOCK">ENSLOCK</a>
will be returned. One should note that read-locks may overlap, but
write-locks may not. If a locked file is closed, or the corresponding
process terminates, then all set locks will be lifted automatically
(i.e. reset).<a name="F_SETLKW"></a>
<br><br>

<b>F_SETLKW (7):</b>
<br>Similar to F_SETLK, with the difference that if the lock conflicts
with those from other processes, then <a href="005003.html#ELOCKED">ELOCKED</a> is not returned but the
locked process is suspended until the locking from the other process
is lifted.<a name="FSTAT"></a>
<br><br>

<b>FSTAT (0x4600):</b>
<br>Gets the extended attributes of a file. The parameter <i>arg</i>
returns a pointer to an <a href="005014.html#XATTR">XATTR</a> structure that is filled in with the
file's extended attributes, as if an <a href="#Fxattr">Fxattr</a> call had been made. This
command is supported in <a href="00b.html">MagiC</a> as of Version 3.0.<a name="FIONREAD"></a>
<br><br>

<b>FIONREAD (0x4601):</b>
<br>In the parameter <i>arg</i> a pointer to a LONG value is returned
which shows the number of bytes that may be read currently from a
specified file handle without causing the process to block (wait for
more input). The returned value is not necessarily correct, as the
exact amount can only be estimated in some cases. The command is
supported in <a href="00b.html">MagiC</a> as of Version 3.0.<a name="FIONWRITE"></a>
<br><br>

<b>FIONWRITE (0x4602):</b>
<br>Similar to FIONREAD, only here the number of bytes that may be
written at present is returned. The command is supported in <a href="00b.html">MagiC</a> as
of Version 3.0.<a name="FUTIME"></a>
<br><br>

<b>FUTIME (0x4603):</b>
<br>No information available at present.<a name="FTRUNCATE"></a>
<br><br>

<b>FTRUNCATE (0x4604):</b>
<br>The parameter <i>arg</i> is a pointer to a LONG value that
contains the new length of the file to be truncated. The command is
supported in <a href="00b.html">MagiC</a> as of Version 3.0.<a name="FIOEXECPT"></a>
<br><br>

<b>FIOEXECPT (0x4605):</b>
<br>In the parameter <i>arg</i> a pointer to a LONG value is returned
which specifies whether the file is in an exception state (1) or not
(0).<a name="Fcntl_2C_20Terminal_20commands_20for"></a>
<br><br>

<b>The following commands are to be applied to all terminal
devices such as the console or a pseudo-terminal:</b><a name="TIOCGETP"></a>
<br><br>

<b>TIOCGETP (0x5400):</b>
<br>This command returns via the parameter <i>arg</i> a pointer to a
<a href="005014.html#sgttyb">sgttyb</a> structure, in which the parameters of the terminal are defined.<a name="TIOCSETN"></a>
<br><br>

<b>TIOCSETN (0x5401):</b>
<br>With this command one can set a new <a href="005014.html#sgttyb">sgttyb</a> structure which sets
the parameters of the terminal. You should first get the terminal
control parameters, modify what you wish to change, and then set them
with this call.<a name="TIOCGETC"></a>
<br><br>

<b>TIOCGETC (0x5402):</b>
<br>This command returns via the parameter <i>arg</i> a pointer to a
<a href="005014.html#tchars">tchars</a> structure in which the terminal control characters are defined.<a name="TIOCSETC"></a>
<br><br>

<b>TIOCSETC (0x5403):</b>
<br>With this command new terminal control characters can be set. For
this one passes a pointer in <i>arg</i> to a <a href="005014.html#tchars">tchars</a> structure in
which the control characters are defined. If a character is set to 0
then the corresponding function will be disabled.<a name="TIOCGLTC"></a>
<br><br>

<b>TIOCGLTC (0x5404):</b>
<br>This command returns via the parameter <i>arg</i> a pointer to a
<a href="005014.html#ltchars">ltchars</a> structure in which extended terminal control characters are
defined.<a name="TIOCSLTC"></a>
<br><br>

<b>TIOCSLTC (0x5405):</b>
<br>With this command one can set new extended terminal control
characters. To do this, one passes in <i>arg</i> a pointer to a
<a href="005014.html#ltchars">ltchars</a> structure in which the control characters are defined. If a
character is set to 0 then the corresponding function will be
disabled.<a name="TIOCGPGRP"></a>
<br><br>

<b>TIOCGPGRP (0x5406):</b>
<br>This command returns via the parameter <i>arg</i> a pointer to
the process group ID of the terminal.<a name="TIOCSPGRP"></a>
<br><br>

<b>TIOCSPGRP (0x5407):</b>
<br>With this command one can set the process group ID of the
terminal. To do this, one passes in the parameter <i>arg</i> a
pointer to the corresponding process group. If processes from other
groups should attempt to access this terminal (read or write) then
they will be sent job control signals (<a href="005007.html#SIGTSTP">SIGTSTP</a> etc.).<a name="TIOCFLUSH"></a>
<br><br>

<b>TIOCFLUSH (0x5408):</b>
<br>With this command one can specify the type of flushing. For this,
one passes a pointer in the parameter <i>arg</i> to a LONG value that
describes the desired type. The following apply:<table>
<tr><td nowrap="nowrap" valign="top">Value</td>
<td valign="top">Meaning</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">0</td>
<td valign="top">Flush input and output</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit 0 set</td>
<td valign="top">Flush input</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit 1 set</td>
<td valign="top">Flush output

</td></tr>
</table>

<a name="TIOCSTOP"></a>
<br><br>

<b>TIOCSTOP (0x5409):</b>
<br>This command interrupts the output to the terminal (similar to
flow control with Control-S). The parameter <i>arg</i> is ignored in
this case.<a name="TIOCSTART"></a>
<br><br>

<b>TIOCSTART (0x540a):</b>
<br>This command restarts output to the terminal again (similar to
flow control with Control-Q). The parameter <i>arg</i> is ignored in
this case.<a name="TIOCGWINSZ"></a>
<br><br>

<b>TIOCGWINSZ (0x540b):</b>
<br>With this command one can inquire the size of a text window. For
this a pointer to a <a href="005014.html#winsize">winsize</a> structure is returned via the parameter
<i>arg</i>. If an element of this structure has the value 0, then it
means that the corresponding value is unknown.<a name="TIOCSWINSZ"></a>
<br><br>

<b>TIOCSWINSZ (0x540c):</b>
<br>With this command one can set the window size. For this a pointer
to a <a href="005014.html#winsize">winsize</a> structure is passed via the parameter <i>arg</i> which
contains the required information. In this connection one should note
that though the kernel handles the call, it leaves its execution to
window managers. These also send the signal <a href="005007.html#SIGWINCH">SIGWINCH</a> if necessary.<a name="TIOCGXKEY"></a>
<br><br>

<b>TIOCGXKEY (0x540d):</b>
<br>This command returns the current definition of a system key
(function, cursor etc.). For this a pointer to the <a href="005014.html#xkey">xkey</a> structure is
passed in the parameter <i>arg</i>. The element xk_num of the
structure has to be filled with the desired key:<br><br>


<div align="left">
<table border="0">
<tr>
  <td align="right" valign="top">xk_num</td>
  <td align="left" valign="top">Key</td>
</tr>
<tr>
  <td align="right" valign="top">0-9</td>
  <td align="left" valign="top">F1-F10</td>
</tr>
<tr>
  <td align="right" valign="top">10-19</td>
  <td align="left" valign="top">F11-F20 (reached via Shift)</td>
</tr>
<tr>
  <td align="right" valign="top">20</td>
  <td align="left" valign="top">Cursor up</td>
</tr>
<tr>
  <td align="right" valign="top">21</td>
  <td align="left" valign="top">Cursor down</td>
</tr>
<tr>
  <td align="right" valign="top">22</td>
  <td align="left" valign="top">Cursor to right</td>
</tr>
<tr>
  <td align="right" valign="top">23</td>
  <td align="left" valign="top">Cursor to left</td>
</tr>
<tr>
  <td align="right" valign="top">24</td>
  <td align="left" valign="top">Help</td>
</tr>
<tr>
  <td align="right" valign="top">25</td>
  <td align="left" valign="top">Undo</td>
</tr>
<tr>
  <td align="right" valign="top">26</td>
  <td align="left" valign="top">Insert</td>
</tr>
<tr>
  <td align="right" valign="top">27</td>
  <td align="left" valign="top">Clr/Home</td>
</tr>
<tr>
  <td align="right" valign="top">28</td>
  <td align="left" valign="top">Shift + cursor up</td>
</tr>
<tr>
  <td align="right" valign="top">29</td>
  <td align="left" valign="top">Shift + cursor down</td>
</tr>
<tr>
  <td align="right" valign="top">30</td>
  <td align="left" valign="top">Shift + cursor to right</td>
</tr>
<tr>
  <td align="right" valign="top">31</td>
  <td align="left" valign="top">Shift + cursor to left</td>
</tr>
</table>
</div>

<br><br>

The NULL-terminated string associated with the key (the convention
of the C language applies) is returned via the element xk_def.<a name="TIOCSXKEY"></a>
<br><br>

<b>TIOCSXKEY (0x540e):</b>
<br>With this command one can set the current definition of a system
key (function or cursor etc.). For this a pointer to the <a href="005014.html#xkey">xkey</a>
structure is passed in the parameter <i>arg</i>, in which the
elements xk_num and xk_def must have been set already. After the
execution of the command, <a href="#Fread">Fread</a> returns the text string (instead of
ASCII-0) specified in xk_def. This translation only happens, however,
if the program has been set into the MiNT domain with <a href="00500b.html#Pdomain">Pdomain</a> and if
the terminal is reading characters using <a href="#Fread">Fread</a>. As the string passed
in xk_def has to be NULL-terminated, one can pass a maximum of 7
characters in this way.<a name="TIOCIBAUD"></a>
<br><br>

<b>TIOCIBAUD (0x5412):</b>
<br>With this command one can set the Baud rate for input to the
terminal. For this a pointer is passed via the parameter <i>arg</i>
to a LONG value that specifies the Baud rate.<a name="TIOCOBAUD"></a>
<br><br>

<b>TIOCOBAUD (0x5413):</b>
<br>With this command one can set the Baud rate for output from the
terminal. For this a pointer is passed via the parameter <i>arg</i>
to a LONG value that specifies the Baud rate.<a name="TIOCCBRK"></a>
<br><br>

<b>TIOCCBRK (0x5414):</b>
<br>This command clears bit 3 of the TSR register (the break
condition) of the MFP68901 peripheral component. The parameter
<i>arg</i> is ignored.<a name="TIOCSBRK"></a>
<br><br>

<b>TIOCSBRK (0x5415):</b>
<br>This command sets bit 3 of the TSR register of the MFP68901
peripheral component. This causes a break signal to be sent as soon as
the transmit register is empty. The parameter <i>arg</i> is ignored.<a name="TIOCGFLAGS"></a>
<br><br>

<b>TIOCGFLAGS (0x5416):</b>
<br>This command returns in the lower 16 bits of the LONG pointed to
by the parameter <i>arg</i> the terminal control flags (i.e. the
current stop-bit and data-bit configuration). Valid mask values for
<i>arg</i> are:<br><br>


<div align="left">
<table border="0">
<tr>
  <td align="right" valign="top">Mask</td>
  <td align="left" valign="top">Meaning</td>
</tr>
<tr>
  <td align="right" valign="top">0x0001</td>
  <td align="left" valign="top">1 stop-bit</td>
</tr>
<tr>
  <td align="right" valign="top">0x0002</td>
  <td align="left" valign="top">1.5 stop-bits</td>
</tr>
<tr>
  <td align="right" valign="top">0x0003</td>
  <td align="left" valign="top">2 stop-bits</td>
</tr>
<tr>
  <td align="right" valign="top">0x0000</td>
  <td align="left" valign="top">8 data-bits</td>
</tr>
<tr>
  <td align="right" valign="top">0x0004</td>
  <td align="left" valign="top">7 data-bits</td>
</tr>
<tr>
  <td align="right" valign="top">0x0008</td>
  <td align="left" valign="top">6 data-bits</td>
</tr>
<tr>
  <td align="right" valign="top">0x000C</td>
  <td align="left" valign="top">5 data-bits</td>
</tr>
</table>
</div>

<a name="TIOCSFLAGS"></a>
<br><br>

<b>TIOCSFLAGS (0x5417):</b>
<br>This command sets new terminal control flags that are passed via
the parameter <i>arg</i>.<a name="TIOCOUTQ"></a>
<br><br>

<b>TIOCOUTQ (0x5418):</b>
<br>This command returns in <i>arg</i> a pointer to a LONG value in
which the number of bytes in the output buffer is stored.<a name="TIOCSETP"></a>
<br><br>

<b>TIOCSETP (0x5419):</b>
<br>Functions in a similar way to TIOCSETN, but with the difference
that (if the terminal supports TIOCOUTQ) the function only returns
when the output buffer is empty.<a name="TCURSOFF"></a>
<br><br>

<b>TCURSOFF (0x6300):</b>
<br>This command switches off the cursor of the terminal. The
parameter <i>arg</i> is ignored.<a name="TCURSON"></a>
<br><br>

<b>TCURSON (0x6301):</b>
<br>This command switches on the cursor of the terminal. The parameter
<i>arg</i> is ignored.<a name="TCURSBLINK"></a>
<br><br>

<b>TCURSBLINK (0x6302):</b>
<br>This command switches on blinking of the terminal's cursor. The
blink rate can be set with TCURSSRATE. The parameter <i>arg</i> is
ignored.<a name="TCURSSTEADY"></a>
<br><br>

<b>TCURSSTEADY (0x6303):</b>
<br>This command switches off blinking of the terminal's cursor again.
The parameter <i>arg</i> is ignored.<a name="TCURSSRATE"></a>
<br><br>

<b>TCURSSRATE (0x6304):</b>
<br>This command sets the blink rate of the terminal's cursor. For
this a pointer to a WORD value is passed in <i>arg</i> which
specifies after how many vertical blanks the cursor is to be inverted.<a name="TCURSGRATE"></a>
<br><br>

<b>TCURSGRATE (0x6305):</b>
<br>This command obtains the cursor blink rate of the terminal. This
is returned in a WORD value to which <i>arg</i> points.<a name="Fcntl_2C_20Process_20commands_20for"></a>
<br><br>

<b>The following commands are applicable only for processes
(opened as files)</b>. To open your own process as a file, you have to
specify the path for <a href="#Fopen">Fopen</a> as 'U:PROC\processname.-1'. Here the
extension -1 selects your own, and -2 the parent process.<a name="PBASEADDR"></a>
<br><br>

<b>PBASEADDR (0x5002):</b>
<br>In the parameter <i>arg</i> a pointer to the address of the
GEMDOS basepage of the process opened as a file is returned. The
command is supported in <a href="00b.html">MagiC</a> from Version 3.0 onwards.<a name="PPROCADDDR"></a>
<br><br>

<b>PPROCADDDR (0x5001):</b>
<br>In the parameter <i>arg</i> a pointer to the address of the PCB
(<b>P</b>rocess <b>C</b>ontrol <b>B</b>lock) is returned.<a name="PCTXTSIZE"></a>
<br><br>

<b>PCTXTSIZE (0x5003):</b>
<br>In the parameter <i>arg</i> a pointer to a LONG value is returned
in which the length of the process context structure is specified. Two
of these structures lie in memory before the PCB, whose address may be
inquired with PPROCADDR. The first structure is responsible for the
current process context, while the second contains the stored context
of the last system call.<a name="PSETFLAGS"></a>
<br><br>

<b>PSETFLAGS (0x5004):</b>
<br>This command sets the program flags (corresponding to those in the
<a href="005005.html#Program_20header">program header</a>. For this a pointer to a LONG value is passed in <i>arg</i>
whose lower 16 bits represent the program flags.<a name="PGETFLAGS"></a>
<br><br>

<b>PGETFLAGS (0x5005):</b>
<br>This command obtains the current <a href="005005.html#Flags_20of_20a_20program">program flags</a>. For this a pointer to
these flags is returned via the parameter <i>arg</i>.<a name="PTRACESFLAGS"></a>
<br><br>

<b>PTRACESFLAGS (0x5006):</b>
<br>This command sets the process trace flags. A pointer to a WORD
value is passed in the parameter <i>arg</i> that represents the
flags:<table>
<tr><td nowrap="nowrap" valign="top">P_ENABLE</td>
<td valign="top">= 1 (Enable tracing)</td></tr>

<tr><td nowrap="nowrap" valign="top">P_DOS</td>
<td valign="top">= 2 (Trace GEMDOS calls)</td></tr>

<tr><td nowrap="nowrap" valign="top">P_<a href="003.html">BIOS</a></td>
<td valign="top">= 4 (Trace BIOS calls)</td></tr>

<tr><td nowrap="nowrap" valign="top">P_<a href="004.html">XBIOS</a></td>
<td valign="top">= 8 (Trace XBIOS calls)

</td></tr>
</table>

<a name="PTRACEGFLAGS"></a>
<br><br>

<b>PTRACEGFLAGS (0x5007):</b>
<br>This command obtains the current process trace flags. A pointer to
these flags is returned via the parameter <i>arg</i>.<br><br>

<b>PTRACEGO (0x5008):</b> (from MC-68020 processor on)
<br><b>PTRACEFLOW (0x5009):</b>
<br><b>PTRACESTEP (0x500a):</b>
<br><b>PTRACE11 (0x500b):</b>
<br>These functions should in future enable tracing of processes. The
process to be traced must be in the 'suspended' state for this; it
will be reawakened by the trace function. These functions are however
not yet implemented at present.<a name="PLOADINFO"></a>
<br><br>

<b>PLOADINFO (0x500c):</b>
<br>This command returns in <i>arg</i> a pointer to the <a href="005014.html#ploadinfo">ploadinfo</a>
structure, in which the program name and command line are stored.<a name="PFSTAT"></a>
<br><br>

<b>PFSTAT (0x500d):</b>
<br>This command corresponds to FSTAT. It obtains the extended
attributes of the program file belonging to the process.<a name="Fcntl_2C_20SharedMem_20commands_20for"></a>
<br><br>

<b>The following commands are applicable only to files that
represent <a href="00b00b.html#Shared_20memory">shared memory</a>:</b><a name="SHMGETBLK"></a>
<br><br>

<b>SHMGETBLK (0x4d00):</b>
<br>This command returns the address of a memory block allocated with
SHMSETBLK (or a NULL-pointer in case of error). For the sake of
compatibility the parameter <i>arg</i> must be set to the value 0.
<b>Note:</b> Different processes may see the memory block at
different positions in their address space. For this reason a <a href="00b00b.html#Shared_20memory">shared memory</a>
block may not contain absolute pointers to data! The command is
supported in <a href="00b.html">MagiC</a> as of Version 3.0.<a name="SHMSETBLK"></a>
<br><br>

<b>SHMSETBLK (0x4d01):</b>
<br>A pointer is passed in the parameter <i>arg</i> to a memory block
that was earlier allocated with <a href="00500c.html#Malloc">Malloc</a>/<a href="00500c.html#Mxalloc">Mxalloc</a>. The memory is then
offered for sharing under the filename of the file with the handle
<i>fh</i>. For this the file must be created in the subdirectory
U:\SHM. The block is marked in such a way that it will not be released
at the termination of the process. The length will be obtained and
used both for the opened file as well as entered in the directory.
Invalid block addresses lead to the error-code <a href="005003.html#EIMBA">EIMBA</a> or to a bus- or
address-error. The command is supported in <a href="00b.html">MagiC</a> as of Version 3.0.<a name="Fcntl_2C_20CD-ROM_20commands_20for"></a>
<a name="CD-ROM_20functions"></a>
<br><br>

<b>The following commands are of interest in connection with
CD-ROM's:</b><a name="CDROMREADOFFSET"></a>
<br><br>

<b>CDROMREADOFFSET (0x4300):</b>
<br>This command obtains the block number of the first sector of the
last session of a multi-session CD. The parameter <i>arg</i>
contains this block number after the call.<a name="CDROMPAUSE"></a>
<br><br>

<b>CDROMPAUSE (0x4301):</b>
<br>This command causes a CD-ROM to enter the pause state when
playing an audio CD.<a name="CDROMRESUME"></a>
<br><br>

<b>CDROMRESUME (0x4302):</b>
<br>This command causes a CD-ROM to resume playing of an audio
CD (pause is rescinded).<a name="CDROMPLAYMSF"></a>
<br><br>

<b>CDROMPLAYMSF (0x4303):</b>
<br>This command starts audio playback. The parameter <i>arg</i> is a
pointer to a <a href="005014.html#cdrom_msf">cdrom_msf</a> structure, in which the start and end times are
to be entered in MSF notation.<a name="CDROMPLAYTRKIND"></a>
<br><br>

<b>CDROMPLAYTRKIND (0x4304):</b>
<br>This command starts audio playback. The parameter <i>arg</i> is a
pointer to a <a href="005014.html#cdrom_ti">cdrom_ti</a> structure in which the start and end positions
are to be entered in track/index notation. In most audio CD's
from the POP world the tracks are not subdivided any further. But many
classical CD's also have finer markings within tracks as indices.
<b>Warning:</b> Not every CD-ROM can access directly indices
other than 1!<a name="CDROMREADTOCHDR"></a>
<br><br>

<b>CDROMREADTOCHDR (0x4305):</b>
<br>This command allows one to obtain information about the structure
of a CD. The parameter <i>arg</i> is a pointer to a <a href="005014.html#cdrom_tochdr">cdrom_tochdr</a>
structure in which the first and last track of the CD are
entered.<a name="CDROMREADTOCENTRY"></a>
<br><br>

<b>CDROMREADTOCENTRY (0x4306):</b>
<br>This command allows one to obtain further information about the
structure of a CD. The parameter <i>arg</i> is a pointer to a
<a href="005014.html#cdrom_tocentry">cdrom_tocentry</a> structure in which the desired information is entered.<a name="CDROMSTOP"></a>
<br><br>

<b>CDROMSTOP (0x4307):</b>
<br>This command stops the corresponding drive.<a name="CDROMSTART"></a>
<br><br>

<b>CDROMSTART (0x4308):</b>
<br>This command starts the corresponding drive, and may also close
the drawer.<a name="CDROMEJECT"></a>
<br><br>

<b>CDROMEJECT (0x4309):</b>
<br>This command serves for opening the drawer of the corresponding
drive.<a name="CDROMVOLCTRL"></a>
<br><br>

<b>CDROMVOLCTRL (0x430a):</b>
<br>This command permits altering the volume and channel assignments
of the individual audio channels. The parameter <i>arg</i> is a
pointer to a <a href="005014.html#cdrom_volctrl">cdrom_volctrl</a> structure. The command is compatible to the
corresponding SunOS call. <b>Warning:</b> Altering the volume is not
possible with all devices!<a name="CDROMSUBCHNL"></a>
<br><br>

<b>CDROMSUBCHNL (0x430b):</b>
<br>This command obtains the current position data, as well as the
audio state. The parameter <i>arg</i> is a pointer to a <a href="005014.html#cdrom_subchnl">cdrom_subchnl</a>
structure.<a name="CDROMREADMODE2"></a>
<br><br>

<b>CDROMREADMODE2 (0x430c):</b>
<br>This command enables reading of Mode-2 sectors. Such sectors are
used by <a href="008009.html#XA">XA</a>-CDs (e.g.: Photo-CDs without error correction or Video-CDs)
and contain 2336 bytes. The parameter <i>arg</i> is a pointer to a
<a href="005014.html#cdrom_read">cdrom_read</a> structure. <b>Warning:</b> Not all devices can read these
sector types, and not all drivers offer this function.<a name="CDROMREADMODE1"></a>
<br><br>

<b>CDROMREADMODE1 (0x430d):</b>
<br>This command enables reading of Mode-1 sectors. Such sectors have
a size of 2048 bytes and are used on normal CD-ROMs. The
parameter <i>arg</i> is a pointer to a <a href="005014.html#cdrom_read">cdrom_read</a> structure.
<b>Warning:</b> Not all devices can read these sector types, and not
all drivers offer this function.<a name="CDROMPREVENTREMOVAL"></a>
<br><br>

<b>CDROMPREVENTREMOVAL (0x430e):</b>
<br>This command blocks the eject function of the corresponding
CD-ROM. This can be useful, for instance, if the device is
positioned in a public place and one wants to prevent theft of the
CD.<a name="CDROMALLOWREMOVAL"></a>
<br><br>

<b>CDROMALLOWRMOVAL (0x430f):</b>
<br>This command releases the eject function of the corresponding
CD-ROM once more.<a name="CDROMAUDIOCTRL"></a>
<br><br>

<b>CDROMAUDIOCTRL (0x4310):</b>
<br>This command permits altering the volume and channel assignments
of the individual audio channels. The parameter <i>arg</i> is a
pointer to a <a href="005014.html#cdrom_audioctrl">cdrom_audioctrl</a> structure. By setting the element
<i>set</i> of this structure to the value 0, one can inquire the
current settings. <b>Warning:</b> Altering the volume is not possible
with all devices!<a name="CDROMREADDA"></a>
<br><br>

<b>CDROMREADDA (0x4311):</b>
<br>This command permits the reading of Digital Audio (DA) sectors.
Such sectors have a size of 2352 bytes, and contain per sector 588
samples in 16-bit stereo-PCM format. The parameter <i>arg</i> is a
pointer to a <a href="005014.html#cdrom_read">cdrom_read</a> structure. <b>Warning:</b> Not all devices
can read these sector types, and not all drivers offer this function.<a name="CDROMGETMCN"></a>
<br><br>

<b>CDROMGETMCN (0x4313):</b>
<br>This command obtains the Media Catalog Number, which can be used
theoretically to identify a CD easily. Unfortunately this
information is present in only very few CDs. The parameter <i>arg</i>
is a pointer to a <a href="005014.html#cdrom_mcn">cdrom_mcn</a> structure.<a name="CDROMGETTISRC"></a>
<br><br>

<b>CDROMGETTISRC (0x4314):</b>
<br>This command obtains the Track International Standard Recording
Code, which should represent unique identifiers for individual tracks.
The parameter <i>arg</i> is a pointer to a <a href="005014.html#cdrom_tisrc">cdrom_tisrc</a> structure.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:<table>
<tr><td nowrap="nowrap" valign="top">>= 0 :</td>
<td valign="top">No error occurred (deviations see above).</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EIHNDL">EIHNDL</a> :</td>
<td valign="top">Invalid file handle.</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EINVFN">EINVFN</a> :</td>
<td valign="top">Command cannot be executed with the handle <i>fh</i>.

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">As of the first in MultiTOS integrated MiNT version 1.04, and
<a href="00b.html">MagiC</a> as of Version 3.0.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a>.</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fcntl">Binding</a> &nbsp; <a href="#Fdup">Fdup</a> &nbsp; <a href="#Flock">Flock</a> &nbsp; <a href="#Fopen">Fopen</a> &nbsp; <a href="#Fxattr">Fxattr</a> &nbsp; <a href="00500b.html#Pgetpgrp">Pgetpgrp</a> &nbsp; <a href="00500b.html#Psetpgrp">Psetpgrp</a> &nbsp;
<a href="00400d.html#Metaioctl">Metaioctl</a> &nbsp; <a href="005014.html#CD-ROM_20definitions">CD-ROM definitions</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fcntl"></a>5.9.5.1 Bindings for Fcntl</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Fcntl">Fcntl</a> ( int16_t fh, int32_t arg, int16_t cmd );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    cmd,-(sp)    ; Offset 8
move.l    arg,-(sp)    ; Offset 4
move.w    fh,-(sp)     ; Offset 2
move.w    #260,-(sp)   ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
lea       $A(sp),sp    ; Correct stack
</pre>


</td></tr>
</table>

<h3><a name="Fcreate"></a>5.9.6 Fcreate</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»File create« - Create a file.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">60</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int16_t Fcreate ( const int8_t *fname, int16_t attr );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The GEMDOS routine Fcreate creates a new file, or truncates an
existing one, with a given name and attributes. The following apply:<table>
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top">Meaning</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">fname</td>
<td valign="top">Pointer to the filename.</td></tr>

<tr><td nowrap="nowrap" valign="top">attr</td>
<td valign="top">File attributes:<table>
<tr><td nowrap="nowrap" valign="top">Bit 0:</td>
<td valign="top">File is write-protected</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit 1:</td>
<td valign="top">File is hidden</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit 2:</td>
<td valign="top">File is a system file</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit 3:</td>
<td valign="top">Volume label (diskette name)</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit 5:</td>
<td valign="top">Archive bit
</td></tr>
</table>


</td></tr>
</table>

<br><br>

<b>Note:</b> In a network, the creation of a file sets the
exclusivity. Whether the underlying GEMDOS is network capable can be
established via the cookie <a href="003007.html#Cookie_2C_20_FLK">_FLK</a>.<br><br>

<b>Note about <a href="00b.html">MagiC</a>:</b> If bit 3 in <i>attr</i> is set, then
the XFS function <a href="00b015.html#xfs_wlabel">xfs_wlabel</a> will be called. If this function can be
executed without an error, then the value 0x0000fffc will be returned.
This corresponds to a handle for the file NUL: or U:\DEV\NULL.
However, this feature is only present for reasons of compatibility; as
of MagiC 3, it is better to fall back on the function <a href="00500f.html#Dwritelabel">Dwritelabel</a>.<br><br>

The specified attributes exist only under DOS file-systems and are
ignored or emulated by other file-systems. With the Macintosh
file-system (HFS), for instance, only bit 0 of <i>attr</i> is
supported.<br><br>

Incidentally, symbolic links are dereferenced by this function, so
that if the file already exists as a symbolic link, the file
referenced from this link will be set to zero length.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns the following results:<table>
<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EPTHNF">EPTHNF</a> :</td>
<td valign="top">Access path is incorrect.</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#ENHNDL">ENHNDL</a> :</td>
<td valign="top">No more file handles left.</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EACCDN">EACCDN</a> :</td>
<td valign="top">Write access denied.</td></tr>

<tr><td nowrap="nowrap" valign="top">Otherwise :</td>
<td valign="top">ID of the file.

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">All GEMDOS versions. However, GEMDOS Version 0.13 creating a
read-only file returns a handle that is of not much use. <a href="005.html">GEMDOS</a>
versions below 0.15 wrongly allow more than one volume label per disk.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fcreate">Binding</a> &nbsp; <a href="#Fopen">Fopen</a> &nbsp; <a href="00b015.html">XFS-concept in MagiC</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fcreate"></a>5.9.6.1 Bindings for Fcreate</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int16_t <a href="#Fcreate">Fcreate</a> ( const int8_t *fname, int16_t attr );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    attr,-(sp)   ; Offset 6
pea       fname        ; Offset 2
move.w    #60,-(sp)    ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
addq.l    #8,sp        ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top">Handle%=Gemos(&H3c,L:fname%,W:attr)

</td></tr>
</table>

<h3><a name="Fdatime"></a>5.9.7 Fdatime</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»File date and time« - Obtain or set creation date and time
of a file.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">87</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">void Fdatime ( <a href="005014.html#DOSTIME">DOSTIME</a> *timeptr, int16_t handle, int16_t wflag
);</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The GEMDOS routine Fdatime reads or sets the date and time of
creation of a file. The following apply:<table>
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top">Meaning</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">timeptr</td>
<td valign="top">Pointer to date/time structure</td></tr>

<tr><td nowrap="nowrap" valign="top">handle</td>
<td valign="top">File ID</td></tr>

<tr><td nowrap="nowrap" valign="top">wflag</td>
<td valign="top"><table>
<tr><td nowrap="nowrap" valign="top">0 =</td>
<td valign="top">Obtain values</td></tr>

<tr><td nowrap="nowrap" valign="top">1 =</td>
<td valign="top">Set values
</td></tr>
</table>


</td></tr>
</table>

<br><br>

<b>Note:</b> Due to some errors in older versions of the GEMDOS,
the function should be applied in the following way:<ul>
<li>Open file</li>
<li>Call Fdatime</li>
<li>Close file</li>
</ul>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns no direct result.</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">All GEMDOS versions.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fdatime">Binding</a> &nbsp; <a href="00500a.html#Tgettime">Tgettime</a> &nbsp; <a href="00500a.html#Tsettime">Tsettime</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fdatime"></a>5.9.7.1 Bindings for Fdatime</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">void <a href="#Fdatime">Fdatime</a> ( <a href="005014.html#DOSTIME">DOSTIME</a> *timeptr, int16_t handle, int16_t wflag
);</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    wflag,-(sp)   ; Offset 8
move.w    handle,-(sp)  ; Offset 6
pea       timeptr       ; Offset 2
move.w    #87,-(sp)     ; Offset 0
trap      #1            ; <a href="005.html">GEMDOS</a>
lea       $A(sp),sp     ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top">Fehler%=Gemdos(&H57,L:timeptr%,W:handle%,W:wflag%)

</td></tr>
</table>

<h3><a name="Fdelete"></a>5.9.8 Fdelete</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»File delete« - Delete a file.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">65</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int16_t Fdelete ( const int8_t *fname );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The GEMDOS routine Fdelete deletes the file designated by
<i>fname</i>.<br><br>

<b>Note:</b> The function should not be applied to opened files.
As of <a href="00b.html">MagiC</a> 4, deletion also works for files with the 'Hidden' and
'System' attributes. In MagiC, furthermore, <i>no</i> symbolic
links will be dereferenced, i.e. the link will be deleted and
<i>not</i> the file or the folder to which the link points.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns the following results:<table>
<tr><td nowrap="nowrap" valign="top"><a href="005003.html#E_OK">E_OK</a></td>
<td valign="top">No error has arisen</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EFILNF">EFILNF</a></td>
<td valign="top">File not found</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EACCDN">EACCDN</a></td>
<td valign="top">Access denied

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">All GEMDOS versions.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fdelete">Binding</a> &nbsp; <a href="#Fcreate">Fcreate</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fdelete"></a>5.9.8.1 Bindings for Fdelete</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int16_t <a href="#Fdelete">Fdelete</a> ( const int8_t *fname );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>pea       fname        ; Offset 2
move.w    #65,-(sp)    ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
addq.l    #6,sp        ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top">Fehler%=Gemdos(&H41,L:fname%)

</td></tr>
</table>

<h3><a name="Fdup"></a>5.9.9 Fdup</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»File duplicate« - Duplicate a file handle.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">69</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int16_t Fdup ( int16_t handle );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The GEMDOS routine Fdup duplicates a standard file handle
(0-5) and assigns it a new handle (>6) for a standard channel. The
following apply:<table>
<tr><td nowrap="nowrap" valign="top">handle</td>
<td valign="top">Meaning</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">0</td>
<td valign="top">Keyboard (stdin:)</td></tr>

<tr><td nowrap="nowrap" valign="top">1</td>
<td valign="top">Screen (stdout:)</td></tr>

<tr><td nowrap="nowrap" valign="top">2</td>
<td valign="top">Serial port (stdaux:)</td></tr>

<tr><td nowrap="nowrap" valign="top">3</td>
<td valign="top">Parallel port (stdprn:)

</td></tr>
</table>

<br><br>

<b>Note:</b> In all known GEMDOS versions (up to and including
0.19) errors occur if, after an Fdup, a program is started with <a href="00500b.html#Pexec">Pexec</a>.
As of <a href="00b.html">MagiC</a> 4, one can also use this function to the device files -1,
-2, -3 (system global) and -4 (NULL device).</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns the following results:<table>
<tr><td nowrap="nowrap" valign="top"><a href="005003.html#ENHNDL">ENHNDL</a> :</td>
<td valign="top">No more handles available.</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EIHNDL">EIHNDL</a> :</td>
<td valign="top">Incorrect file handle.</td></tr>

<tr><td nowrap="nowrap" valign="top">Otherwise :</td>
<td valign="top">The desired new handle.

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">All GEMDOS versions.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fdup">Binding</a> &nbsp; <a href="#Fforce">Fforce</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fdup"></a>5.9.9.1 Bindings for Fdup</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int16_t <a href="#Fdup">Fdup</a> ( int16_t handle );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    handle,-(sp)  ; Offset 2
move.w    #69,-(sp)     ; Offset 0
trap      #1            ; <a href="005.html">GEMDOS</a>
addq.l    #4,sp         ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top">Phys_channel%=Gemdos(&H45,W:handle%)

</td></tr>
</table>

<h3><a name="Ffchmod"></a>5.9.10 Ffchmod</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Ffchmod« - Change access permissions for an open file.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">258 (0x0102)</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Ffchmod ( int16_t fd, int16_t mode);</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">See 'Name' above.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> Returns <a href="005003.html#E_OK">E_OK</a> on success or a negative GEMDOS error-code
otherwise.</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">Available as of FreeMiNT version 1.15.2</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Ffchmod">Binding</a> &nbsp; <a href="#Ffchown">Ffchown</a> &nbsp; <a href="#Fchmod">Fchmod</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Ffchmod"></a>5.9.10.1 Bindings for Ffchmod</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Ffchmod">Ffchmod</a> ( int16_t fd, int16_t mode);</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    mode,-(sp)   ; Offset 4
move.w    fd,-(sp)     ; Offset 2
move.w    #258,-(sp)   ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
addq.l    #6,sp        ; Correct stack
</pre>


</td></tr>
</table>

<h3><a name="Ffchown"></a>5.9.11 Ffchown</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Ffchown« - Changes ownership of an open file to uid and gid
respectively.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">257 (0x0101)</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Ffchown ( int16_t fd, int16_t uid, int16_t gid );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">This function changes ownership of an open file to <i>uid</i>
and <i>gid</i> respectively.<br><br>

A non-privileged process can only change the ownership of a file
that is owned by this user to the effective group id of the process or
one of its supplementary groups.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> Returns <a href="005003.html#E_OK">E_OK</a> on success or a negative GEMDOS error code
otherwise.</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">Available as of FreeMiNT version 1.15.2</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Ffchown">Binding</a> &nbsp; <a href="#Ffchmod">Ffchmod</a> &nbsp; <a href="#Fchown">Fchown</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Ffchown"></a>5.9.11.1 Bindings for Ffchown</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Ffchown">Ffchown</a> ( int16_t fd, int16_t uid, int16_t gid );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    gid,-(sp)    ; Offset 6
move.w    uid,-(sp)    ; Offset 4
move.w    fd,-(sp)     ; Offset 2
move.w    #257,-(sp)   ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
addq.l    #8,sp        ; Correct stack
</pre>


</td></tr>
</table>

<h3><a name="Fforce"></a>5.9.12 Fforce</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»File force« - Redirect standard file.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">70</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int16_t Fforce ( int16_t stdh, int16_t nonstdh );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The GEMDOS routine Fforce redirects a standard channel to a
specific other channel created by the application. The following
apply:<table>
<tr><td nowrap="nowrap" valign="top">stdh</td>
<td valign="top">Channel to be redirected<table>
<tr><td nowrap="nowrap" valign="top">0 =</td>
<td valign="top">Keyboard (stdin, con:)</td></tr>

<tr><td nowrap="nowrap" valign="top">1 =</td>
<td valign="top">Screen (stdout, con:)</td></tr>

<tr><td nowrap="nowrap" valign="top">2 =</td>
<td valign="top">Serial port (stdaux:)</td></tr>

<tr><td nowrap="nowrap" valign="top">3 =</td>
<td valign="top">Parallel port (stdprn:)
</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">nonstdh</td>
<td valign="top">Number of the replacement channel (as above)

</td></tr>
</table>

<br><br>

Under MiNT further channels may be redirected:<table>
<tr><td nowrap="nowrap" valign="top">-1 =</td>
<td valign="top">Refers to <a href="About_the_BIOS.html">BIOS</a> handle 2, redirects BIOS output</td></tr>

<tr><td nowrap="nowrap" valign="top">-2 =</td>
<td valign="top">Refers to BIOS handle 1, redirects BIOS output</td></tr>

<tr><td nowrap="nowrap" valign="top">-3 =</td>
<td valign="top">Refers to BIOS handle 0, redirects BIOS output</td></tr>

<tr><td nowrap="nowrap" valign="top">-4 =</td>
<td valign="top">GEMDOS handles -4 and -5 refer</td></tr>

<tr><td nowrap="nowrap" valign="top">-5 =</td>
<td valign="top">to MIDI input and output respectively. Redirecting them will
affect BIOS handle 3.

</td></tr>
</table>

<br><br>

<b>Note:</b> As of <a href="00b.html">MagiC</a> 4, this function can be used to redirect
device files -1,-2 and -3 (system global). The NULL device (-4)
however may <i>not</i> be redirected.<br><br>

To redirect, say, screen output to a printer one can use a
construct such as Fforce(1, <a href="#Fdup">Fdup</a>(3)).</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns the following results:<table>
<tr><td nowrap="nowrap" valign="top"><a href="005003.html#E_OK">E_OK</a> :</td>
<td valign="top">No error has arisen</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EIHNDL">EIHNDL</a> :</td>
<td valign="top">Incorrect handle

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">All GEMDOS versions.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">Comment:</td>
<td valign="top">This function is used often to redirect the input or output of
a child process. It should be used together with <a href="#Fdup">Fdup</a> to restore the
standard handle before the process terminates. You should note also
that any file handle redirected to a standard handle (say con:) will
be closed when the child exits and should not be closed by the parent.</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="Fforce.html#Bindings_20for_20Fforce">Binding</a> &nbsp; <a href="#Fdup">Fdup</a> &nbsp; <a href="00b00b.html#The_20directory_20U:_5CDEV">Directory U:\DEV</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fforce"></a>5.9.12.1 Bindings for Fforce</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int16_t <a href="#Fforce">Fforce</a> ( int16_t stdh, int16_t nonstdh );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    nonstdh,-(sp)  ; Offset 4
move.w    stdh,-(sp)     ; Offset 2
move.w    #70,-(sp)      ; Offset 0
trap      #1             ; <a href="005.html">GEMDOS</a>
addq.l    #6,sp          ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top">Fehler%=Gemdos(&H46,W:stdh%,W:nonstdh%)

</td></tr>
</table>

<h3><a name="Fgetchar"></a>5.9.13 Fgetchar</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Fgetchar« - Read a character from a file.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">263</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Fgetchar ( int16_t fh, int16_t mode );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The function reads a character from the file with the handle
<i>fh</i>. The parameter <i>mode</i> is only of interest when the
opened file is a (pseudo-)terminal. In that case the following values
apply:<table>
<tr><td nowrap="nowrap" valign="top">mode</td>
<td valign="top">Meaning</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">0</td>
<td valign="top"><b>Raw mode</b>
<br>No evaluation of control characters</td></tr>

<tr><td nowrap="nowrap" valign="top">1</td>
<td valign="top"> <b>Cooked mode</b>
<br>Special control characters (Control-C, Control-Z) will be looked
for and interpreted if appropriate; the same applies for flow control
(Control-S, Control-Q)</td></tr>

<tr><td nowrap="nowrap" valign="top">2</td>
<td valign="top"> <b>Echo mode</b>
<br>Read characters will be output on the terminal

</td></tr>
</table>

<br><br>

The ASCII value of the character read will be stored in the low
byte of the LONG returned by the function. For cases where the file is
a (pseudo-)terminal, the scancode and Shift status will be returned as
for <a href="About_the_BIOS.html#Bconin">Bconin</a>.<br><br>

The individual modes of <i>mode</i> can naturally also be
combined with an OR operation.<br><br>

<b>Warning:</b> This function is optional, hence a call may be
answered with <a href="005003.html#EINVFN">EINVFN</a>.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:<table>
<tr><td nowrap="nowrap" valign="top">>= 0 :</td>
<td valign="top">No error, but the read character</td></tr>

<tr><td nowrap="nowrap" valign="top">0xff1a :</td>
<td valign="top">End-of-File (EOF) was recognized</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EIHNDL">EIHNDL</a> :</td>
<td valign="top">Invalid file handle

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">As of the first in MultiTOS integrated MiNT version 1.04.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fgetchar">Binding</a> &nbsp; <a href="About_the_BIOS.html#Bconin">Bconin</a> &nbsp; <a href="005010.html#Cconin">Cconin</a> &nbsp; <a href="005010.html#Cauxin">Cauxin</a> &nbsp; <a href="#Fputchar">Fputchar</a> &nbsp; <a href="#Fread">Fread</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fgetchar"></a>5.9.13.1 Bindings for Fgetchar</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Fgetchar">Fgetchar</a> ( int16_t fh, int16_t mode );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    mode,-(sp)   ; Offset 4
move.w    fh,-(sp)     ; Offset 2
move.w    #263,-(sp)   ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
addq.l    #6,sp        ; Correct stack
</pre>


</td></tr>
</table>

<h3><a name="Fgetdta"></a>5.9.14 Fgetdta</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Get disk transfer address« - Obtain the transfer address for
floppy disk operations.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">47</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top"><a href="005014.html#DTA">DTA</a> *Fgetdta ( void );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The GEMDOS routine Fgetdta obtains the address of a buffer for
<a href="#Fsfirst">Fsfirst</a> and <a href="#Fsnext">Fsnext</a>.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns a pointer to the address of the <a href="005014.html#DTA">DTA</a>
(<b>D</b>isk <b>T</b>ransfer <b>A</b>ddress).</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">All GEMDOS versions.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">Comment:</td>
<td valign="top">When an application launches, its <a href="005014.html#DTA">DTA</a> overlaps the command line
string in the process' basepage. Any use of the <a href="#Fsfirst">Fsfirst</a> or <a href="#Fsnext">Fsnext</a> call
withoutn first reallocating a new <a href="005014.html#DTA">DTA</a> will cause the process' command
line to be corrupted. To prevent this, you should use <a href="#Fsetdta">Fsetdta</a> to
define a new <a href="005014.html#DTA">DTA</a> structure for your process prior to using <a href="#Fsfirst">Fsfirst</a> or
<a href="#Fsnext">Fsnext</a>. Be careful of assigning your <a href="005014.html#DTA">DTA</a> to a local or automatic
variable without setting it to its original value before the variable
goes out of scope.</td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fgetdta">Binding</a> &nbsp; <a href="#Fsetdta">Fsetdta</a> &nbsp; <a href="#Fsfirst">Fsfirst</a> &nbsp; <a href="#Fsnext">Fsnext</a> &nbsp; <a href="005014.html#DTA">DTA</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fgetdta"></a>5.9.14.1 Bindings for Fgetdta</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top"><a href="005014.html#DTA">DTA</a> *<a href="#Fgetdta">Fgetdta</a> ( void );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    #47,-(sp)    ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
addq.l    #2,sp        ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top">Pointer%=Gemdos(&H2F)

</td></tr>
</table>

<h3><a name="Finstat"></a>5.9.15 Finstat</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Finstat« - Determine input status of a file.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">261</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Finstat ( int16_t fh );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The function Finstat returns the maximum number of bytes that
may be read from a file with the handle <i>fh</i> without having to
wait.<br><br>

If the number of bytes cannot be reported exactly, then the value
1 will be returned.<br><br>

<b>Note:</b> In <a href="00b.html">MagiC</a>, the kernel first tries to implement the
call in <a href="#Fcntl">Fcntl</a> (<a href="005009.html#FIONREAD">FIONREAD</a>). If this subfunction of <a href="00b015.html#dev_ioctl">dev_ioctl</a> does not
exist (i.e. the file driver returns <a href="005003.html#EINVFN">EINVFN</a>), then <a href="00b015.html#dev_stat">dev_stat</a> will be
called. In that case this can only result in the statement "Character
available" (return == 1) or "No character available" (return == 0).
FAT files and (1link [shared memory][<a href="00b00b.html#Shared_20memory">Shared memory</a>]) return the actual
file length minus the current position. <a href="00b00b.html#Pipes">Pipes</a> return the number of
bytes present in the block.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:<table>
<tr><td nowrap="nowrap" valign="top">>= 0 :</td>
<td valign="top">No error occurred (number of bytes)</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EIHNDL">EIHNDL</a> :</td>
<td valign="top">Invalid file handle

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">As of the first in MultiTOS integrated MiNT version 1.04, and
in MagiC as of Version 3.0.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Finstat">Binding</a> &nbsp; <a href="005010.html#Cauxis">Cauxis</a> &nbsp; <a href="005010.html#Cconis">Cconis</a> &nbsp; <a href="#Fcntl">Fcntl</a> &nbsp; <a href="#Foutstat">Foutstat</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Finstat"></a>5.9.15.1 Bindings for Finstat</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Finstat">Finstat</a> ( int16_t fh );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    fh,-(sp)     ; Offset 2
move.w    #261,-(sp)   ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
addq.l    #4,sp        ; Correct stack
</pre>


</td></tr>
</table>

<h3><a name="Flink"></a>5.9.16 Flink</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Flink« - Create a new (hard-)link to a file.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">301</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Flink ( int8_t *oldname, int8_t *newname );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The function Flink creates a new name (<i>newname</i>) for the
file named <i>oldname</i>. The file can later be addressed under both
names, and the deletion (with <a href="#Fdelete">Fdelete</a>) of one name has no effect on
the other.<br><br>

One should note that <i>oldname</i> and <i>newname</i> have to
lie on the same physical drive, and also that not all <a href="005002.html#File-systems">file-systems</a> offer
the option of setting links.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:<table>
<tr><td nowrap="nowrap" valign="top"><a href="005003.html#E_OK">E_OK</a> :</td>
<td valign="top">No error has arisen</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EINVFN">EINVFN</a> :</td>
<td valign="top">The file-system does not support hard links</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EFILNF">EFILNF</a> :</td>
<td valign="top">The file <i>oldname</i> does not exist</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EXDEV">EXDEV</a> :</td>
<td valign="top">(As below)</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#ENSAME">ENSAME</a> :</td>
<td valign="top">The files <i>oldname</i>/<i>newname</i> do not lie on the
same physical drive

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">Available when a 'MiNT' cookie with a version of at least 0.90
exists and in <a href="00b.html">MagiC</a> as of Version 3.0</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Flink">Binding</a> &nbsp; <a href="#Frename">Frename</a> &nbsp; <a href="#Fsymlink">Fsymlink</a> &nbsp; <a href="00b015.html">XFS-concept in MagiC</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Flink"></a>5.9.16.1 Bindings for Flink</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Flink">Flink</a> ( int8_t *oldname, int8_t *newname );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>pea       newname      ; Offset 6
pea       oldname      ; Offset 2
move.w    #301,-(sp)   ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
lea       $A(sp),sp    ; Correct stack
</pre>


</td></tr>
</table>

<h3><a name="Flock"></a>5.9.17 Flock</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»File record locking« - Lock or unlock part of a file.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">92</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Flock ( int16_t handle, int16_t mode, int32_t start,
int32_t length );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The GEMDOS routine Flock serves to protect portions of a file
from access by other processes. The following apply:<table>
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top">Meaning</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">handle</td>
<td valign="top">File ID</td></tr>

<tr><td nowrap="nowrap" valign="top">mode</td>
<td valign="top"><table>
<tr><td nowrap="nowrap" valign="top">0 =</td>
<td valign="top">Apply lock</td></tr>

<tr><td nowrap="nowrap" valign="top">1 =</td>
<td valign="top">Remove lock
</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">start</td>
<td valign="top">Start position in the file</td></tr>

<tr><td nowrap="nowrap" valign="top">length</td>
<td valign="top">Number of bytes affected

</td></tr>
</table>

<br><br>

<b>Warning:</b> This function is optional, hence the call may
return <a href="005003.html#EINVFN">EINVFN</a> as a reply. In particular, one should note that Flock
need not be available on <i>all</i> installed file-systems.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:<table>
<tr><td nowrap="nowrap" valign="top"><a href="005003.html#E_OK">E_OK</a> :</td>
<td valign="top">No error has arisen</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#ELOCKED">ELOCKED</a> :</td>
<td valign="top">Overlapping portion of file already locked</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#ENSLOCK">ENSLOCK</a> :</td>
<td valign="top">Matching lock not found for removal

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">Only present when '<a href="003007.html#Cookie_2C_20_FLK">_FLK</a>' cookie exists.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Flock">Binding</a> &nbsp; <a href="#Fcreate">Fcreate</a> &nbsp; <a href="#Fopen">Fopen</a> &nbsp; <a href="#Fclose">Fclose</a> &nbsp; <a href="#Fdelete">Fdelete</a> &nbsp; <a href="00500b.html#Ptermres">Ptermres</a> &nbsp;
<a href="005009.html#F_SETLK">F_SETLK</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Flock"></a>5.9.17.1 Bindings for Flock</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Flock">Flock</a> ( int16_t handle, int16_t mode, int32_t start,
int32_t length );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.l    length,-(sp)  ; Offset 10
move.l    start,-(sp)   ; Offset  6
move.w    mode,-(sp)    ; Offset  4
move.w    handle,-(sp)  ; Offset  2
move.w    #92,-(sp)     ; Offset  0
trap      #1            ; <a href="005.html">GEMDOS</a>
lea       $E(sp),sp     ; Correct stack
</pre>


</td></tr>
</table>

<h3><a name="Fmidipipe"></a>5.9.18 Fmidipipe</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Fmidipipe« - Redirect MIDI input/output.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">294</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Fmidipipe ( int16_t pid, int16_t in, int16_t out );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The function Fmidipipe alters the GEMDOS handles for MIDI
inout and output for the process with the ID <i>pid</i>. The
parameters <i>in</i> and <i>out</i> describe the GEMDOS handles
that take on MIDI input and output respectively for the process.<br><br>

In the case <i>pid</i> = 0, the current process will be used.
Then The function call is equivalent to the following two lines:<pre><a href="#Fforce">Fforce</a> (-4, in);
<a href="#Fforce">Fforce</a> (-5, out);
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:<table>
<tr><td nowrap="nowrap" valign="top"><a href="005003.html#E_OK">E_OK</a> :</td>
<td valign="top">No error has arisen</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EFILNF">EFILNF</a> :</td>
<td valign="top">The process <i>pid</i> was not found</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EACCDN">EACCDN</a> :</td>
<td valign="top"><i>in</i>/<i>out</i> are not open for reading or writing</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EIHNDL">EIHNDL</a> :</td>
<td valign="top"><i>in</i>/<i>out</i> is not a valid handle

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">Available when a 'MiNT' cookie with a version of at least 0.90
exists.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fmidipipe">Binding</a> &nbsp; <a href="#Fdup">Fdup</a> &nbsp; <a href="#Fforce">Fforce</a> &nbsp; <a href="005004.html">Test for pipes</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fmidipipe"></a>5.9.18.1 Bindings for Fmidipipe</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Fmidipipe">Fmidipipe</a> ( int16_t pid, int16_t in, int16_t out );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    out,-(sp)    ; Offset 6
move.w    in,-(sp)     ; Offset 4
move.w    pid,-(sp)    ; Offset 2
move.w    #294,-(sp)   ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
addq.l    #8,sp        ; Correct stack
</pre>


</td></tr>
</table>

<h3><a name="Fopen"></a>5.9.19 Fopen</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»File open« - Open a given file.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">61</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Fopen ( const int8_t *fname, int16_t mode );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The GEMDOS routine Fopen serves for opening specified files.
The following apply:<table>
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top">Meaning</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">fname</td>
<td valign="top">Name of file to be opened</td></tr>

<tr><td nowrap="nowrap" valign="top">mode</td>
<td valign="top">Mode, as bit-vector:<table>
<tr><td nowrap="nowrap" valign="top">Bit-0..2</td>
<td valign="top">= <b>Access mode</b><table>
<tr><td nowrap="nowrap" valign="top">0 =</td>
<td valign="top">Read only</td></tr>

<tr><td nowrap="nowrap" valign="top">1 =</td>
<td valign="top">Write only</td></tr>

<tr><td nowrap="nowrap" valign="top">2 =</td>
<td valign="top">Read and write
</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit-3</td>
<td valign="top">= Reserved (to be set to 0)</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit-4..6</td>
<td valign="top">= Sharing-Modus</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit-7</td>
<td valign="top">= Inheritance flag
</td></tr>
</table>

<br>

The bits 3..7 are only available with a GEMDOS that offers file
locking extensions (test for _FLK cookie). The inheritance flag
determines whether a child started by a process inherits any open file
handles and has the same access as the parent. If this flag is set
then a child has to reopen any files it wishes to use and must face
the same sharing restrictions that other processes must share. The
sharing mode determines the way other processes may access the file
once it has been opened. The following apply:<table>
<tr><td nowrap="nowrap" valign="top">Sharing</td>
<td valign="top">Meaning</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">0</td>
<td valign="top">Compatibility mode (will be used by those programs that do not
know about network extensions). If the file's read-only bit is set
then this is the same as deny writing; otherwise it is the same as
deny reading/writing.</td></tr>

<tr><td nowrap="nowrap" valign="top">1</td>
<td valign="top">Reading and writing denied (the file may not be opened a second
time)</td></tr>

<tr><td nowrap="nowrap" valign="top">2</td>
<td valign="top">Writing denied (the file may only be reopened for reading)</td></tr>

<tr><td nowrap="nowrap" valign="top">3</td>
<td valign="top">Reading denied (the file may only be reopened for writing)</td></tr>

<tr><td nowrap="nowrap" valign="top">4</td>
<td valign="top">Everything is allowed
</td></tr>
</table>


</td></tr>
</table>

<br><br>

<b>Warning:</b> The file locking may be implemented in an
advisory manner, i.e. it may be possible to access segments despite
the presence of a lock. Programs that support file locking should
therefore set their own lock <i>before</i> making an access and
release it again immediately <i>after</i> the access. In this way one
can guarantee that possible locks set by others will be respected.<br><br>

In MiNT and <a href="00b.html">MagiC</a> there are in addition the following modes
available:<table>
<tr><td nowrap="nowrap" valign="top">mode</td>
<td valign="top">Meaning</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">0x080</td>
<td valign="top">Reserved for MiNT</td></tr>

<tr><td nowrap="nowrap" valign="top">0x100</td>
<td valign="top">Do not block file for I/O</td></tr>

<tr><td nowrap="nowrap" valign="top">0x200</td>
<td valign="top">Create file, if this does not exist</td></tr>

<tr><td nowrap="nowrap" valign="top">0x400</td>
<td valign="top">Set existing file to zero length</td></tr>

<tr><td nowrap="nowrap" valign="top">0x800</td>
<td valign="top">Do not open existing file

</td></tr>
</table>

<br><br>

<b>Note:</b> For some devices, standard channel numbers already
exist, so that it is not necessary to call Fopen. In detail:<table>
<tr><td nowrap="nowrap" valign="top">Channel</td>
<td valign="top">Meaning</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">0</td>
<td valign="top">Keyboard (stdin:)</td></tr>

<tr><td nowrap="nowrap" valign="top">1</td>
<td valign="top">Screen (stdout:)</td></tr>

<tr><td nowrap="nowrap" valign="top">2</td>
<td valign="top">Serial port (stdaux:)</td></tr>

<tr><td nowrap="nowrap" valign="top">3</td>
<td valign="top">Parallel port (stdprn:)

</td></tr>
</table>

<br><br>

According to Atari the standard channel numbers 4 and 5 are
reserved, so that normal channel numbers for files only start at 6.<br><br>

In addition it is also possible to open the following
character-oriented devices:<ul>
<li>PRN: (parallel port, -3)</li>
<li>AUX: (serial port, -2)</li>
<li>CON: (console, -1)</li>
</ul>

<br><br>

Symbolic links are automatically dereferenced by this function,
i.e. if the file already exists as a symbolic link, the file
referenced from it will be opened or, depending on the mode, truncated
to zero length.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns the corresponding file handle in the
lower WORD of the positive LONG, or a negative error-message.</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top"> All GEMDOS versions.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fopen">Binding</a> &nbsp; <a href="#Fcreate">Fcreate</a> &nbsp; <a href="003002.html">The BIOS input/output channels</a> &nbsp; <a href="005009.html#F_SETLK">F_SETLK</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fopen"></a>5.9.19.1 Bindings for Fopen</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Fopen">Fopen</a> ( const int8_t *fname, int16_t mode );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    mode,-(sp)   ; Offset 6
pea       fname        ; Offset 2
move.w    #61,-(sp)    ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
addq.l    #8,sp        ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top">Handle%=Gemdos(&H3D,L:fname%,W:mode%)

</td></tr>
</table>

<h3><a name="Foutstat"></a>5.9.20 Foutstat</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Foutstat« - Determine the output status of a file.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">262</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Foutstat ( int16_t fh );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The function Foutstat returns the number of bytes that may be
written to the file with the handle <i>fh</i> without blocking the
corresponding process.<br><br>

If the exact number of bytes cannot be specified, then the value 1
will be returned.<br><br>

<b>Note:</b> In <a href="00b.html">MagiC</a>, the kernel first tries to implement the
call in <a href="#Fcntl">Fcntl</a> (<a href="005009.html#FIONWRITE">FIONWRITE</a>). If this subfunction of <a href="00b015.html#dev_ioctl">dev_ioctl</a> does not
exist (i.e. the file driver returns <a href="005003.html#EINVFN">EINVFN</a>), then <a href="00b015.html#dev_stat">dev_stat</a> will be
called. In that case this can only result in the statement "One
character can be written" (return == 1) or "No character can be
written" (return == 0). FAT files always return the value 1, <a href="00b00b.html#Shared_20memory">shared memory</a>
returns the actual file length minus the current position. <a href="00b00b.html#Pipes">Pipes</a>
return the number of bytes still free in the block.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:<table>
<tr><td nowrap="nowrap" valign="top">>= 0 :</td>
<td valign="top">No error arisen (number of bytes)</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EIHNDL">EIHNDL</a> :</td>
<td valign="top">Invalid file handle.

</td></tr>
</table>

<br><br>

Note that currently this function always returns 1 for disk files</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">As of the first in MultiTOS integrated MiNT version 1.04, and
in MagiC as of Version 3.0.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Foutstat">Binding</a> &nbsp; <a href="005010.html#Cauxos">Cauxos</a> &nbsp; <a href="005010.html#Cconos">Cconos</a> &nbsp; <a href="005010.html#Cprnos">Cprnos</a> &nbsp; <a href="#Fcntl">Fcntl</a> &nbsp; <a href="#Finstat">Finstat</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Foutstat"></a>5.9.20.1 Bindings for Foutstat</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Foutstat">Foutstat</a> ( int16_t fh );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    fh,-(sp)     ; Offset 2
move.w    #262,-(sp)   ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
addq.l    #4,sp        ; Correct stack
</pre>


</td></tr>
</table>

<h3><a name="Fpipe"></a>5.9.21 Fpipe</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Fpipe« - Create a pipe.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">256</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int16_t Fpipe ( int16_t usrh[2] );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The function Fpipe creates a pipe that may be used for
inter-process communication (IPC). It is normally used by shells that
wish to redirect the input and output of their child processes; prior
to launching the child process, the shell redirects its input and
output (as necessary) to the read and write ends of the newly created
file. On a successful call, two GEMDOS handles will be returned in
<i>usrh</i>.<br><br>

<i>usrh</i>[0] denotes the handle for the read-end of the pipe,
(read-only) while <i>usrh</i>[1] the handle for the write-end of the
pipe (write-only).<br><br>

The pipe produced in this way will be created in the directory
U:\PIPE as a pseudo-file and will be named 'sys$pipe.xxx', where 'xxx'
represent a three-digit integer.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:<table>
<tr><td nowrap="nowrap" valign="top"><a href="005003.html#E_OK">E_OK</a> :</td>
<td valign="top">No error has arisen</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#ENHNDL">ENHNDL</a> :</td>
<td valign="top">No 2 handles free any more</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EACCDN">EACCDN</a> :</td>
<td valign="top">No pipeline free any more (max. 999 available)</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#ENSMEM">ENSMEM</a> :</td>
<td valign="top">Not enough memory free to create the pipe

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">Available when a 'MiNT' cookie with a version of at least 0.90
exists and in <a href="00b.html">MagiC</a> as of Version 3.0.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fpipe">Binding</a> &nbsp; <a href="#Fmidipipe">Fmidipipe</a> &nbsp; <a href="005004.html">Test for pipes</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fpipe"></a>5.9.21.1 Bindings for Fpipe</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int16_t <a href="#Fpipe">Fpipe</a> ( int16_t usrh[2] );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>pea       usrh         ; Offset 2
move.w    #256,-(sp)   ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
addq.l    #6,sp        ; Correct stack
</pre>


</td></tr>
</table>

<h3><a name="Fputchar"></a>5.9.22 Fputchar</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Fputchar« - Write a character to a given file.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">264</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Fputchar ( int16_t fh, int32_t ch, int16_t mode );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The function Fputchar writes a character to the file with the
handle <i>fh</i>. The parameter <i>mode</i> is only significant if
the file is a (pseudo-)terminal:<table>
<tr><td nowrap="nowrap" valign="top">mode</td>
<td valign="top">Meaning</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">0</td>
<td valign="top"><b>Raw mode</b>
<br>No evaluation of control characters</td></tr>

<tr><td nowrap="nowrap" valign="top">1</td>
<td valign="top"> <b>Cooked mode</b>
<br>Special control characters (Control-C, Control-Z) will be looked
for and interpreted if appropriate; the same applies for flow control
(Control-S, Control-Q)

</td></tr>
</table>

<br><br>

If the file is a (pseudo-)terminal, then all 4 bytes can be
tranmitted. In this way it is possible to transmit simulated BIOS
scancodes and Shift-status messages. Otherwise only the low byte of
<i>ch</i> will be transmitted.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following values:<table>
<tr><td nowrap="nowrap" valign="top">4 :</td>
<td valign="top">Number of written bytes, if the file is a terminal</td></tr>

<tr><td nowrap="nowrap" valign="top">1 :</td>
<td valign="top">Output successful, but file is not a terminal</td></tr>

<tr><td nowrap="nowrap" valign="top">0 :</td>
<td valign="top">Bytes could not be written (perhaps due to flow control)</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EIHNDL">EIHNDL</a> :</td>
<td valign="top">Invalid file handle</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">A negative BIOS error-code if an error occurred during I/O.

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">As of the first in MultiTOS integrated MiNT version 1.04.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fputchar">Binding</a> &nbsp; <a href="About_the_BIOS.html#Bconout">Bconout</a> &nbsp; <a href="005010.html#Cauxout">Cauxout</a> &nbsp; <a href="005010.html#Cconout">Cconout</a> &nbsp; <a href="005010.html#Crawio">Crawio</a> &nbsp; <a href="#Fgetchar">Fgetchar</a> &nbsp;
<a href="#Fwrite">Fwrite</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fputchar"></a>5.9.22.1 Bindings for Fputchar</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Fputchar">Fputchar</a> ( int16_t fh, int32_t ch, int16_t mode );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    mode,-(sp)   ; Offset 8
move.l    ch,-(sp)     ; Offset 4
move.w    fh,-(sp)     ; Offset 2
move.w    #264,-(sp)   ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
lea       $A(sp),sp    ; Correct stack
</pre>


</td></tr>
</table>

<h3><a name="Fread"></a>5.9.23 Fread</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»file read« - Read from a file.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">63</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Fread ( int16_t handle, int32_t count, void *buf );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The GEMDOS routine Fread reads a given number of bytes from a
file. The following apply:<table>
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top">Meaning</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">handle</td>
<td valign="top">File handle identifier</td></tr>

<tr><td nowrap="nowrap" valign="top">count</td>
<td valign="top">Number of bytes of data to read</td></tr>

<tr><td nowrap="nowrap" valign="top">buf</td>
<td valign="top">Address of the receiving buffer (at least <i>count</i> bytes
long)

</td></tr>
</table>

<br><br>

<b>Note:</b> In all GEMDOS Versions < 0.15 the system will
freeze if the parameter <i>count</i> has a value of 0. When reading
from standard channels, a maximum of 16383 characters may be read.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns either a positive number showing the
number of bytes actually read, which may be lower than <i>count</i>
if an EOF (end of file) was encountered, or a negative GEMDOS
error-code:<table>
<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EIHNDL">EIHNDL</a> :</td>
<td valign="top">Wrong file handle</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#ELOCKED">ELOCKED</a> :</td>
<td valign="top">File segment is marked as locked

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">All GEMDOS versions.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fread">Binding</a> &nbsp; <a href="#Fwrite">Fwrite</a> &nbsp; <a href="005009.html#FIONREAD">FIONREAD</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fread"></a>5.9.23.1 Bindings for Fread</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Fread">Fread</a> ( int16_t handle, int32_t count, void *buf );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>pea       buf           ; Offset 8
move.l    count,-(sp)   ; Offset 4
move.w    handle,-(sp)  ; Offset 2
move.w    #63,-(sp)     ; Offset 0
trap      #1            ; <a href="005.html">GEMDOS</a>
lea       $C(sp),sp     ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top">Fehler%=Gemdos(&H3F,W:handle%,L:count%,L:buf%)

</td></tr>
</table>

<h3><a name="Freadlink"></a>5.9.24 Freadlink</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Freadlink« - Follow symbolic link.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">303</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Freadlink ( int16_t bufsiz, int8_t *buf, int8_t *name
);</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The function Freadlink determines the filename of the symbolic
link <i>name</i>. This is the name that was specified for the first
parameter of <a href="#Fsymlink">Fsymlink</a>.<br><br>

The name is stored in buffer <i>buf</i>, which has a length of
<i>bufsiz</i> characters.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:<table>
<tr><td nowrap="nowrap" valign="top"><a href="005003.html#E_OK">E_OK</a> :</td>
<td valign="top">No error has arisen</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EINVFN">EINVFN</a> :</td>
<td valign="top">The file-system of <i>name</i> does not permit any symbolic
links</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EFILNF">EFILNF</a> :</td>
<td valign="top">The symbolic link <i>name</i> was not found</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EACCDN">EACCDN</a> :</td>
<td valign="top"><i>name</i> is not a symbolic link</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#ERANGE">ERANGE</a> :</td>
<td valign="top">The buffer <i>buf</i> is too small for the filename that is to
be determined

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">Available when a 'MiNT' cookie with a version of at least 0.90
exists and in <a href="00b.html">MagiC</a> as of Version 3.0.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Freadlink">Binding</a> &nbsp; <a href="#Fsymlink">Fsymlink</a> &nbsp; <a href="00b015.html">XFS-concept in MagiC</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Freadlink"></a>5.9.24.1 Bindings for Freadlink</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Freadlink">Freadlink</a> ( int16_t bufsiz, int8_t *buf, int8_t *name
);</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>pea       Name          ; Offset 10
pea       buf           ; Offset  6
move.w    bufsiz,-(sp)  ; Offset  2
move.w    #303,-(sp)    ; Offset  0
trap      #1            ; <a href="005.html">GEMDOS</a>
lea       $C(sp),sp     ; Correct stack
</pre>


</td></tr>
</table>

<h3><a name="Frename"></a>5.9.25 Frename</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»file rename« - Rename a GEMDOS file.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">86</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Frename ( const int8_t *oldname, const int8_t *newname
);</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The GEMDOS routine Frename serves for renaming files. The new
name may also contain a complete access path within the relevant
physical drive; in that case the file will be moved. The following
apply:<table>
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top">Meaning</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">oldname</td>
<td valign="top">Pointer to present name</td></tr>

<tr><td nowrap="nowrap" valign="top">newname</td>
<td valign="top">Pointer to new name

</td></tr>
</table>

<br><br>

<b>Note:</b> As of GEMDOS Version 0.15 it is possible to alter
the names of directories as well. However, these cannot be moved. One
should avoid renaming files that are already open.<br><br>

<b>Note about <a href="00b.html">MagiC</a>:</b> It is up to the <a href="00b015.html">XFS</a> to decide
whether directories may be renamed or moved. The integrated DOS-XFS
only allows a moving of directories as of MagiC 5.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns the following results:<table>
<tr><td nowrap="nowrap" valign="top"><a href="005003.html#E_OK">E_OK</a> :</td>
<td valign="top">No error has arisen</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EPTHNF">EPTHNF</a> :</td>
<td valign="top">Directory not found</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EACCDN">EACCDN</a> :</td>
<td valign="top">Access denied (write-protected)</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#ENSAME">ENSAME</a> :</td>
<td valign="top">Destination not on same drive

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">All GEMDOS versions.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Frename">Binding</a> &nbsp; <a href="#Fdelete">Fdelete</a> &nbsp; <a href="00b015.html">XFS-concept in MagiC</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Frename"></a>5.9.25.1 Bindings for Frename</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Frename">Frename</a> ( const int8_t *oldname, const int8_t *newname
);</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>pea       newname      ; Offset 8
pea       oldname      ; Offset 4
move.w    #0,-(sp)     ; Offset 2
move.w    #86,-(sp)    ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
lea       $C(sp),sp    ; Correct stack
</pre>
<br><br>

<b>Note:</b> The Null-parameter will normally be appended
automatically for a C binding.</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top">Fehler%=Gemdos(&H56,W:0,L:oldname%,L:newname%)

</td></tr>
</table>

<h3><a name="Fseek"></a>5.9.26 Fseek</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»file seek« - Move file position pointer.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">66</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Fseek ( int32_t offset, int16_t handle, int16_t
seekmode );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The GEMDOS routine Fseek permits the file pointer to be moved
to a new position within a file. The following apply:<table>
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top">Meaning</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">offset</td>
<td valign="top">Number of bytes that are to be skipped</td></tr>

<tr><td nowrap="nowrap" valign="top">handle</td>
<td valign="top">GEMDOS file handle</td></tr>

<tr><td nowrap="nowrap" valign="top">seekmode</td>
<td valign="top">Type of repositioning:<table>
<tr><td nowrap="nowrap" valign="top">0 =</td>
<td valign="top">From start of file</td></tr>

<tr><td nowrap="nowrap" valign="top">1 =</td>
<td valign="top">From current position</td></tr>

<tr><td nowrap="nowrap" valign="top">2 =</td>
<td valign="top">From end of file
</td></tr>
</table>


</td></tr>
</table>

<br><br>

<b>Note:</b> Applied to pipes the function returns the value
<a href="005003.html#EACCDN">EACCDN</a>; this way applications can differentiate between devices and
pipes.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns a positive value of the new absolute
location of the file pointer from the start of the file, or a negative
error-message.</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">All GEMDOS versions.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fseek">Binding</a> &nbsp; <a href="#Fread">Fread</a> &nbsp; <a href="#Fwrite">Fwrite</a> &nbsp; <a href="005004.html">Test for pipes</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fseek"></a>5.9.26.1 Bindings for Fseek</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Fseek">Fseek</a> ( int32_t offset, int16_t handle, int16_t
seekmode );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    seekmode,-(sp)  ; Offset 8
move.w    handle,-(sp)    ; Offset 6
move.l    offset,-(sp)    ; Offset 2
move.w    #66,-(sp)       ; Offset 0
trap      #1              ; <a href="005.html">GEMDOS</a>
lea       $A(sp),sp       ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top">Fehler%=Gemdos(&H42,L:offset%,W:handle%,W:seekmode%)

</td></tr>
</table>

<h3><a name="Fselect"></a>5.9.27 Fselect</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Fselect« - Enquiry of the file status with timeout.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">285</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Fselect ( uint16_t timeout, int32_t *rfds, int32_t
*wfds, ((int32_t) 0) );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The function Fselect checks which open files are ready for
reading or writing. The parameter <i>rfds</i> points to a LONG bitmap
which describes the set of GEMDOS read file descriptors to wait for.<br><br>

In this longword, bit <i>n</i> is set when the file descriptor
<i>n</i> is to be checked for input. An empty set may also be
represented optionally by a NULL-pointer.<br><br>

In the same way, <i>wfds</i> points to a set of write file
descriptors whose output status is to be checked.<br><br>

On return of the function, the handles of the files that are ready
for reading or writing respectively and also should be checked are
passed in <i>rfds</i> and <i>wfds</i>.<br><br>

Note that currently the only <a href="About_the_BIOS.html">BIOS</a> device Fselect works with is
the keyboard.<br><br>

With <i>timeout</i> one can specify how many milliseconds one
should wait before the function returns. A value of 0 means in this
case that the function waits until one of the specified files is ready
for reading or writing.<br><br>

Example:<table>
<tr><td nowrap="nowrap" valign="top">Fselect (0, 0L, 0L, 0L)</td>
<td valign="top">waits forever</td></tr>

<tr><td nowrap="nowrap" valign="top">Fselect (1, 0L, 0L, 0L)</td>
<td valign="top">waits for one millisecond

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:<table>
<tr><td nowrap="nowrap" valign="top">0 :</td>
<td valign="top">In the specified time no files were ready for reading or
writing (timeout)</td></tr>

<tr><td nowrap="nowrap" valign="top">>0 :</td>
<td valign="top">Sum of the set bits of <i>rfds</i> and <i>wfds</i></td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EIHNDL">EIHNDL</a> :</td>
<td valign="top">At least one of the handles is not assigned to an open file

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">As of the first in MultiTOS integrated MiNT version 1.04 And
<a href="00b.html">MagiC</a> since version 3.00</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fselect">Binding</a> &nbsp; <a href="#Finstat">Finstat</a> &nbsp; <a href="#Foutstat">Foutstat</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fselect"></a>5.9.27.1 Bindings for Fselect</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Fselect">Fselect</a> ( uint16_t timeout, int32_t *rfds, int32_t
*wfds, ((int32_t) 0) );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.l    dummy,-(sp)    ; Offset 12
pea       wfds           ; Offset  8
pea       rfds           ; Offset  4
move.w    timeout,-(sp)  ; Offset  2
move.w    #285,-(sp)     ; Offset  0
trap      #1             ; <a href="005.html">GEMDOS</a>
lea       $10(sp),sp     ; Correct stack
</pre>


</td></tr>
</table>

<h3><a name="Fsetdta"></a>5.9.28 Fsetdta</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Set disk transfer address« - Set the address for the
transfer region for floppy disk operations.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">26</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">void Fsetdta ( <a href="005014.html#DTA">DTA</a> *buf );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The GEMDOS routine Fsetdta sets the address of the memory
segment that will be used as the new <a href="005014.html#DTA">DTA</a>. The parameter <i>buf</i> is
a pointer to this structure.<br><br>

<b>Note:</b> At program launch the DTA will be established
starting at offset 0x80 in the basepage.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function does not return a result.</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">All GEMDOS versions.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fsetdta">Binding</a> &nbsp; <a href="#Fgetdta">Fgetdta</a> &nbsp; <a href="#Fsfirst">Fsfirst</a> &nbsp; <a href="005014.html#BASEPAGE">BASEPAGE</a> &nbsp; <a href="005014.html#DTA">DTA</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fsetdta"></a>5.9.28.1 Bindings for Fsetdta</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">void <a href="#Fsetdta">Fsetdta</a> ( <a href="005014.html#DTA">DTA</a> *buf );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>pea       buf          ; Offset 2
move.w    #26,-(sp)    ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
addq.l    #6,sp        ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top">Fehler%=Gemdos(&H1A,L:buf%)

</td></tr>
</table>

<h3><a name="Fsfirst"></a>5.9.29 Fsfirst</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»search first file« - Search for first file entry.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">78</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Fsfirst ( const int8_t *filename, int16_t attr );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The GEMDOS routine Fsfirst can obtain information about the
first occurrence of a file or subdirectory. The following apply:<table>
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top">Meaning</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">filename</td>
<td valign="top">Pointer to the filename or subdirectory</td></tr>

<tr><td nowrap="nowrap" valign="top">attr</td>
<td valign="top">Attributes that should be matched by the file searched for<table>
<tr><td nowrap="nowrap" valign="top">Bit-0:</td>
<td valign="top">Include read-only files</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit-1:</td>
<td valign="top">Include hidden files</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit-2:</td>
<td valign="top">Include system files</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit-3:</td>
<td valign="top">Include volume labels</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit-4:</td>
<td valign="top">Include subdirectories</td></tr>

<tr><td nowrap="nowrap" valign="top">Bit-5:</td>
<td valign="top">Include files with archive-bit set
</td></tr>
</table>


</td></tr>
</table>

<br><br>

The filename or path may also contain the jokers '*' and '?'. When
the function terminates, the directory entry will fill the disk
transfer area (<a href="005014.html#DTA">DTA</a>), whose location can be obtained or set with
<a href="#Fgetdta">Fgetdta</a> and <a href="#Fsetdta">Fsetdta</a> respectively. The required information can then be
obtained from the DTA structure.<br><br>

The DTA must be initialised with Fsfirst!<br><br>

<b>Note:</b> If the program runs in the <a href="00500b.html#MiNT-domain">MiNT-domain</a>, Fsfirst will
return lower case filenames. As <a href="005002.html#File-systems">file-systems</a> exist that are case sensitive,
you should avoid making such conversions manually. However, if you
absolutely need upper case filenames you should use <a href="00500b.html#Pdomain">Pdomain</a> to make
your program run in the <a href="00500b.html#TOS-domain">TOS-domain</a>.<br><br>

<b>Notes about MagiC:</b> If bit 3 of <i>attr</i> is set, then the kernel
will call the <a href="00b015.html">XFS</a> function <a href="00b015.html#xfs_rlabel">xfs_rlabel</a>. The calling user program
can unfortunately no longer get the date and time of the disk name
under MagiC with this. The kernel sets all fields to 0 and the
function <a href="#Fsnext">Fsnext</a> may not be executed. As of MagiC 3, the function
<a href="00500f.html#Dreadlabel">Dreadlabel</a> is used instead, which also manages long filenames.<br><br>

If bit 3 of <i>attr</i> is not set, a search for files is made as
in TOS. If a file is a symbolic link, the DOS kernel calls the
function <a href="#Fxattr">Fxattr</a> to follow the link. The values returned by <a href="#Fxattr">Fxattr</a> are
then copied to the DTA.<br><br>

<b>Warning:</b> MagiC is not always able to evaluate correctly
relative symbolic links during Fsfirst/Fsnext. There are three ways
to overcome this:<table>
<tr><td nowrap="nowrap" valign="top">(a)</td>
<td valign="top">Best: use <a href="00500f.html#Dxreaddir">Dxreaddir</a></td></tr>

<tr><td nowrap="nowrap" valign="top">(b)</td>
<td valign="top">Use only absolute symbolic links</td></tr>

<tr><td nowrap="nowrap" valign="top">(c)</td>
<td valign="top">Alays make the search directory the current one

</td></tr>
</table>

<br><br>

Though MiNT handles this case correctly, it is at a huge cost. The
Fsfirst/next concept is basically obsolete, ineffective and unsafe,
and should be avoided both in MiNT as well as in MagiC.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns the following results:<table>
<tr><td nowrap="nowrap" valign="top"><a href="005003.html#E_OK">E_OK</a> :</td>
<td valign="top">No error has occurred</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EFILNF">EFILNF</a> :</td>
<td valign="top">File not found</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#ENMFIL">ENMFIL</a> :</td>
<td valign="top">No more files

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">All GEMDOS versions.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fsfirst">Binding</a> &nbsp; <a href="#Fgetdta">Fgetdta</a> &nbsp; <a href="#Fsetdta">Fsetdta</a> &nbsp; <a href="#Fsnext">Fsnext</a> &nbsp; <a href="005014.html#DTA">DTA</a> &nbsp; <a href="005014.html#DTA">Recursive search</a> &nbsp; <a href="00b015.html">XFS-concept</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fsfirst"></a>5.9.29.1 Bindings for Fsfirst</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Fsfirst">Fsfirst</a> ( const int8_t *filename, int16_t attr );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    attr,-(sp)   ; Offset 6
pea       filename     ; Offset 2
move.w    #78,-(sp)    ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
addq.l    #8,sp        ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top">Fehler%=Gemdos(&H4E,L:filename%,W:attr%)

</td></tr>
</table>

<h3><a name="Fsnext"></a>5.9.30 Fsnext</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»search next file« - Search for next file entry.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">79</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int16_t Fsnext ( void );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The GEMDOS routine Fsnext searches for the next file entry
that matches the criteria specified in <a href="#Fsfirst">Fsfirst</a>. It should be called as
often as necessary after a <a href="#Fsfirst">Fsfirst</a> call to find all files that match
the search criteria.<br><br>

Be aware that this function uses the application's DTA which
initially shares its memory location with the processes' command line.
Hence using this function without first assigning a new DTA will
corrupt the command line.<br><br>

<b>Note:</b> If the program runs in the <a href="00500b.html#MiNT-domain">MiNT-domain</a>, Fsnext will
return lower case filenames. As <a href="005002.html#File-systems">file-systems</a> exist that are case sensitive,
you should avoid making such conversions manually. However, if you
absolutely need upper case filenames you should use <a href="00500b.html#Pdomain">Pdomain</a> to make
your program run in the <a href="00500b.html#TOS-domain">TOS-domain</a>.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns 0 if a matching file was found, else a
negative error-message.</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">All GEMDOS versions.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fsnext">Binding</a> &nbsp; <a href="#Fgetdta">Fgetdta</a> &nbsp; <a href="#Fsetdta">Fsetdta</a> &nbsp; <a href="#Fsfirst">Fsfirst</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fsnext"></a>5.9.30.1 Bindings for Fsnext</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int16_t <a href="#Fsnext">Fsnext</a> ( void );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>move.w    #79,-(sp)    ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
addq.l    #2,sp        ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top">Fehler%=Gemdos(&H4F)

</td></tr>
</table>

<h3><a name="Fsymlink"></a>5.9.31 Fsymlink</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Fsymlink« - Create a symbolic link to a file.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">302</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Fsymlink ( int8_t *oldname, int8_t *newname );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The function Fsymlink creates a symbolic link <i>newname</i>
for the file named <i>oldname</i>. If the call succeeds then the file
can later be accessed under both names. Deletion with <a href="#Fdelete">Fdelete</a> for
<i>newname</i> does not affect the file itself, but only the symbolic
link. However, if Fdelete is applied to <i>oldname</i>, then the file
will be deleted as usual, and accesses to <i>newname</i> are no
longer possible.<br><br>

The difference to hard links lies in the fact that symbolic links
can exist between different physical devices (and with that even
different file-system types).</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:<table>
<tr><td nowrap="nowrap" valign="top"><a href="005003.html#E_OK">E_OK</a> :</td>
<td valign="top">No error has arisen</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EINVFN">EINVFN</a> :</td>
<td valign="top">The file-system does not support symbolic links

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">Available when a 'MiNT' cookie with a version of at least 0.90
exists and in <a href="00b.html">MagiC</a> as of Version 3.0.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fsymlink">Binding</a> &nbsp; <a href="#Flink">Flink</a> &nbsp; <a href="#Freadlink">Freadlink</a> &nbsp; <a href="#Frename">Frename</a> &nbsp; <a href="00b015.html">XFS-concept</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fsymlink"></a>5.9.31.1 Bindings for Fsymlink</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Fsymlink">Fsymlink</a> ( int8_t *oldname, int8_t *newname );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>pea       newname      ; Offset 6
pea       oldname      ; Offset 2
move.w    #302,-(sp)   ; Offset 0
trap      #1           ; <a href="005.html">GEMDOS</a>
lea       $A(sp),sp    ; Correct stack
</pre>


</td></tr>
</table>

<h3><a name="Fwrite"></a>5.9.32 Fwrite</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»file write« - Write to a specified file.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">64</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Fwrite ( int16_t handle, int32_t count, void *buf );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The GEMDOS routine Fwrite writes a given number of bytes to a
specified GEMDOS file. The following apply:<table>
<tr><td nowrap="nowrap" valign="top">Parameter</td>
<td valign="top">Meaning</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">handle</td>
<td valign="top">File handle identifier</td></tr>

<tr><td nowrap="nowrap" valign="top">count</td>
<td valign="top">Number of bytes to be written</td></tr>

<tr><td nowrap="nowrap" valign="top">buf</td>
<td valign="top">Start address of the buffer

</td></tr>
</table>

<br><br>

<b>Note about <a href="00b.html">MagiC</a>:</b> If one passes the value 0 for the number
of bytes to be written, and the value -1 in <i>buf</i>, then the file
will be <i>truncated</i> to the current position of the file pointer.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function returns the number of bytes actually written, or
one of the following error-messages:<table>
<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EACCDN">EACCDN</a> :</td>
<td valign="top">Access denied</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EIHNDL">EIHNDL</a> :</td>
<td valign="top">Invalid file handle</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#ELOCKED">ELOCKED</a> :</td>
<td valign="top">File segment is marked as protected

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">All GEMDOS versions.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"><a href="#Bindings_20for_20Fwrite">Binding</a> &nbsp; <a href="#Fread">Fread</a> &nbsp; <a href="005009.html#FIONWRITE">FIONWRITE</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fwrite"></a>5.9.32.1 Bindings for Fwrite</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Fwrite">Fwrite</a> ( int16_t handle, int32_t count, void *buf );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>pea       buf           ; Offset 8
move.l    count,-(sp)   ; Offset 4
move.w    handle,-(sp)  ; Offset 2
move.w    #64,-(sp)     ; Offset 0
trap      #1            ; <a href="005.html">GEMDOS</a>
lea       $C(sp),sp     ; Correct stack
</pre>
</td></tr>

<tr><td nowrap="nowrap" valign="top">GFA-Basic</td>
<td valign="top">Fehler%=Gemdos(&H40,W:handle,L:count%,L:buf%)

</td></tr>
</table>

<h3><a name="Fxattr"></a>5.9.33 Fxattr</h3>
<table>
<tr><td nowrap="nowrap" valign="top">Name:</td>
<td valign="top">»Fxattr« - Obtain extended file attributes.</td></tr>

<tr><td nowrap="nowrap" valign="top">Opcode:</td>
<td valign="top">300</td></tr>

<tr><td nowrap="nowrap" valign="top">Syntax:</td>
<td valign="top">int32_t Fxattr ( int16_t flag, int8_t *name, <a href="005014.html#XATTR">XATTR</a> *xattr );</td></tr>

<tr><td nowrap="nowrap" valign="top">Description:</td>
<td valign="top">The function Fxattr obtains the extended attributes of the file
whose complete name is specified in <i>name</i>, and saves these in
<i>xattr</i>.<br><br>

The parameter <i>flag</i> specifies how symbolic links are to be
treated. The following apply:<table>
<tr><td nowrap="nowrap" valign="top">flag</td>
<td valign="top">Meaning</td></tr>

<tr><td nowrap="nowrap" valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td></tr>

<tr><td nowrap="nowrap" valign="top">0</td>
<td valign="top">Symbolic links are followed to the source file and the extended
attributes are obtained from this file. (This corresponds to the
procedure <i>stat</i> under UNIX).</td></tr>

<tr><td nowrap="nowrap" valign="top">1</td>
<td valign="top">The extended attributes of the symbolic link itself are
obtained. (This corresponds to the procedure <i>lstat</i> under
UNIX).

</td></tr>
</table>

<br><br>

<b>Note:</b> This function is equivalent to a call of <a href="#Fcntl">Fcntl</a> (mode
F_STAT) with the difference that instead of a filename, the handle of
an already opened file is passed.</td></tr>

<tr><td nowrap="nowrap" valign="top">Return value:</td>
<td valign="top"> The function can return the following results:<table>
<tr><td nowrap="nowrap" valign="top"><a href="005003.html#E_OK">E_OK</a> :</td>
<td valign="top">No error has arisen</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EFILNF">EFILNF</a> :</td>
<td valign="top">File not found</td></tr>

<tr><td nowrap="nowrap" valign="top"><a href="005003.html#EPTHNF">EPTHNF</a> :</td>
<td valign="top">Path to file not found

</td></tr>
</table>

</td></tr>

<tr><td nowrap="nowrap" valign="top">Availability:</td>
<td valign="top">Available when a 'MiNT' cookie with a version of at least 0.90
exists and in <a href="00b.html">MagiC</a> as of Version 3.0.</td></tr>

<tr><td nowrap="nowrap" valign="top">Group:</td>
<td valign="top"><a href="#File_20functions">File functions</a></td></tr>

<tr><td nowrap="nowrap" valign="top">See also:</td>
<td valign="top"> <a href="#Bindings_20for_20Fxattr">Binding</a> &nbsp; <a href="#Fattrib">Fattrib</a> &nbsp; <a href="#Fsnext">Fsnext</a> &nbsp; <a href="00b015.html">XFS-concept in MagiC</a>

</td></tr>
</table>

<h4><a name="Bindings_20for_20Fxattr"></a>5.9.33.1 Bindings for Fxattr</h4>
<table>
<tr><td nowrap="nowrap" valign="top">C:</td>
<td valign="top">int32_t <a href="#Fxattr">Fxattr</a> ( int16_t flag, int8_t *name, <a href="005014.html#XATTR">XATTR</a> *xattr );</td></tr>

<tr><td nowrap="nowrap" valign="top">Assembler:</td>
<td valign="top"><pre>pea       xattr        ; Offset 10
pea       name         ; Offset  6
move.w    flag,-(sp)   ; Offset  2
move.w    #300,-(sp)   ; Offset  0
trap      #1           ; <a href="005.html">GEMDOS</a>
lea       $C(sp),sp    ; Correct stack
</pre>


</td></tr>
</table>

<hr>

<a id="UDO_nav_hm_FOOT" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a><a id="UDO_nav_up_FOOT" href="005.html"><img src="udo_up.gif" alt="GEMDOS" title="GEMDOS" border="0" width="24" height="24"></a><a id="UDO_nav_lf_FOOT" href="005008.html"><img src="udo_lf.gif" alt="gemdos-trap" title="gemdos-trap" border="0" width="24" height="24"></a><a id="UDO_nav_rg_FOOT" href="00500a.html"><img src="udo_rg.gif" alt="Date and Time" title="Date and Time" border="0" width="24" height="24"></a></body>
</html>
