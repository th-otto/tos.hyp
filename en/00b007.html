<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
<title>
The documentation for TOS: Scrollable input fields
</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="Generator" content="UDO 7.04 (1296) for Linux">
</head>
<body>
<? include "/var/www/banner.php"; ?>

<a id="UDO_nav_hm_HEAD" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a><a id="UDO_nav_up_HEAD" href="00b.html"><img src="udo_up.gif" alt="MagiC" title="MagiC" border="0" width="24" height="24"></a><a id="UDO_nav_lf_HEAD" href="00b006.html"><img src="udo_lf.gif" alt="Input fields in MagiC" title="Input fields in MagiC" border="0" width="24" height="24"></a><a id="UDO_nav_rg_HEAD" href="00b008.html"><img src="udo_rg.gif" alt="Special error-messages in MagiC" title="Special error-messages in MagiC" border="0" width="24" height="24"></a>
<hr>

<h1><a name="Scrollable_20input_20fields"></a>11.7 Scrollable input fields</h1>
<pre>/*******************************************************************
*
* This sample program demonstrates the use of scrollable
* input fields in <a href="00b.html">MagiC</a> 3.
*
*******************************************************************/

#include <<a href="008002.html#aes">aes</a>.h>
#include <tos.h>
#include <string.h>
#include <magx.h>
#include "magxlib.h"
#include "edscroll.h"

#define TLEN  30

int  do_dialog    (<a href="008016.html#OBJECT">OBJECT</a> *dialog);

void main()
{
  <a href="008016.html#OBJECT">OBJECT</a> *adr_dialog;
  ULONG crdate;
  int is_scroll;

  <a href="008016.html#XTED">XTED</a> xted;
  char tmplt[TLEN+1],txt[TLEN+1];


  /* Check whether the system can scrolledit */
  /* ------------------------------------------ */

  is_scroll = ((0 < get_<a href="00b.html">MagiC</a>_ver(&crdate)) &&
    (crdate >= 0x19950829L));

     /* Register application with the <a href="008.html">AES</a> */
     /* ----------------------------- */

     if   (<a href="Application.html#appl_init">appl_init</a>() < 0)
          <a href="00500b.html#Pterm">Pterm</a>(1);

     /* Resourcedatei laden */
     /* ------------------- */
     if   (!<a href="008011.html#rsrc_load">rsrc_load</a>("edscroll.rsc"))
     {
          <a href="00800b.html#form_alert">form_alert</a>(1, "[3][ \"EDSCROLL.RSC\"|not found!][Cancel]");
          goto err;
     }

     <a href="008011.html#rsrc_gaddr">rsrc_gaddr</a>(0, EDIT, &adr_dialog);

  /* Initialize scroll <a href="008016.html#TEDINFO">TEDINFO</a>  */
  /* ----------------------------- */

  init_scrlted(adr_dialog+EDITTXT, is_scroll, &xted,
        txt, tmplt, TLEN);

  strcpy(txt, "Beispiel");

  /* Dialog */
  /* ------ */

     <a href="008009.html#wind_update">wind_update</a>(<a href="008009.html#BEG_MCTRL">BEG_MCTRL</a>);
     <a href="00800c.html#graf_mouse">graf_mouse</a>(<a href="00800c.html#ARROW">ARROW</a>, 0L);
     do_dialog(adr_dialog);
     <a href="008009.html#wind_update">wind_update</a>(<a href="008009.html#END_MCTRL">END_MCTRL</a>);
     <a href="008011.html#rsrc_free">rsrc_free</a>();

  err:
     <a href="Application.html#appl_exit">appl_exit</a>();
     <a href="00500b.html#Pterm0">Pterm0</a>();
}


/****************************************************************
*
* do_dialog
*
****************************************************************/

int do_dialog(<a href="008016.html#OBJECT">OBJECT</a> *dialog)
{
     int cx, cy, cw, ch;
     int exitbutton;

     <a href="00800b.html#form_center">form_center</a>(dialog, &cx, &cy, &cw, &ch);
     <a href="00800b.html#form_dial">form_dial</a>(<a href="00800b.html#FMD_START">FMD_START</a>, 0,0,0,0, cx, cy, cw, ch);
     <a href="008010.html#objc_draw">objc_draw</a>(dialog, ROOT, MAX_DEPTH, cx, cy, cw, ch);
     exitbutton = 0x7f & <a href="00800b.html#form_do">form_do</a>(dialog, 0);
     <a href="00800b.html#form_dial">form_dial</a>(<a href="00800b.html#FMD_FINISH">FMD_FINISH</a>, 0,0,0,0,cx, cy, cw, ch);
     return(exitbutton);
}


/*******************************************************************
*
* Ascertain <a href="00b.html">MagiC</a> version
* =======================
*
* If <crdate> != NULL, the creation date will be returned
* in the form yyyymmdd. With '<' and '>' one can then
* ascertain directly whether a given function is available
* in the <a href="00b.html">MagiC</a> version in question.
*
* Return value:  0     No <a href="00b.html">MagiC</a> <a href="004011.html#installed">installed</a>
*               -1     Still in AUTO folder
*           0x0a0b     Version a.b
*
*******************************************************************/

WORD get_<a href="00b.html">MagiC</a>_ver(ULONG *crdate)
{
  ULONG *cookie;
  <a href="010009.html#AESVARS">AESVARS</a> *av;

  cookie = get_cookie('MagX');
  if  (!cookie)
    return(0);
  else
  {
    av = ((<a href="003007.html#MAGX_COOKIE">MAGX_COOKIE</a> *) (*cookie))->aesvars;
    if  (!av)
      return(-1);
    else if (crdate)
    {
      *crdate = av->date << 16L;                /* yyyy0000 */
      *crdate |= av->date >> 24L;               /* yyyy00dd */
      *crdate |= (av->date >> 8L) & 0xff00L;    /* yyyymmdd */
      return(av->version);
    }
  }
}


/****************************************************************
*
* Makes an F(BOX)TEXT object scrollable if <a href="00b.html">MagiC</a> is running.
*
* If <is_scroll> is FALSE, only the text field will be converted
* to a user character string.
*
* In the RCS, the text field should be left empty, but the template
* and the validation character string have to be input, as the RCS
* will strike otherwise.
* For scrolling fields a new template has to be created, as the
* one registered in the .RSC file cannot be used since it is too
* short. The template created here consists only of '_' characters,
* since this covers 99.9% of all applications for scrolling objects.
* The length of the validation string is immaterial. i.e. has to be
* at least 1, as the <a href="008.html">AES</a> automatically duplicates the validation
* string until the length of the text field has been filled.
*
* The maximum length for the input character string is in every case
* (<a href="008016.html#TEDINFO">TEDINFO</a>.te_txtlen - 1).
*
****************************************************************/

void init_scrlted(<a href="008016.html#OBJECT">OBJECT</a> *o, WORD is_scroll, <a href="008016.html#XTED">XTED</a> *xted,
        char *txt, char *tmplt, WORD len)
{
  <a href="008016.html#TEDINFO">TEDINFO</a> *t;

  t = o->ob_spec.tedinfo;
  t->te_just = TE_LEFT;   /* Important! */
  t->te_ptext = txt;
  if  (is_scroll)
  {
    memset(tmplt, '_', len);  /* New template */
    tmplt[len] = '\0';
    xted->xte_ptmplt = tmplt;
    xted->xte_pvalid = t->te_pvalid;
    xted->xte_vislen = t->te_tmplen - 1;
    xted->xte_scroll = 0;

    t->te_tmplen = len+1;
    t->te_ptmplt = NULL;
    t->te_pvalid = (void *) xted;
  }
  t->te_txtlen = t->te_tmplen;
}
</pre>
<p>See also: <a href="008001.html">About the AES</a> &nbsp; <a href="00b006.html">Input fields in MagiC</a> &nbsp; <a href="002002.html">GEM</a> &nbsp; <a href="008016.html#TEDINFO">TEDINFO</a></p>

<hr>

<a id="UDO_nav_hm_FOOT" href="index.html"><img src="udo_hm.gif" alt="Home" title="Home" border="0" width="24" height="24"></a><a id="UDO_nav_up_FOOT" href="00b.html"><img src="udo_up.gif" alt="MagiC" title="MagiC" border="0" width="24" height="24"></a><a id="UDO_nav_lf_FOOT" href="00b006.html"><img src="udo_lf.gif" alt="Input fields in MagiC" title="Input fields in MagiC" border="0" width="24" height="24"></a><a id="UDO_nav_rg_FOOT" href="00b008.html"><img src="udo_rg.gif" alt="Special error-messages in MagiC" title="Special error-messages in MagiC" border="0" width="24" height="24"></a></body>
</html>
